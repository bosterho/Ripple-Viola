{ Compiled on Sat Jun 29 21:27:35 2024 }
on init
  declare $sksp_dummy
  declare $concat_it
  declare $concat_offset
  declare $string_it
  declare $list_it
  declare $preproc_i
  message("")
  declare ~power_curve_norm
  declare %hide_states[2] := ($HIDE_WHOLE_CONTROL, $HIDE_PART_NOTHING)
  declare $array_i
  declare %black_keys[5] := (1, 3, 6, 8, 10)
  declare !tempo_names[9]
  !tempo_names[0] := "1/32"
  !tempo_names[1] := "1/16 T"
  !tempo_names[2] := "1/16"
  !tempo_names[3] := "1/8 T"
  !tempo_names[4] := "1/8"
  !tempo_names[5] := "1/4 T"
  !tempo_names[6] := "1/4"
  !tempo_names[7] := "1/2"
  !tempo_names[8] := "Bar"
  declare !NOTE_NAME[127]
  declare const $NOTE_NAME__SIZE := 127
  !NOTE_NAME[0] := "C"
  !NOTE_NAME[1] := "C#"
  !NOTE_NAME[2] := "D"
  !NOTE_NAME[3] := "D#"
  !NOTE_NAME[4] := "E"
  !NOTE_NAME[5] := "F"
  !NOTE_NAME[6] := "F#"
  !NOTE_NAME[7] := "G"
  !NOTE_NAME[8] := "G#"
  !NOTE_NAME[9] := "A"
  !NOTE_NAME[10] := "A#"
  !NOTE_NAME[11] := "B"
  !NOTE_NAME[12] := "C"
  !NOTE_NAME[13] := "C#"
  !NOTE_NAME[14] := "D"
  !NOTE_NAME[15] := "D#"
  !NOTE_NAME[16] := "E"
  !NOTE_NAME[17] := "F"
  !NOTE_NAME[18] := "F#"
  !NOTE_NAME[19] := "G"
  !NOTE_NAME[20] := "G#"
  !NOTE_NAME[21] := "A"
  !NOTE_NAME[22] := "A#"
  !NOTE_NAME[23] := "B"
  !NOTE_NAME[24] := "C"
  !NOTE_NAME[25] := "C#"
  !NOTE_NAME[26] := "D"
  !NOTE_NAME[27] := "D#"
  !NOTE_NAME[28] := "E"
  !NOTE_NAME[29] := "F"
  !NOTE_NAME[30] := "F#"
  !NOTE_NAME[31] := "G"
  !NOTE_NAME[32] := "G#"
  !NOTE_NAME[33] := "A"
  !NOTE_NAME[34] := "A#"
  !NOTE_NAME[35] := "B"
  !NOTE_NAME[36] := "C"
  !NOTE_NAME[37] := "C#"
  !NOTE_NAME[38] := "D"
  !NOTE_NAME[39] := "D#"
  !NOTE_NAME[40] := "E"
  !NOTE_NAME[41] := "F"
  !NOTE_NAME[42] := "F#"
  !NOTE_NAME[43] := "G"
  !NOTE_NAME[44] := "G#"
  !NOTE_NAME[45] := "A"
  !NOTE_NAME[46] := "A#"
  !NOTE_NAME[47] := "B"
  !NOTE_NAME[48] := "C"
  !NOTE_NAME[49] := "C#"
  !NOTE_NAME[50] := "D"
  !NOTE_NAME[51] := "D#"
  !NOTE_NAME[52] := "E"
  !NOTE_NAME[53] := "F"
  !NOTE_NAME[54] := "F#"
  !NOTE_NAME[55] := "G"
  !NOTE_NAME[56] := "G#"
  !NOTE_NAME[57] := "A"
  !NOTE_NAME[58] := "A#"
  !NOTE_NAME[59] := "B"
  !NOTE_NAME[60] := "C"
  !NOTE_NAME[61] := "C#"
  !NOTE_NAME[62] := "D"
  !NOTE_NAME[63] := "D#"
  !NOTE_NAME[64] := "E"
  !NOTE_NAME[65] := "F"
  !NOTE_NAME[66] := "F#"
  !NOTE_NAME[67] := "G"
  !NOTE_NAME[68] := "G#"
  !NOTE_NAME[69] := "A"
  !NOTE_NAME[70] := "A#"
  !NOTE_NAME[71] := "B"
  !NOTE_NAME[72] := "C"
  !NOTE_NAME[73] := "C#"
  !NOTE_NAME[74] := "D"
  !NOTE_NAME[75] := "D#"
  !NOTE_NAME[76] := "E"
  !NOTE_NAME[77] := "F"
  !NOTE_NAME[78] := "F#"
  !NOTE_NAME[79] := "G"
  !NOTE_NAME[80] := "G#"
  !NOTE_NAME[81] := "A"
  !NOTE_NAME[82] := "A#"
  !NOTE_NAME[83] := "B"
  !NOTE_NAME[84] := "C"
  !NOTE_NAME[85] := "C#"
  !NOTE_NAME[86] := "D"
  !NOTE_NAME[87] := "D#"
  !NOTE_NAME[88] := "E"
  !NOTE_NAME[89] := "F"
  !NOTE_NAME[90] := "F#"
  !NOTE_NAME[91] := "G"
  !NOTE_NAME[92] := "G#"
  !NOTE_NAME[93] := "A"
  !NOTE_NAME[94] := "A#"
  !NOTE_NAME[95] := "B"
  !NOTE_NAME[96] := "C"
  !NOTE_NAME[97] := "C#"
  !NOTE_NAME[98] := "D"
  !NOTE_NAME[99] := "D#"
  !NOTE_NAME[100] := "E"
  !NOTE_NAME[101] := "F"
  !NOTE_NAME[102] := "F#"
  !NOTE_NAME[103] := "G"
  !NOTE_NAME[104] := "G#"
  !NOTE_NAME[105] := "A"
  !NOTE_NAME[106] := "A#"
  !NOTE_NAME[107] := "B"
  !NOTE_NAME[108] := "C"
  !NOTE_NAME[109] := "C#"
  !NOTE_NAME[110] := "D"
  !NOTE_NAME[111] := "D#"
  !NOTE_NAME[112] := "E"
  !NOTE_NAME[113] := "F"
  !NOTE_NAME[114] := "F#"
  !NOTE_NAME[115] := "G"
  !NOTE_NAME[116] := "G#"
  !NOTE_NAME[117] := "A"
  !NOTE_NAME[118] := "A#"
  !NOTE_NAME[119] := "B"
  !NOTE_NAME[120] := "C"
  !NOTE_NAME[121] := "C#"
  !NOTE_NAME[122] := "D"
  !NOTE_NAME[123] := "D#"
  !NOTE_NAME[124] := "E"
  !NOTE_NAME[125] := "F"
  !NOTE_NAME[126] := "F#"
  declare const $MEM_SIZE := 1000000
  declare const $STACK_SIZE := 1000
  declare const $MAX_TASKS := $MEM_SIZE/$STACK_SIZE-1
  declare const $TASK_0 := $MEM_SIZE-($STACK_SIZE*$MAX_TASKS)
  declare const $TOO_MANY_TASKS := 1
  declare const $STACK_OVERFLOW := 2
  declare const $STACK_UNDERFLOW := 3
  declare %p[$MEM_SIZE]
  declare $sp
  $sp := $TASK_0+$STACK_SIZE
  declare $fp
  $fp := $TASK_0+$STACK_SIZE
  declare $tx
  declare %tstate__id[$MAX_TASKS]
  declare %tstate__sp[$MAX_TASKS]
  declare %tstate__fp[$MAX_TASKS]
  declare %tstate__fs[$MAX_TASKS]
  $tx := 0
  while ($tx<$MAX_TASKS)
    %tstate__fs[$tx] := $TASK_0+($tx*$STACK_SIZE)
    inc($tx)
  end while
  $tx := 0
  %tstate__id[0] := -1
  pgs_create_key(TCM_EXCEPTION,5)
  pgs_set_key_val(TCM_EXCEPTION,$CURRENT_SCRIPT_SLOT,0)
  set_key_pressed_support(1)
  set_snapshot_type(3)
  declare %dev_mode[1]
  load_array(%dev_mode,2)
  set_listener($NI_SIGNAL_TIMER_MS,1000000/30)
  set_listener($NI_SIGNAL_TRANSP_START,1)
  set_listener($NI_SIGNAL_TRANSP_STOP,1)
  SET_CONDITION(NO_SYS_SCRIPT_PEDAL)
  declare $i
  declare const $NUM_ARTICULATIONS := 3
  declare const $DOWN := 0
  declare const $UP := 1
  declare const $NUM_RRS := 4
  declare const $MAX_NUM_CHORD_IDS := 1000
  declare %custom_event_source[1000000]
  declare %custom_event_note[1000000]
  declare %custom_event_velocity[1000000]
  declare %custom_event_low_note[1000000]
  declare %custom_event_high_note[1000000]
  declare %custom_event_origin_note[1000000]
  declare %custom_event_dest_note[1000000]
  declare %custom_event_first_note[1000000]
  declare %custom_event_second_note[1000000]
  declare %custom_event_row[1000000]
  declare %custom_event_direction[1000000]
  declare %custom_event_artic[1000000]
  declare %custom_event_voice[1000000]
  declare %custom_event_note_off_timestamp[1000000]
  declare %custom_event_release_length[1000000]
  declare %custom_event_release_sample_length[1000000]
  declare %custom_event_time_til_note_off[1000000]
  declare %custom_event_release_note[1000000]
  declare %custom_event_brightness_on_release[1000000]
  declare %custom_event_waiting_to_trigger_release_sample[1000000]
  declare %custom_event_releasing[1000000]
  declare %custom_event_dest_note_released[1000000]
  declare %custom_event_start_note_released[1000000]
  declare %custom_event_triggered_by_mf[1000000]
  declare %custom_event_preview_being_stopped[1000000]
  declare %custom_event_type[1000000]
  declare !direction_strings[2]
  !direction_strings[0] := "triangle left"
  !direction_strings[1] := "triangle right"
  declare const $RECORDED_DURATION_QUARTER := 545455
  declare const $RECORDED_DURATION_EIGHTH := 272727
  declare const $MAX_INTERVAL := 5
  declare const $MIN_BRIGHTNESS := 24
  declare !speed_texts[5]
  !speed_texts[0] := "Half"
  !speed_texts[1] := "Triplet"
  !speed_texts[2] := "Original"
  !speed_texts[3] := "Triplet"
  !speed_texts[4] := "Double"
  declare const $speed_texts__SIZE := 5
  declare ?speeds[5]
  ?speeds[0] := 2.0
  ?speeds[1] := 1.5
  ?speeds[2] := 1.0
  ?speeds[3] := 0.75
  ?speeds[4] := 0.5
  declare ?speed_multiplier[5]
  ?speed_multiplier[0] := 4.0
  ?speed_multiplier[1] := 1.66
  ?speed_multiplier[2] := 1.0
  ?speed_multiplier[3] := 0.66
  ?speed_multiplier[4] := 0.25
  declare %ARTIC[3] := (0, 1, 2)
  declare const $ARTIC__SIZE := 3
  declare const $ARTIC__QUARTERS := 0
  declare const $ARTIC__EIGHTHS := 1
  declare const $ARTIC__SIXTEENTHS := 2
  declare !articulation_texts[3]
  !articulation_texts[0] := "Quarters"
  !articulation_texts[1] := "Eighths"
  !articulation_texts[2] := "Sixteenths"
  declare const $articulation_texts__SIZE := 3
  declare %DIRECTION_MODE[3] := (0, 1, 2)
  declare const $DIRECTION_MODE__SIZE := 3
  declare const $DIRECTION_MODE__DOWN := 0
  declare const $DIRECTION_MODE__ASPLAYED := 1
  declare const $DIRECTION_MODE__UP := 2
  declare !direction_texts[3]
  !direction_texts[0] := "Down"
  !direction_texts[1] := "As Played"
  !direction_texts[2] := "Up"
  declare const $direction_texts__SIZE := 3
  declare %LEGATO_MODE[4] := (0, 1, 2, 3)
  declare const $LEGATO_MODE__SIZE := 4
  declare const $LEGATO_MODE__OFF := 0
  declare const $LEGATO_MODE__SYNC_TO_PITCH := 1
  declare const $LEGATO_MODE__SYNC_TO_RIPPLE := 2
  declare const $LEGATO_MODE__SYNC_TO_SWELL := 3
  declare !legato_texts[4]
  !legato_texts[0] := "Off"
  !legato_texts[1] := "Sync to Pitch"
  !legato_texts[2] := "Sync to Ripple"
  !legato_texts[3] := "Sync to Swell"
  declare const $legato_texts__SIZE := 4
  declare %RELEASE_SAMPLES[3] := (0, 1, 2)
  declare const $RELEASE_SAMPLES__SIZE := 3
  declare const $RELEASE_SAMPLES__OFF := 0
  declare const $RELEASE_SAMPLES__SOFT := 1
  declare const $RELEASE_SAMPLES__LOUD := 2
  declare !releaseSamples_texts[3]
  !releaseSamples_texts[0] := "Off"
  !releaseSamples_texts[1] := "Soft"
  !releaseSamples_texts[2] := "Loud"
  declare const $releaseSamples_texts__SIZE := 3
  declare %release_group[$ARTIC__SIZE]
  %release_group[$ARTIC__QUARTERS] := get_group_idx("quarters releases")
  %release_group[$ARTIC__EIGHTHS] := get_group_idx("eighths releases")
  %release_group[$ARTIC__SIXTEENTHS] := get_group_idx("eighths releases")
  declare const $LOWEST_KEY := 36
  declare const $HIGHEST_KEY := 72
  declare %articulation_keyswitches[$NUM_ARTICULATIONS] := (29, 31, 33)
  declare %speed_keyswitches[5] := (72+5, 72+7, 72+9, 72+11, 72+12)
  declare %direction_keyswitches[$DIRECTION_MODE__SIZE] := (72+14, 72+16, 72+17)
  declare %legato_keyswitches[$LEGATO_MODE__SIZE] := (72+19, 72+21, 72+23, 72+24)
  declare %release_sample_keyswitches[$RELEASE_SAMPLES__SIZE] := (72+26, 72+28, 72+29)
  declare %release_trigger_keyswitches[2] := (24, 108)
  declare %all_keyswitches[64]
  declare $total_num_keyswitches
  $i := 0
  while ($i<$NUM_ARTICULATIONS)
    %all_keyswitches[$total_num_keyswitches] := %articulation_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  $i := 0
  while ($i<5)
    %all_keyswitches[$total_num_keyswitches] := %speed_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  $i := 0
  while ($i<$DIRECTION_MODE__SIZE)
    %all_keyswitches[$total_num_keyswitches] := %direction_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  $i := 0
  while ($i<$LEGATO_MODE__SIZE)
    %all_keyswitches[$total_num_keyswitches] := %legato_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  $i := 0
  while ($i<$RELEASE_SAMPLES__SIZE)
    %all_keyswitches[$total_num_keyswitches] := %release_sample_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  declare %rec_time_sample_lengths[$ARTIC__SIZE]
  %rec_time_sample_lengths[$ARTIC__QUARTERS] := $RECORDED_DURATION_QUARTER*16
  %rec_time_sample_lengths[$ARTIC__EIGHTHS] := $RECORDED_DURATION_QUARTER*8
  %rec_time_sample_lengths[$ARTIC__SIXTEENTHS] := $RECORDED_DURATION_QUARTER*8
  declare %rec_time_ripple_lengths[$ARTIC__SIZE]
  %rec_time_ripple_lengths[$ARTIC__QUARTERS] := $RECORDED_DURATION_QUARTER*2
  %rec_time_ripple_lengths[$ARTIC__EIGHTHS] := $RECORDED_DURATION_QUARTER
  %rec_time_ripple_lengths[$ARTIC__SIXTEENTHS] := $RECORDED_DURATION_QUARTER
  declare %ripple_length_ticks[$ARTIC__SIZE]
  %ripple_length_ticks[$ARTIC__QUARTERS] := 960*2
  %ripple_length_ticks[$ARTIC__EIGHTHS] := 960
  %ripple_length_ticks[$ARTIC__SIXTEENTHS] := 960
  declare %sample_length_ticks[$ARTIC__SIZE]
  %sample_length_ticks[$ARTIC__QUARTERS] := 960*16
  %sample_length_ticks[$ARTIC__EIGHTHS] := 960*8
  %sample_length_ticks[$ARTIC__SIXTEENTHS] := 960*8
  declare %pitch_fractions[$ARTIC__SIZE]
  %pitch_fractions[$ARTIC__QUARTERS] := 2
  %pitch_fractions[$ARTIC__EIGHTHS] := 2
  %pitch_fractions[$ARTIC__SIXTEENTHS] := 4
  declare $timestamp_version_shown
  declare $num_active_ripples
  declare $num_keys_pressed
  declare %key_active[128]
  declare %key_down[128]
  declare %key_released[128]
  $array_i := 0
  while ($array_i<num_elements(%key_released))
    %key_released[$array_i] := 1
    inc($array_i)
  end while
  declare %notes_to_release[1000]
  declare %voices_to_release[1000]
  declare $num_notes_to_release
  declare %num_ripple_voices[128]
  declare %note_used_by_ripple[128]
  declare %key_timestamp[128]
  declare %key_history[100]
  declare %ripple_id_history[100]
  declare $direction
  declare $row
  declare $first_ripple_timestamp
  declare $cur_midi_page
  declare $cur_artic
  make_persistent($cur_artic)
  read_persistent_var($cur_artic)
  declare $all_keys_released := 1
  declare $recent_release_trigger_key
  $recent_release_trigger_key := %release_trigger_keyswitches[0]
  declare %velo[128]
  declare %event_ids[128]
  %velo[$recent_release_trigger_key] := 64
  declare %ctrl_ids[6]
  declare !_option_texts[6*10]
  declare const $option_texts__SIZE_D1 := 6
  declare const $option_texts__SIZE_D2 := 10
  declare !_option_texts_shortened[6*10]
  declare const $option_texts_shortened__SIZE_D1 := 6
  declare const $option_texts_shortened__SIZE_D2 := 10
  declare ~midiInstructions_opacity := 0.0
  declare ~midiCover_opacity := 0.0
  declare ~smoothed_midiInstructions_opacity
  declare ~smoothed_midiCover_opacity
  declare %_midi_event_id[24*1000]
  declare const $midi_event_id__SIZE_D1 := 24
  declare const $midi_event_id__SIZE_D2 := 1000
  declare %_midi_command[24*1000]
  declare const $midi_command__SIZE_D1 := 24
  declare const $midi_command__SIZE_D2 := 1000
  declare %_midi_pos[24*1000]
  declare const $midi_pos__SIZE_D1 := 24
  declare const $midi_pos__SIZE_D2 := 1000
  declare %_midi_byte_1[24*1000]
  declare const $midi_byte_1__SIZE_D1 := 24
  declare const $midi_byte_1__SIZE_D2 := 1000
  declare %_midi_byte_2[24*1000]
  declare const $midi_byte_2__SIZE_D1 := 24
  declare const $midi_byte_2__SIZE_D2 := 1000
  declare %_midi_length[24*1000]
  declare const $midi_length__SIZE_D1 := 24
  declare const $midi_length__SIZE_D2 := 1000
  declare %clip_length[24]
  declare %clip_loop_enabled[24]
  declare %num_midi_events[24]
  declare %num_midi_notes[24]
  declare %num_midi_ccs[24]
  declare %time_started[24]
  declare %cur_event[24]
  declare %playing[24]
  declare %looping[24]
  declare %midi_file_pos_ticks[24]
  declare %cb_id[24]
  declare $hist_i
  declare $voice_i
  declare $par_i
  declare $key_i
  declare $ripple_i
  declare $b
  declare $g
  declare $v
  declare $r
  declare $k
  declare $n
  declare $e
  declare $c
  declare $event_i
  declare $other_event_i
  declare $row_i
  declare $vel_i
  declare $clip_i
  mf_reset()
  mf_set_buffer_size(1000)
  mf_set_num_export_areas(24+1)
  mf_insert_file(get_folder($GET_FOLDER_PATCH_DIR) & "/../Data/midi.mid",0,0,0)
  $clip_i := 0
  while ($clip_i<24)
    mf_get_first($clip_i)
    while (mf_get_command() # 0)
      if (mf_get_command()=$MIDI_COMMAND_NOTE_ON)
        %_midi_event_id[1000*$clip_i+%num_midi_events[$clip_i]] := mf_get_id()
        %_midi_command[1000*$clip_i+%num_midi_events[$clip_i]] := mf_get_command()
        %_midi_pos[1000*$clip_i+%num_midi_events[$clip_i]] := mf_get_pos()
        %_midi_byte_1[1000*$clip_i+%num_midi_events[$clip_i]] := mf_get_byte_one()
        %_midi_byte_2[1000*$clip_i+%num_midi_events[$clip_i]] := mf_get_byte_two()
        %_midi_length[1000*$clip_i+%num_midi_events[$clip_i]] := mf_get_note_length()
        inc(%num_midi_events[$clip_i])
        inc(%num_midi_notes[$clip_i])
      end if
      mf_get_next($clip_i)
    end while
    mf_get_first($clip_i)
    while (mf_get_command() # 0)
      if (mf_get_command()=$MIDI_COMMAND_CC and (mf_get_byte_one()=64))
        declare $cc_inserted
        $cc_inserted := 0
        $event_i := 0
        while ($event_i<%num_midi_events[$clip_i])
          if ($cc_inserted=0)
            declare $insert_index
            $insert_index := -1
            if ($event_i=0)
              if (mf_get_pos()<%_midi_pos[1000*$clip_i+0])
                $insert_index := 0
              end if
            end if
            if (in_range($event_i,1,%num_midi_events[$clip_i]-2))
              if (mf_get_pos()>%_midi_pos[1000*$clip_i+$event_i] and (mf_get_pos()<%_midi_pos[1000*$clip_i+$event_i+1]))
                $insert_index := $event_i+1
              end if
            end if
            if ($event_i=(%num_midi_events[$clip_i]-1))
              if (mf_get_pos()>%_midi_pos[1000*$clip_i+(%num_midi_events[$clip_i]-1)])
                $insert_index := %num_midi_events[$clip_i]
              end if
            end if
            if (mf_get_pos()=%_midi_pos[1000*$clip_i+$event_i])
              $insert_index := $event_i
            end if
            if ($insert_index # -1)
              $cc_inserted := 1
              $other_event_i := 1000-1
              while ($other_event_i>=($insert_index+1))
                %_midi_event_id[1000*$clip_i+$other_event_i] := %_midi_event_id[1000*$clip_i+($other_event_i-1)]
                %_midi_command[1000*$clip_i+$other_event_i] := %_midi_command[1000*$clip_i+($other_event_i-1)]
                %_midi_pos[1000*$clip_i+$other_event_i] := %_midi_pos[1000*$clip_i+($other_event_i-1)]
                %_midi_byte_1[1000*$clip_i+$other_event_i] := %_midi_byte_1[1000*$clip_i+($other_event_i-1)]
                %_midi_byte_2[1000*$clip_i+$other_event_i] := %_midi_byte_2[1000*$clip_i+($other_event_i-1)]
                %_midi_length[1000*$clip_i+$other_event_i] := %_midi_length[1000*$clip_i+($other_event_i-1)]
                dec($other_event_i)
              end while
              %_midi_event_id[1000*$clip_i+$insert_index] := mf_get_id()
              %_midi_command[1000*$clip_i+$insert_index] := mf_get_command()
              %_midi_pos[1000*$clip_i+$insert_index] := mf_get_pos()
              %_midi_byte_1[1000*$clip_i+$insert_index] := mf_get_byte_one()
              %_midi_byte_2[1000*$clip_i+$insert_index] := mf_get_byte_two()
            end if
          end if
          inc($event_i)
        end while
        inc(%num_midi_events[$clip_i])
        inc(%num_midi_ccs[$clip_i])
      end if
      mf_get_next($clip_i)
    end while
    inc($clip_i)
  end while
  $clip_i := 0
  while ($clip_i<24)
    mf_get_first($clip_i)
    while (mf_get_command() # 0)
      if (mf_get_command()=$MIDI_COMMAND_CC)
        if (mf_get_byte_one()=103)
          %clip_length[$clip_i] := mf_get_pos()
          if (mf_get_byte_two()=127)
            %clip_loop_enabled[$clip_i] := 1
          else
            %clip_loop_enabled[$clip_i] := 0
          end if
        end if
      end if
      mf_get_next($clip_i)
    end while
    inc($clip_i)
  end while
  make_perfview
  set_ui_width_px(900)
  set_ui_height_px(427)
  set_control_par_str($INST_ICON_ID,$CONTROL_PAR_PICTURE,"ui_icon")
  set_control_par_str($INST_WALLPAPER_ID,$CONTROL_PAR_PICTURE,"ui_background")
  declare $figma_counter
  declare $figma_counter_multi_line_labels
  declare %UI_x[224] := (0, 2, 723, 538, 359, 120, 607, 168, 48, 2, 26, 0, 2, 422, 11, 740, 592, 444, 296, 148, 0, 740, 592, 444, 296, 148, 0, 11, 740, 592, 444, 296, 148, 0, 740, 592, 444, 296, 148, 0, 95, ...
  51, 9, 140, 128, 84, 45, 10, 129, 56, 7, 183, 137, 86, 41, 5, 0, 0, 0, 0, 0, 0, 0, 467, 339, 211, 716, -1, 31, 117, 117, 117, 117, 117, 117, 117, 117, 117, 117, 117, 117, ...
  117, 117, 117, 117, 117, 117, 117, 117, 117, 117, 117, 117, -1, 0, 0, 0, 0, 0, 5, 704, 4, 20, 48, 88, 27, 4, 6, 18, 0, 3, 236, 829, 806, 760, 714, 668, 645, 599, 553, 783, ...
  737, 691, 622, 576, 530, 484, 438, 392, 369, 323, 277, 507, 461, 415, 346, 300, 254, 208, 162, 116, 93, 47, 1, 231, 185, 139, 70, 24, 865, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 3)
  declare %UI_y[224] := (0, 330, 14, 14, 14, 14, 234, 8, 8, 234, 131, 0, 1, 201, 242, 92, 92, 92, 92, 92, 92, 0, 0, 0, 0, 0, 0, 242, 92, 92, 92, 92, 92, 92, 0, 0, 0, 0, 0, 0, 49, ...
  49, 49, 2, 49, 49, 49, 49, 49, 49, 49, 49, 49, 49, 49, 49, -1, -1, -1, -1, -1, -1, -1, 26, 26, 26, 6, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, -1, 17, 17, 17, 17, 0, 0, 2, -1, -1, -1, -1, 22, 24, 72, 15, 70, 70, 75, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...
  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 49, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 70)
  declare %UI_width[224] := (900, 896, 158, 171, 165, 231, 291, 74, 83, 604, 852, 898, 896, 54, 876, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 876, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 136, 40, ...
  35, 34, 18, 43, 50, 42, 35, 26, 61, 43, 48, 45, 52, 45, 35, 899, 899, 899, 899, 899, 899, 899, 91, 91, 91, 170, 23, 23, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, ...
  18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 901, 136, 171, 165, 225, 74, 74, 193, 133, 131, 73, 48, 74, 174, 30, 33, 68, 77, 430, 22, 22, 22, 22, 22, 22, 22, 22, 22, ...
  22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 38, 896, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, ...
  109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, ...
  136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 136, 109, 136, 68)
  declare %UI_height[224] := (427, 95, 64, 64, 64, 64, 95, 85, 88, 95, 38, 427, 424, 24, 182, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 182, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 15, ...
  15, 15, 16, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 423, 423, 423, 423, 423, 423, 423, 43, 43, 43, 50, 23, 23, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, ...
  16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 147, 33, 33, 33, 33, 74, 74, 70, 21, 21, 21, 21, 45, 45, 30, 35, 14, 18, 49, 36, 36, 36, 36, 36, 36, 36, 36, 36, ...
  36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 36, 18, 424, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, ...
  80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, ...
  80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 80, 13)
  declare %UI_skin[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, ...
  0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, ...
  14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 0, 15, 16, 17, 18, 19, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 0, 0, 29, 30, 30, 30, 30, 30, 30, 30, 30, 31, ...
  31, 31, 31, 31, 30, 30, 30, 30, 30, 30, 30, 31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 30, 30, 31, 31, 31, 31, 31, 0, 32, 33, 12, 34, 33, 12, 35, 33, 12, 36, 33, ...
  12, 37, 33, 12, 38, 33, 12, 39, 33, 12, 40, 33, 12, 41, 33, 12, 42, 33, 12, 43, 33, 12, 44, 33, 12, 45, 33, 12, 46, 33, 12, 47, 33, 12, 48, 33, 12, 49, 33, 12, ...
  50, 33, 12, 51, 33, 12, 52, 33, 12, 53, 33, 12, 54, 33, 12, 55, 33, 12, 56, 33, 12, 57, 58)
  declare %UI_font[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_label_text[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 2, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_default_value[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_mouse_behaviour[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -800, -800, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_mouse_behaviour_x[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_mouse_behaviour_y[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_z_layer[224] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, ...
  1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare !skin_picture[59]
  !skin_picture[0] := "label_transparent"
  !skin_picture[1] := "release trigger"
  !skin_picture[2] := "switch_releaseSamplesInfoDisp"
  !skin_picture[3] := "switch_legatoInfoDisp"
  !skin_picture[4] := "switch_directionInfoDisp"
  !skin_picture[5] := "switch_speedInfoDisp"
  !skin_picture[6] := "switch_optionsInfoDisp"
  !skin_picture[7] := "switch_articulationsInfoDisp"
  !skin_picture[8] := "switch_generalInfoDisp"
  !skin_picture[9] := "sixteenths"
  !skin_picture[10] := "eighths"
  !skin_picture[11] := "quarters"
  !skin_picture[12] := "blank"
  !skin_picture[13] := "dot"
  !skin_picture[14] := "preview"
  !skin_picture[15] := "3 step slider small"
  !skin_picture[16] := "4 step slider"
  !skin_picture[17] := "3 step slider"
  !skin_picture[18] := "5 step slider"
  !skin_picture[19] := "knob"
  !skin_picture[20] := "Logo animation"
  !skin_picture[21] := "release samples info"
  !skin_picture[22] := "legato info"
  !skin_picture[23] := "direction info"
  !skin_picture[24] := "speed info"
  !skin_picture[25] := "options info"
  !skin_picture[26] := "articulations info"
  !skin_picture[27] := "general info"
  !skin_picture[28] := "lightbulb"
  !skin_picture[29] := "label_midiInstructions"
  !skin_picture[30] := "white key"
  !skin_picture[31] := "black key"
  !skin_picture[32] := "label_midiCover"
  !skin_picture[33] := "label_clipOutline"
  !skin_picture[34] := "clip23"
  !skin_picture[35] := "clip22"
  !skin_picture[36] := "clip21"
  !skin_picture[37] := "clip20"
  !skin_picture[38] := "clip19"
  !skin_picture[39] := "clip18"
  !skin_picture[40] := "clip17"
  !skin_picture[41] := "clip16"
  !skin_picture[42] := "clip15"
  !skin_picture[43] := "clip14"
  !skin_picture[44] := "clip13"
  !skin_picture[45] := "clip12"
  !skin_picture[46] := "clip11"
  !skin_picture[47] := "clip10"
  !skin_picture[48] := "clip9"
  !skin_picture[49] := "clip8"
  !skin_picture[50] := "clip7"
  !skin_picture[51] := "clip6"
  !skin_picture[52] := "clip5"
  !skin_picture[53] := "clip4"
  !skin_picture[54] := "clip3"
  !skin_picture[55] := "clip2"
  !skin_picture[56] := "clip1"
  !skin_picture[57] := "clip0"
  !skin_picture[58] := "reverb menu"
  declare !_labels_text[3*10]
  declare const $labels_text__SIZE_D1 := 3
  declare const $labels_text__SIZE_D2 := 10
  !_labels_text[10*0+0] := "REVERB"
  !_labels_text[10*1+0] := "EXPRESSION"
  !_labels_text[10*2+0] := "v1.0"
  declare %MULTI_LINE_DATA[3] := (1, 1, 1)
  declare %font_file_ids[2]
  %font_file_ids[0] := get_font_id("Khula Regular Size 15")
  %font_file_ids[1] := get_font_id("Khula Bold Size 11 on")
  declare ui_panel $panel_UI
  declare ui_panel $panel_options
  declare ui_panel $panel_releaseSamples
  declare ui_panel $panel_legato
  declare ui_panel $panel_direction
  declare ui_panel $panel_speed
  declare ui_panel $panel_fx
  declare ui_panel $panel_reverb
  declare ui_panel $panel_vol
  declare ui_panel $panel_articulations
  declare ui_panel $panel_keyboard
  declare ui_panel $panel_midi
  declare ui_panel $panel_midiCover
  declare ui_panel $panel_midiPgChooser
  declare ui_panel $panel_midiPg1
  declare ui_panel $panel_clip23
  declare ui_panel $panel_clip22
  declare ui_panel $panel_clip21
  declare ui_panel $panel_clip20
  declare ui_panel $panel_clip19
  declare ui_panel $panel_clip18
  declare ui_panel $panel_clip17
  declare ui_panel $panel_clip16
  declare ui_panel $panel_clip15
  declare ui_panel $panel_clip14
  declare ui_panel $panel_clip13
  declare ui_panel $panel_clip12
  declare ui_panel $panel_midiPg0
  declare ui_panel $panel_clip11
  declare ui_panel $panel_clip10
  declare ui_panel $panel_clip9
  declare ui_panel $panel_clip8
  declare ui_panel $panel_clip7
  declare ui_panel $panel_clip6
  declare ui_panel $panel_clip5
  declare ui_panel $panel_clip4
  declare ui_panel $panel_clip3
  declare ui_panel $panel_clip2
  declare ui_panel $panel_clip1
  declare ui_panel $panel_clip0
  declare ui_switch $switch_releaseSamples__loud
  make_persistent($switch_releaseSamples__loud)
  read_persistent_var($switch_releaseSamples__loud)
  declare ui_switch $switch_releaseSamples__soft
  make_persistent($switch_releaseSamples__soft)
  read_persistent_var($switch_releaseSamples__soft)
  declare ui_switch $switch_releaseSamples__off
  make_persistent($switch_releaseSamples__off)
  read_persistent_var($switch_releaseSamples__off)
  declare ui_switch $switch_releaseTrigger
  make_persistent($switch_releaseTrigger)
  read_persistent_var($switch_releaseTrigger)
  declare ui_switch $switch_syncToSwell
  make_persistent($switch_syncToSwell)
  read_persistent_var($switch_syncToSwell)
  declare ui_switch $switch_syncToRipple
  make_persistent($switch_syncToRipple)
  read_persistent_var($switch_syncToRipple)
  declare ui_switch $switch_syncToPitch
  make_persistent($switch_syncToPitch)
  read_persistent_var($switch_syncToPitch)
  declare ui_switch $switch_noLegato
  make_persistent($switch_noLegato)
  read_persistent_var($switch_noLegato)
  declare ui_switch $switch_up
  make_persistent($switch_up)
  read_persistent_var($switch_up)
  declare ui_switch $switch_asPlayed
  make_persistent($switch_asPlayed)
  read_persistent_var($switch_asPlayed)
  declare ui_switch $switch_down
  make_persistent($switch_down)
  read_persistent_var($switch_down)
  declare ui_switch $switch_doubleSpeed
  make_persistent($switch_doubleSpeed)
  read_persistent_var($switch_doubleSpeed)
  declare ui_switch $switch_fastTripletSpeed
  make_persistent($switch_fastTripletSpeed)
  read_persistent_var($switch_fastTripletSpeed)
  declare ui_switch $switch_fullSpeed
  make_persistent($switch_fullSpeed)
  read_persistent_var($switch_fullSpeed)
  declare ui_switch $switch_slowTripletSpeed
  make_persistent($switch_slowTripletSpeed)
  read_persistent_var($switch_slowTripletSpeed)
  declare ui_switch $switch_halfSpeed
  make_persistent($switch_halfSpeed)
  read_persistent_var($switch_halfSpeed)
  declare ui_switch $switch_releaseSamplesInfoDisp
  make_persistent($switch_releaseSamplesInfoDisp)
  read_persistent_var($switch_releaseSamplesInfoDisp)
  declare ui_switch $switch_legatoInfoDisp
  make_persistent($switch_legatoInfoDisp)
  read_persistent_var($switch_legatoInfoDisp)
  declare ui_switch $switch_directionInfoDisp
  make_persistent($switch_directionInfoDisp)
  read_persistent_var($switch_directionInfoDisp)
  declare ui_switch $switch_speedInfoDisp
  make_persistent($switch_speedInfoDisp)
  read_persistent_var($switch_speedInfoDisp)
  declare ui_switch $switch_optionsInfoDisp
  make_persistent($switch_optionsInfoDisp)
  read_persistent_var($switch_optionsInfoDisp)
  declare ui_switch $switch_articulationsInfoDisp
  make_persistent($switch_articulationsInfoDisp)
  read_persistent_var($switch_articulationsInfoDisp)
  declare ui_switch $switch_generalInfoDisp
  make_persistent($switch_generalInfoDisp)
  read_persistent_var($switch_generalInfoDisp)
  declare ui_switch $switch_sixteenths
  make_persistent($switch_sixteenths)
  read_persistent_var($switch_sixteenths)
  declare ui_switch $switch_eighths
  make_persistent($switch_eighths)
  read_persistent_var($switch_eighths)
  declare ui_switch $switch_quarters
  make_persistent($switch_quarters)
  read_persistent_var($switch_quarters)
  declare ui_switch $switch_logoAnimTrigger
  make_persistent($switch_logoAnimTrigger)
  read_persistent_var($switch_logoAnimTrigger)
  declare ui_switch $switch_midiPgChooser0
  make_persistent($switch_midiPgChooser0)
  read_persistent_var($switch_midiPgChooser0)
  declare ui_switch $switch_midiPgChooser1
  make_persistent($switch_midiPgChooser1)
  read_persistent_var($switch_midiPgChooser1)
  declare ui_switch $switch_preview23
  make_persistent($switch_preview23)
  read_persistent_var($switch_preview23)
  declare ui_switch $switch_preview22
  make_persistent($switch_preview22)
  read_persistent_var($switch_preview22)
  declare ui_switch $switch_preview21
  make_persistent($switch_preview21)
  read_persistent_var($switch_preview21)
  declare ui_switch $switch_preview20
  make_persistent($switch_preview20)
  read_persistent_var($switch_preview20)
  declare ui_switch $switch_preview19
  make_persistent($switch_preview19)
  read_persistent_var($switch_preview19)
  declare ui_switch $switch_preview18
  make_persistent($switch_preview18)
  read_persistent_var($switch_preview18)
  declare ui_switch $switch_preview17
  make_persistent($switch_preview17)
  read_persistent_var($switch_preview17)
  declare ui_switch $switch_preview16
  make_persistent($switch_preview16)
  read_persistent_var($switch_preview16)
  declare ui_switch $switch_preview15
  make_persistent($switch_preview15)
  read_persistent_var($switch_preview15)
  declare ui_switch $switch_preview14
  make_persistent($switch_preview14)
  read_persistent_var($switch_preview14)
  declare ui_switch $switch_preview13
  make_persistent($switch_preview13)
  read_persistent_var($switch_preview13)
  declare ui_switch $switch_preview12
  make_persistent($switch_preview12)
  read_persistent_var($switch_preview12)
  declare ui_switch $switch_preview11
  make_persistent($switch_preview11)
  read_persistent_var($switch_preview11)
  declare ui_switch $switch_preview10
  make_persistent($switch_preview10)
  read_persistent_var($switch_preview10)
  declare ui_switch $switch_preview9
  make_persistent($switch_preview9)
  read_persistent_var($switch_preview9)
  declare ui_switch $switch_preview8
  make_persistent($switch_preview8)
  read_persistent_var($switch_preview8)
  declare ui_switch $switch_preview7
  make_persistent($switch_preview7)
  read_persistent_var($switch_preview7)
  declare ui_switch $switch_preview6
  make_persistent($switch_preview6)
  read_persistent_var($switch_preview6)
  declare ui_switch $switch_preview5
  make_persistent($switch_preview5)
  read_persistent_var($switch_preview5)
  declare ui_switch $switch_preview4
  make_persistent($switch_preview4)
  read_persistent_var($switch_preview4)
  declare ui_switch $switch_preview3
  make_persistent($switch_preview3)
  read_persistent_var($switch_preview3)
  declare ui_switch $switch_preview2
  make_persistent($switch_preview2)
  read_persistent_var($switch_preview2)
  declare ui_switch $switch_preview1
  make_persistent($switch_preview1)
  read_persistent_var($switch_preview1)
  declare ui_switch $switch_preview0
  make_persistent($switch_preview0)
  read_persistent_var($switch_preview0)
  declare ui_switch $switch_closeMidi
  make_persistent($switch_closeMidi)
  read_persistent_var($switch_closeMidi)
  declare ui_slider $slider_releaseSamples(0,2)
  make_persistent($slider_releaseSamples)
  read_persistent_var($slider_releaseSamples)
  declare ui_slider $slider_legato(0,3)
  make_persistent($slider_legato)
  read_persistent_var($slider_legato)
  declare ui_slider $slider_direction(0,2)
  make_persistent($slider_direction)
  read_persistent_var($slider_direction)
  declare ui_slider $slider_speed(0,4)
  make_persistent($slider_speed)
  read_persistent_var($slider_speed)
  declare ui_slider $slider_reverb(0,1000000)
  make_persistent($slider_reverb)
  read_persistent_var($slider_reverb)
  declare ui_slider $slider_vol(0,1000000)
  make_persistent($slider_vol)
  read_persistent_var($slider_vol)
  declare ui_slider $slider_logoAnim(0,127)
  make_persistent($slider_logoAnim)
  read_persistent_var($slider_logoAnim)
  declare ui_button $button_releaseSamplesInfo
  make_persistent($button_releaseSamplesInfo)
  read_persistent_var($button_releaseSamplesInfo)
  declare ui_button $button_legatoInfo
  make_persistent($button_legatoInfo)
  read_persistent_var($button_legatoInfo)
  declare ui_button $button_directionInfo
  make_persistent($button_directionInfo)
  read_persistent_var($button_directionInfo)
  declare ui_button $button_speedInfo
  make_persistent($button_speedInfo)
  read_persistent_var($button_speedInfo)
  declare ui_button $button_optionsInfo
  make_persistent($button_optionsInfo)
  read_persistent_var($button_optionsInfo)
  declare ui_button $button_articulationsInfo
  make_persistent($button_articulationsInfo)
  read_persistent_var($button_articulationsInfo)
  declare ui_button $button_generalInfo
  make_persistent($button_generalInfo)
  read_persistent_var($button_generalInfo)
  declare ui_button $button_showMidi
  make_persistent($button_showMidi)
  read_persistent_var($button_showMidi)
  declare ui_label $label_reverb(1,1)
  make_persistent($label_reverb)
  read_persistent_var($label_reverb)
  declare ui_label $label_vol(1,1)
  make_persistent($label_vol)
  read_persistent_var($label_vol)
  declare ui_label $label_midiInstructions(1,1)
  make_persistent($label_midiInstructions)
  read_persistent_var($label_midiInstructions)
  declare ui_label $label_oct2__note12(1,1)
  make_persistent($label_oct2__note12)
  read_persistent_var($label_oct2__note12)
  declare ui_label $label_oct2__note11(1,1)
  make_persistent($label_oct2__note11)
  read_persistent_var($label_oct2__note11)
  declare ui_label $label_oct2__note9(1,1)
  make_persistent($label_oct2__note9)
  read_persistent_var($label_oct2__note9)
  declare ui_label $label_oct2__note7(1,1)
  make_persistent($label_oct2__note7)
  read_persistent_var($label_oct2__note7)
  declare ui_label $label_oct2__note5(1,1)
  make_persistent($label_oct2__note5)
  read_persistent_var($label_oct2__note5)
  declare ui_label $label_oct2__note4(1,1)
  make_persistent($label_oct2__note4)
  read_persistent_var($label_oct2__note4)
  declare ui_label $label_oct2__note2(1,1)
  make_persistent($label_oct2__note2)
  read_persistent_var($label_oct2__note2)
  declare ui_label $label_oct2__note0(1,1)
  make_persistent($label_oct2__note0)
  read_persistent_var($label_oct2__note0)
  declare ui_label $label_oct2__note10(1,1)
  make_persistent($label_oct2__note10)
  read_persistent_var($label_oct2__note10)
  declare ui_label $label_oct2__note8(1,1)
  make_persistent($label_oct2__note8)
  read_persistent_var($label_oct2__note8)
  declare ui_label $label_oct2__note6(1,1)
  make_persistent($label_oct2__note6)
  read_persistent_var($label_oct2__note6)
  declare ui_label $label_oct2__note3(1,1)
  make_persistent($label_oct2__note3)
  read_persistent_var($label_oct2__note3)
  declare ui_label $label_oct2__note1(1,1)
  make_persistent($label_oct2__note1)
  read_persistent_var($label_oct2__note1)
  declare ui_label $label_oct1__note11(1,1)
  make_persistent($label_oct1__note11)
  read_persistent_var($label_oct1__note11)
  declare ui_label $label_oct1__note9(1,1)
  make_persistent($label_oct1__note9)
  read_persistent_var($label_oct1__note9)
  declare ui_label $label_oct1__note7(1,1)
  make_persistent($label_oct1__note7)
  read_persistent_var($label_oct1__note7)
  declare ui_label $label_oct1__note5(1,1)
  make_persistent($label_oct1__note5)
  read_persistent_var($label_oct1__note5)
  declare ui_label $label_oct1__note4(1,1)
  make_persistent($label_oct1__note4)
  read_persistent_var($label_oct1__note4)
  declare ui_label $label_oct1__note2(1,1)
  make_persistent($label_oct1__note2)
  read_persistent_var($label_oct1__note2)
  declare ui_label $label_oct1__note0(1,1)
  make_persistent($label_oct1__note0)
  read_persistent_var($label_oct1__note0)
  declare ui_label $label_oct1__note10(1,1)
  make_persistent($label_oct1__note10)
  read_persistent_var($label_oct1__note10)
  declare ui_label $label_oct1__note8(1,1)
  make_persistent($label_oct1__note8)
  read_persistent_var($label_oct1__note8)
  declare ui_label $label_oct1__note6(1,1)
  make_persistent($label_oct1__note6)
  read_persistent_var($label_oct1__note6)
  declare ui_label $label_oct1__note3(1,1)
  make_persistent($label_oct1__note3)
  read_persistent_var($label_oct1__note3)
  declare ui_label $label_oct1__note1(1,1)
  make_persistent($label_oct1__note1)
  read_persistent_var($label_oct1__note1)
  declare ui_label $label_oct0__note11(1,1)
  make_persistent($label_oct0__note11)
  read_persistent_var($label_oct0__note11)
  declare ui_label $label_oct0__note9(1,1)
  make_persistent($label_oct0__note9)
  read_persistent_var($label_oct0__note9)
  declare ui_label $label_oct0__note7(1,1)
  make_persistent($label_oct0__note7)
  read_persistent_var($label_oct0__note7)
  declare ui_label $label_oct0__note5(1,1)
  make_persistent($label_oct0__note5)
  read_persistent_var($label_oct0__note5)
  declare ui_label $label_oct0__note4(1,1)
  make_persistent($label_oct0__note4)
  read_persistent_var($label_oct0__note4)
  declare ui_label $label_oct0__note2(1,1)
  make_persistent($label_oct0__note2)
  read_persistent_var($label_oct0__note2)
  declare ui_label $label_oct0__note0(1,1)
  make_persistent($label_oct0__note0)
  read_persistent_var($label_oct0__note0)
  declare ui_label $label_oct0__note10(1,1)
  make_persistent($label_oct0__note10)
  read_persistent_var($label_oct0__note10)
  declare ui_label $label_oct0__note8(1,1)
  make_persistent($label_oct0__note8)
  read_persistent_var($label_oct0__note8)
  declare ui_label $label_oct0__note6(1,1)
  make_persistent($label_oct0__note6)
  read_persistent_var($label_oct0__note6)
  declare ui_label $label_oct0__note3(1,1)
  make_persistent($label_oct0__note3)
  read_persistent_var($label_oct0__note3)
  declare ui_label $label_oct0__note1(1,1)
  make_persistent($label_oct0__note1)
  read_persistent_var($label_oct0__note1)
  declare ui_label $label_version(1,1)
  make_persistent($label_version)
  read_persistent_var($label_version)
  declare ui_label $label_midiCover(1,1)
  make_persistent($label_midiCover)
  read_persistent_var($label_midiCover)
  declare ui_label $label_clipOutline23(1,1)
  make_persistent($label_clipOutline23)
  read_persistent_var($label_clipOutline23)
  declare ui_label $label_clip_dnd23(1,1)
  make_persistent($label_clip_dnd23)
  read_persistent_var($label_clip_dnd23)
  declare ui_label $label_clip23(1,1)
  make_persistent($label_clip23)
  read_persistent_var($label_clip23)
  declare ui_label $label_clipOutline22(1,1)
  make_persistent($label_clipOutline22)
  read_persistent_var($label_clipOutline22)
  declare ui_label $label_clip_dnd22(1,1)
  make_persistent($label_clip_dnd22)
  read_persistent_var($label_clip_dnd22)
  declare ui_label $label_clip22(1,1)
  make_persistent($label_clip22)
  read_persistent_var($label_clip22)
  declare ui_label $label_clipOutline21(1,1)
  make_persistent($label_clipOutline21)
  read_persistent_var($label_clipOutline21)
  declare ui_label $label_clip_dnd21(1,1)
  make_persistent($label_clip_dnd21)
  read_persistent_var($label_clip_dnd21)
  declare ui_label $label_clip21(1,1)
  make_persistent($label_clip21)
  read_persistent_var($label_clip21)
  declare ui_label $label_clipOutline20(1,1)
  make_persistent($label_clipOutline20)
  read_persistent_var($label_clipOutline20)
  declare ui_label $label_clip_dnd20(1,1)
  make_persistent($label_clip_dnd20)
  read_persistent_var($label_clip_dnd20)
  declare ui_label $label_clip20(1,1)
  make_persistent($label_clip20)
  read_persistent_var($label_clip20)
  declare ui_label $label_clipOutline19(1,1)
  make_persistent($label_clipOutline19)
  read_persistent_var($label_clipOutline19)
  declare ui_label $label_clip_dnd19(1,1)
  make_persistent($label_clip_dnd19)
  read_persistent_var($label_clip_dnd19)
  declare ui_label $label_clip19(1,1)
  make_persistent($label_clip19)
  read_persistent_var($label_clip19)
  declare ui_label $label_clipOutline18(1,1)
  make_persistent($label_clipOutline18)
  read_persistent_var($label_clipOutline18)
  declare ui_label $label_clip_dnd18(1,1)
  make_persistent($label_clip_dnd18)
  read_persistent_var($label_clip_dnd18)
  declare ui_label $label_clip18(1,1)
  make_persistent($label_clip18)
  read_persistent_var($label_clip18)
  declare ui_label $label_clipOutline17(1,1)
  make_persistent($label_clipOutline17)
  read_persistent_var($label_clipOutline17)
  declare ui_label $label_clip_dnd17(1,1)
  make_persistent($label_clip_dnd17)
  read_persistent_var($label_clip_dnd17)
  declare ui_label $label_clip17(1,1)
  make_persistent($label_clip17)
  read_persistent_var($label_clip17)
  declare ui_label $label_clipOutline16(1,1)
  make_persistent($label_clipOutline16)
  read_persistent_var($label_clipOutline16)
  declare ui_label $label_clip_dnd16(1,1)
  make_persistent($label_clip_dnd16)
  read_persistent_var($label_clip_dnd16)
  declare ui_label $label_clip16(1,1)
  make_persistent($label_clip16)
  read_persistent_var($label_clip16)
  declare ui_label $label_clipOutline15(1,1)
  make_persistent($label_clipOutline15)
  read_persistent_var($label_clipOutline15)
  declare ui_label $label_clip_dnd15(1,1)
  make_persistent($label_clip_dnd15)
  read_persistent_var($label_clip_dnd15)
  declare ui_label $label_clip15(1,1)
  make_persistent($label_clip15)
  read_persistent_var($label_clip15)
  declare ui_label $label_clipOutline14(1,1)
  make_persistent($label_clipOutline14)
  read_persistent_var($label_clipOutline14)
  declare ui_label $label_clip_dnd14(1,1)
  make_persistent($label_clip_dnd14)
  read_persistent_var($label_clip_dnd14)
  declare ui_label $label_clip14(1,1)
  make_persistent($label_clip14)
  read_persistent_var($label_clip14)
  declare ui_label $label_clipOutline13(1,1)
  make_persistent($label_clipOutline13)
  read_persistent_var($label_clipOutline13)
  declare ui_label $label_clip_dnd13(1,1)
  make_persistent($label_clip_dnd13)
  read_persistent_var($label_clip_dnd13)
  declare ui_label $label_clip13(1,1)
  make_persistent($label_clip13)
  read_persistent_var($label_clip13)
  declare ui_label $label_clipOutline12(1,1)
  make_persistent($label_clipOutline12)
  read_persistent_var($label_clipOutline12)
  declare ui_label $label_clip_dnd12(1,1)
  make_persistent($label_clip_dnd12)
  read_persistent_var($label_clip_dnd12)
  declare ui_label $label_clip12(1,1)
  make_persistent($label_clip12)
  read_persistent_var($label_clip12)
  declare ui_label $label_clipOutline11(1,1)
  make_persistent($label_clipOutline11)
  read_persistent_var($label_clipOutline11)
  declare ui_label $label_clip_dnd11(1,1)
  make_persistent($label_clip_dnd11)
  read_persistent_var($label_clip_dnd11)
  declare ui_label $label_clip11(1,1)
  make_persistent($label_clip11)
  read_persistent_var($label_clip11)
  declare ui_label $label_clipOutline10(1,1)
  make_persistent($label_clipOutline10)
  read_persistent_var($label_clipOutline10)
  declare ui_label $label_clip_dnd10(1,1)
  make_persistent($label_clip_dnd10)
  read_persistent_var($label_clip_dnd10)
  declare ui_label $label_clip10(1,1)
  make_persistent($label_clip10)
  read_persistent_var($label_clip10)
  declare ui_label $label_clipOutline9(1,1)
  make_persistent($label_clipOutline9)
  read_persistent_var($label_clipOutline9)
  declare ui_label $label_clip_dnd9(1,1)
  make_persistent($label_clip_dnd9)
  read_persistent_var($label_clip_dnd9)
  declare ui_label $label_clip9(1,1)
  make_persistent($label_clip9)
  read_persistent_var($label_clip9)
  declare ui_label $label_clipOutline8(1,1)
  make_persistent($label_clipOutline8)
  read_persistent_var($label_clipOutline8)
  declare ui_label $label_clip_dnd8(1,1)
  make_persistent($label_clip_dnd8)
  read_persistent_var($label_clip_dnd8)
  declare ui_label $label_clip8(1,1)
  make_persistent($label_clip8)
  read_persistent_var($label_clip8)
  declare ui_label $label_clipOutline7(1,1)
  make_persistent($label_clipOutline7)
  read_persistent_var($label_clipOutline7)
  declare ui_label $label_clip_dnd7(1,1)
  make_persistent($label_clip_dnd7)
  read_persistent_var($label_clip_dnd7)
  declare ui_label $label_clip7(1,1)
  make_persistent($label_clip7)
  read_persistent_var($label_clip7)
  declare ui_label $label_clipOutline6(1,1)
  make_persistent($label_clipOutline6)
  read_persistent_var($label_clipOutline6)
  declare ui_label $label_clip_dnd6(1,1)
  make_persistent($label_clip_dnd6)
  read_persistent_var($label_clip_dnd6)
  declare ui_label $label_clip6(1,1)
  make_persistent($label_clip6)
  read_persistent_var($label_clip6)
  declare ui_label $label_clipOutline5(1,1)
  make_persistent($label_clipOutline5)
  read_persistent_var($label_clipOutline5)
  declare ui_label $label_clip_dnd5(1,1)
  make_persistent($label_clip_dnd5)
  read_persistent_var($label_clip_dnd5)
  declare ui_label $label_clip5(1,1)
  make_persistent($label_clip5)
  read_persistent_var($label_clip5)
  declare ui_label $label_clipOutline4(1,1)
  make_persistent($label_clipOutline4)
  read_persistent_var($label_clipOutline4)
  declare ui_label $label_clip_dnd4(1,1)
  make_persistent($label_clip_dnd4)
  read_persistent_var($label_clip_dnd4)
  declare ui_label $label_clip4(1,1)
  make_persistent($label_clip4)
  read_persistent_var($label_clip4)
  declare ui_label $label_clipOutline3(1,1)
  make_persistent($label_clipOutline3)
  read_persistent_var($label_clipOutline3)
  declare ui_label $label_clip_dnd3(1,1)
  make_persistent($label_clip_dnd3)
  read_persistent_var($label_clip_dnd3)
  declare ui_label $label_clip3(1,1)
  make_persistent($label_clip3)
  read_persistent_var($label_clip3)
  declare ui_label $label_clipOutline2(1,1)
  make_persistent($label_clipOutline2)
  read_persistent_var($label_clipOutline2)
  declare ui_label $label_clip_dnd2(1,1)
  make_persistent($label_clip_dnd2)
  read_persistent_var($label_clip_dnd2)
  declare ui_label $label_clip2(1,1)
  make_persistent($label_clip2)
  read_persistent_var($label_clip2)
  declare ui_label $label_clipOutline1(1,1)
  make_persistent($label_clipOutline1)
  read_persistent_var($label_clipOutline1)
  declare ui_label $label_clip_dnd1(1,1)
  make_persistent($label_clip_dnd1)
  read_persistent_var($label_clip_dnd1)
  declare ui_label $label_clip1(1,1)
  make_persistent($label_clip1)
  read_persistent_var($label_clip1)
  declare ui_label $label_clipOutline0(1,1)
  make_persistent($label_clipOutline0)
  read_persistent_var($label_clipOutline0)
  declare ui_label $label_clip_dnd0(1,1)
  make_persistent($label_clip_dnd0)
  read_persistent_var($label_clip_dnd0)
  declare ui_label $label_clip0(1,1)
  make_persistent($label_clip0)
  read_persistent_var($label_clip0)
  declare ui_menu $menu_reverb
  make_persistent($menu_reverb)
  read_persistent_var($menu_reverb)
  declare %UI_ID[10000] := (0)
  %UI_ID[0] := get_ui_id($panel_UI)
  $figma_counter := 1
  while ($figma_counter<224)
    %UI_ID[$figma_counter] := %UI_ID[0]+$figma_counter
    inc($figma_counter)
  end while
  declare %panel_idx[224] := (0, 1, 1, 1, 1, 0, 6, 6, 0, 0, 0, 11, 11, 11, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 11, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 2, 2, ...
  2, 2, 3, 3, 3, 3, 4, 4, 4, 5, 5, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 9, 9, 9, 0, 13, 13, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 28, ...
  29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 0, 2, 3, 4, 5, 7, 8, 0, 2, 3, 4, 5, 1, 9, 0, 0, 7, 8, 0, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, ...
  10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 0, 12, 15, 15, 15, 16, 16, 16, 17, 17, 17, 18, 18, ...
  18, 19, 19, 19, 20, 20, 20, 21, 21, 21, 22, 22, 22, 23, 23, 23, 24, 24, 24, 25, 25, 25, 26, 26, 26, 28, 28, 28, 29, 29, 29, 30, 30, 30, 31, 31, 31, 32, 32, 32, ...
  33, 33, 33, 34, 34, 34, 35, 35, 35, 36, 36, 36, 37, 37, 37, 38, 38, 38, 39, 39, 39, 7)
  declare %element_idx[224] := (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, ...
  42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, ...
  82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, ...
  122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, ...
  162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 177, 178, 179, 180, 181, 182, 183, 184, 185, 186, 187, 188, 189, 190, 191, 192, 193, 194, 195, 196, 197, 198, 199, 200, 201, ...
  202, 203, 204, 205, 206, 207, 208, 209, 210, 211, 212, 213, 214, 215, 216, 217, 218, 219, 220, 221, 222, 223)
  $figma_counter := 1
  while ($figma_counter<num_elements(%panel_idx))
    if (%panel_idx[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_PARENT_PANEL,%UI_ID[%panel_idx[$figma_counter-1]])
    end if
    inc($figma_counter)
  end while
  $figma_counter := 0
  while ($figma_counter<224)
    set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_TEXT,"")
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_WIDTH,%UI_width[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_HEIGHT,%UI_height[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_POS_X,%UI_x[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_POS_Y,%UI_y[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_DEFAULT_VALUE,%UI_default_value[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_Z_LAYER,%UI_z_layer[$figma_counter])
    if (%UI_mouse_behaviour[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_MOUSE_BEHAVIOUR,%UI_mouse_behaviour[$figma_counter])
    end if
    if (%UI_mouse_behaviour_x[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_MOUSE_BEHAVIOUR_X,%UI_mouse_behaviour_x[$figma_counter])
    end if
    if (%UI_mouse_behaviour_y[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_MOUSE_BEHAVIOUR_Y,%UI_mouse_behaviour[$figma_counter])
    end if
    if (%UI_skin[$figma_counter] # -1)
      set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_PICTURE,!skin_picture[%UI_skin[$figma_counter]])
    end if
    if (%UI_label_text[$figma_counter]>-1)
      set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_TEXT,!_labels_text[10*%UI_label_text[$figma_counter]+0])
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_TEXTPOS_Y,0)
      if (%MULTI_LINE_DATA[%UI_label_text[$figma_counter]]>1)
        $figma_counter_multi_line_labels := 0
        while ($figma_counter_multi_line_labels<(%MULTI_LINE_DATA[%UI_label_text[$figma_counter]]-1))
          set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_TEXTLINE,!_labels_text[10*%UI_label_text[$figma_counter]+$figma_counter_multi_line_labels+1])
          inc($figma_counter_multi_line_labels)
        end while
      end if
    end if
    if (%UI_font[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_FONT_TYPE,%font_file_ids[%UI_font[$figma_counter]])
    end if
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
    inc($figma_counter)
  end while
  set_control_par_str($INST_ICON_ID,$CONTROL_PAR_PICTURE,"insticon")
  set_control_par(get_ui_id($label_version),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  declare %panel_midiPg[2]
  declare %switch_midiPgChooser[2]
  %panel_midiPg[0] := get_ui_id($panel_midiPg0)
  %switch_midiPgChooser[0] := get_ui_id($switch_midiPgChooser0)
  %panel_midiPg[1] := get_ui_id($panel_midiPg1)
  %switch_midiPgChooser[1] := get_ui_id($switch_midiPgChooser1)
  $i := 0
  while ($i<2)
    set_control_par(%switch_midiPgChooser[$i],$CONTROL_PAR_VALUE,0)
    inc($i)
  end while
  set_control_par(%switch_midiPgChooser[0],$CONTROL_PAR_VALUE,1)
  declare %mf_cursor[24]
  declare ui_slider $mf_cursor0(0,1000)
  declare ui_slider $mf_cursor1(0,1000)
  declare ui_slider $mf_cursor2(0,1000)
  declare ui_slider $mf_cursor3(0,1000)
  declare ui_slider $mf_cursor4(0,1000)
  declare ui_slider $mf_cursor5(0,1000)
  declare ui_slider $mf_cursor6(0,1000)
  declare ui_slider $mf_cursor7(0,1000)
  declare ui_slider $mf_cursor8(0,1000)
  declare ui_slider $mf_cursor9(0,1000)
  declare ui_slider $mf_cursor10(0,1000)
  declare ui_slider $mf_cursor11(0,1000)
  declare ui_slider $mf_cursor12(0,1000)
  declare ui_slider $mf_cursor13(0,1000)
  declare ui_slider $mf_cursor14(0,1000)
  declare ui_slider $mf_cursor15(0,1000)
  declare ui_slider $mf_cursor16(0,1000)
  declare ui_slider $mf_cursor17(0,1000)
  declare ui_slider $mf_cursor18(0,1000)
  declare ui_slider $mf_cursor19(0,1000)
  declare ui_slider $mf_cursor20(0,1000)
  declare ui_slider $mf_cursor21(0,1000)
  declare ui_slider $mf_cursor22(0,1000)
  declare ui_slider $mf_cursor23(0,1000)
  $preproc_i := 0
  while ($preproc_i<=23)
    %mf_cursor[$preproc_i] := get_ui_id($mf_cursor0)+$preproc_i
    inc($preproc_i)
  end while
  declare %midi_clip_panel_id[24]
  declare %midi_clip_id[24]
  declare %midi_clip_dnd_id[24]
  declare %midi_clip_preview_id[24]
  %midi_clip_panel_id[0] := get_ui_id($panel_clip0)
  %midi_clip_id[0] := get_ui_id($label_clip0)
  %midi_clip_dnd_id[0] := get_ui_id($label_clip_dnd0)
  %midi_clip_preview_id[0] := get_ui_id($switch_preview0)
  %midi_clip_panel_id[1] := get_ui_id($panel_clip1)
  %midi_clip_id[1] := get_ui_id($label_clip1)
  %midi_clip_dnd_id[1] := get_ui_id($label_clip_dnd1)
  %midi_clip_preview_id[1] := get_ui_id($switch_preview1)
  %midi_clip_panel_id[2] := get_ui_id($panel_clip2)
  %midi_clip_id[2] := get_ui_id($label_clip2)
  %midi_clip_dnd_id[2] := get_ui_id($label_clip_dnd2)
  %midi_clip_preview_id[2] := get_ui_id($switch_preview2)
  %midi_clip_panel_id[3] := get_ui_id($panel_clip3)
  %midi_clip_id[3] := get_ui_id($label_clip3)
  %midi_clip_dnd_id[3] := get_ui_id($label_clip_dnd3)
  %midi_clip_preview_id[3] := get_ui_id($switch_preview3)
  %midi_clip_panel_id[4] := get_ui_id($panel_clip4)
  %midi_clip_id[4] := get_ui_id($label_clip4)
  %midi_clip_dnd_id[4] := get_ui_id($label_clip_dnd4)
  %midi_clip_preview_id[4] := get_ui_id($switch_preview4)
  %midi_clip_panel_id[5] := get_ui_id($panel_clip5)
  %midi_clip_id[5] := get_ui_id($label_clip5)
  %midi_clip_dnd_id[5] := get_ui_id($label_clip_dnd5)
  %midi_clip_preview_id[5] := get_ui_id($switch_preview5)
  %midi_clip_panel_id[6] := get_ui_id($panel_clip6)
  %midi_clip_id[6] := get_ui_id($label_clip6)
  %midi_clip_dnd_id[6] := get_ui_id($label_clip_dnd6)
  %midi_clip_preview_id[6] := get_ui_id($switch_preview6)
  %midi_clip_panel_id[7] := get_ui_id($panel_clip7)
  %midi_clip_id[7] := get_ui_id($label_clip7)
  %midi_clip_dnd_id[7] := get_ui_id($label_clip_dnd7)
  %midi_clip_preview_id[7] := get_ui_id($switch_preview7)
  %midi_clip_panel_id[8] := get_ui_id($panel_clip8)
  %midi_clip_id[8] := get_ui_id($label_clip8)
  %midi_clip_dnd_id[8] := get_ui_id($label_clip_dnd8)
  %midi_clip_preview_id[8] := get_ui_id($switch_preview8)
  %midi_clip_panel_id[9] := get_ui_id($panel_clip9)
  %midi_clip_id[9] := get_ui_id($label_clip9)
  %midi_clip_dnd_id[9] := get_ui_id($label_clip_dnd9)
  %midi_clip_preview_id[9] := get_ui_id($switch_preview9)
  %midi_clip_panel_id[10] := get_ui_id($panel_clip10)
  %midi_clip_id[10] := get_ui_id($label_clip10)
  %midi_clip_dnd_id[10] := get_ui_id($label_clip_dnd10)
  %midi_clip_preview_id[10] := get_ui_id($switch_preview10)
  %midi_clip_panel_id[11] := get_ui_id($panel_clip11)
  %midi_clip_id[11] := get_ui_id($label_clip11)
  %midi_clip_dnd_id[11] := get_ui_id($label_clip_dnd11)
  %midi_clip_preview_id[11] := get_ui_id($switch_preview11)
  %midi_clip_panel_id[12] := get_ui_id($panel_clip12)
  %midi_clip_id[12] := get_ui_id($label_clip12)
  %midi_clip_dnd_id[12] := get_ui_id($label_clip_dnd12)
  %midi_clip_preview_id[12] := get_ui_id($switch_preview12)
  %midi_clip_panel_id[13] := get_ui_id($panel_clip13)
  %midi_clip_id[13] := get_ui_id($label_clip13)
  %midi_clip_dnd_id[13] := get_ui_id($label_clip_dnd13)
  %midi_clip_preview_id[13] := get_ui_id($switch_preview13)
  %midi_clip_panel_id[14] := get_ui_id($panel_clip14)
  %midi_clip_id[14] := get_ui_id($label_clip14)
  %midi_clip_dnd_id[14] := get_ui_id($label_clip_dnd14)
  %midi_clip_preview_id[14] := get_ui_id($switch_preview14)
  %midi_clip_panel_id[15] := get_ui_id($panel_clip15)
  %midi_clip_id[15] := get_ui_id($label_clip15)
  %midi_clip_dnd_id[15] := get_ui_id($label_clip_dnd15)
  %midi_clip_preview_id[15] := get_ui_id($switch_preview15)
  %midi_clip_panel_id[16] := get_ui_id($panel_clip16)
  %midi_clip_id[16] := get_ui_id($label_clip16)
  %midi_clip_dnd_id[16] := get_ui_id($label_clip_dnd16)
  %midi_clip_preview_id[16] := get_ui_id($switch_preview16)
  %midi_clip_panel_id[17] := get_ui_id($panel_clip17)
  %midi_clip_id[17] := get_ui_id($label_clip17)
  %midi_clip_dnd_id[17] := get_ui_id($label_clip_dnd17)
  %midi_clip_preview_id[17] := get_ui_id($switch_preview17)
  %midi_clip_panel_id[18] := get_ui_id($panel_clip18)
  %midi_clip_id[18] := get_ui_id($label_clip18)
  %midi_clip_dnd_id[18] := get_ui_id($label_clip_dnd18)
  %midi_clip_preview_id[18] := get_ui_id($switch_preview18)
  %midi_clip_panel_id[19] := get_ui_id($panel_clip19)
  %midi_clip_id[19] := get_ui_id($label_clip19)
  %midi_clip_dnd_id[19] := get_ui_id($label_clip_dnd19)
  %midi_clip_preview_id[19] := get_ui_id($switch_preview19)
  %midi_clip_panel_id[20] := get_ui_id($panel_clip20)
  %midi_clip_id[20] := get_ui_id($label_clip20)
  %midi_clip_dnd_id[20] := get_ui_id($label_clip_dnd20)
  %midi_clip_preview_id[20] := get_ui_id($switch_preview20)
  %midi_clip_panel_id[21] := get_ui_id($panel_clip21)
  %midi_clip_id[21] := get_ui_id($label_clip21)
  %midi_clip_dnd_id[21] := get_ui_id($label_clip_dnd21)
  %midi_clip_preview_id[21] := get_ui_id($switch_preview21)
  %midi_clip_panel_id[22] := get_ui_id($panel_clip22)
  %midi_clip_id[22] := get_ui_id($label_clip22)
  %midi_clip_dnd_id[22] := get_ui_id($label_clip_dnd22)
  %midi_clip_preview_id[22] := get_ui_id($switch_preview22)
  %midi_clip_panel_id[23] := get_ui_id($panel_clip23)
  %midi_clip_id[23] := get_ui_id($label_clip23)
  %midi_clip_dnd_id[23] := get_ui_id($label_clip_dnd23)
  %midi_clip_preview_id[23] := get_ui_id($switch_preview23)
  $i := 0
  while ($i<24)
    mf_set_export_area("Ripple Cello",-1,-1,$i,$i)
    mf_copy_export_area($i+1)
    set_control_par(%midi_clip_dnd_id[$i],$CONTROL_PAR_MIDI_EXPORT_AREA_IDX,$i+1)
    set_control_par(%midi_clip_dnd_id[$i],$CONTROL_PAR_DND_BEHAVIOUR,1)
    set_control_par(%midi_clip_preview_id[$i],$CONTROL_PAR_Z_LAYER,1)
    set_control_par(%midi_clip_preview_id[$i],$CONTROL_PAR_CUSTOM_ID,$i)
    set_control_par(%midi_clip_preview_id[$i],$CONTROL_PAR_VALUE,0)
    set_control_par_str(%mf_cursor[$i],$CONTROL_PAR_PICTURE,"mf_cursor")
    set_control_par(%mf_cursor[$i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    set_control_par(%mf_cursor[$i],$CONTROL_PAR_PARENT_PANEL,%midi_clip_panel_id[$i])
    set_control_par(%mf_cursor[$i],$CONTROL_PAR_POS_X,0)
    set_control_par(%mf_cursor[$i],$CONTROL_PAR_POS_Y,0)
    inc($i)
  end while
  $button_showMidi := 0
  set_control_par(get_ui_id($switch_closeMidi),$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  set_control_par(get_ui_id($paneL_midi),$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  $i := 0
  while ($i<2)
    set_control_par(%panel_midiPg[$i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    inc($i)
  end while
  set_control_par(%panel_midiPg[$cur_midi_page],$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  set_control_par(get_ui_id($label_midiInstructions),$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  ~midiInstructions_opacity := real($button_showMidi)
  ~midiCover_opacity := real($button_showMidi)
  set_control_par(get_ui_id($panel_articulations),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_fx),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_speed),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_speed),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_direction),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_direction),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_legato),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_legato),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_releaseSamples),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($button_generalInfo),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($button_optionsInfo),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_midi),$CONTROL_PAR_Z_LAYER,0)
  set_control_par(get_ui_id($switch_generalInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  set_control_par(get_ui_id($switch_articulationsInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  set_control_par(get_ui_id($switch_optionsInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  set_control_par(get_ui_id($switch_speedInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  set_control_par(get_ui_id($switch_directionInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  set_control_par(get_ui_id($switch_legatoInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  set_control_par(get_ui_id($switch_releaseSamplesInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  set_control_par(get_ui_id($switch_generalInfoDisp),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_articulationsInfoDisp),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_optionsInfoDisp),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_speedInfoDisp),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_directionInfoDisp),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_legatoInfoDisp),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_releaseSamplesInfoDisp),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($panel_midiPgChooser),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_midiPgChooser0),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($switch_midiPgChooser1),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($panel_articulations),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($panel_fx),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($panel_speed),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($panel_direction),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($panel_legato),$CONTROL_PAR_Z_LAYER,1)
  set_control_par(get_ui_id($panel_releaseSamples),$CONTROL_PAR_Z_LAYER,1)
  declare %key_ids[128]
  %key_ids[0+$LOWEST_KEY] := get_ui_id($label_oct0__note0)
  %key_ids[0+$LOWEST_KEY+12] := get_ui_id($label_oct1__note0)
  %key_ids[0+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note0)
  %key_ids[1+$LOWEST_KEY] := get_ui_id($label_oct0__note1)
  %key_ids[1+$LOWEST_KEY+12] := get_ui_id($label_oct1__note1)
  %key_ids[1+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note1)
  %key_ids[2+$LOWEST_KEY] := get_ui_id($label_oct0__note2)
  %key_ids[2+$LOWEST_KEY+12] := get_ui_id($label_oct1__note2)
  %key_ids[2+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note2)
  %key_ids[3+$LOWEST_KEY] := get_ui_id($label_oct0__note3)
  %key_ids[3+$LOWEST_KEY+12] := get_ui_id($label_oct1__note3)
  %key_ids[3+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note3)
  %key_ids[4+$LOWEST_KEY] := get_ui_id($label_oct0__note4)
  %key_ids[4+$LOWEST_KEY+12] := get_ui_id($label_oct1__note4)
  %key_ids[4+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note4)
  %key_ids[5+$LOWEST_KEY] := get_ui_id($label_oct0__note5)
  %key_ids[5+$LOWEST_KEY+12] := get_ui_id($label_oct1__note5)
  %key_ids[5+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note5)
  %key_ids[6+$LOWEST_KEY] := get_ui_id($label_oct0__note6)
  %key_ids[6+$LOWEST_KEY+12] := get_ui_id($label_oct1__note6)
  %key_ids[6+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note6)
  %key_ids[7+$LOWEST_KEY] := get_ui_id($label_oct0__note7)
  %key_ids[7+$LOWEST_KEY+12] := get_ui_id($label_oct1__note7)
  %key_ids[7+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note7)
  %key_ids[8+$LOWEST_KEY] := get_ui_id($label_oct0__note8)
  %key_ids[8+$LOWEST_KEY+12] := get_ui_id($label_oct1__note8)
  %key_ids[8+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note8)
  %key_ids[9+$LOWEST_KEY] := get_ui_id($label_oct0__note9)
  %key_ids[9+$LOWEST_KEY+12] := get_ui_id($label_oct1__note9)
  %key_ids[9+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note9)
  %key_ids[10+$LOWEST_KEY] := get_ui_id($label_oct0__note10)
  %key_ids[10+$LOWEST_KEY+12] := get_ui_id($label_oct1__note10)
  %key_ids[10+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note10)
  %key_ids[11+$LOWEST_KEY] := get_ui_id($label_oct0__note11)
  %key_ids[11+$LOWEST_KEY+12] := get_ui_id($label_oct1__note11)
  %key_ids[11+$LOWEST_KEY+(12*2)] := get_ui_id($label_oct2__note11)
  %key_ids[72] := get_ui_id($label_oct2__note12)
  $key_i := $LOWEST_KEY
  while ($key_i<=$HIGHEST_KEY)
    set_control_par(%key_ids[$key_i],$CONTROL_PAR_VALUE,0)
    inc($key_i)
  end while
  declare !reverb_preset_names[3]
  !reverb_preset_names[0] := "Small"
  !reverb_preset_names[1] := "Medium"
  !reverb_preset_names[2] := "Large"
  declare %_reverb_preset[3*8]
  make_persistent(%_reverb_preset)
  read_persistent_var(%_reverb_preset)
  declare const $reverb_preset__SIZE_D1 := 3
  declare const $reverb_preset__SIZE_D2 := 8
  $i := 0
  while ($i<3)
    add_menu_item($menu_reverb,!reverb_preset_names[$i],$i)
    inc($i)
  end while
  add_menu_item($menu_reverb,"save preset",3)
  declare $prev_reverb
  make_persistent($prev_reverb)
  read_persistent_var($prev_reverb)
  $prev_reverb := $menu_reverb
  if (%dev_mode[0]=0)
    set_menu_item_visibility(get_ui_id($menu_reverb),3,0)
  end if
  set_control_par(get_ui_id($label_reverb),$CONTROL_PAR_TEXT_ALIGNMENT,1)
  set_control_par(get_ui_id($label_vol),$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 on"))
  set_control_par(get_ui_id($label_reverb),$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 on"))
  declare %articulation_ids[$NUM_ARTICULATIONS]
  %articulation_ids[0] := get_ui_id($switch_quarters)
  %articulation_ids[1] := get_ui_id($switch_eighths)
  %articulation_ids[2] := get_ui_id($switch_sixteenths)
  $i := 0
  while ($i<$NUM_ARTICULATIONS)
    set_control_par(%articulation_ids[$i],$CONTROL_PAR_ALLOW_AUTOMATION,0)
    inc($i)
  end while
  declare %speed_ids[5]
  %speed_ids[0] := get_ui_id($switch_halfSpeed)
  %speed_ids[1] := get_ui_id($switch_slowTripletSpeed)
  %speed_ids[2] := get_ui_id($switch_fullSpeed)
  %speed_ids[3] := get_ui_id($switch_fastTripletSpeed)
  %speed_ids[4] := get_ui_id($switch_doubleSpeed)
  $i := 0
  while ($i<num_elements(%speed_ids))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 off"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_ON,get_font_id("Khula Bold Size 11 on"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_PRESSED,get_font_id("Khula Bold Size 11 off pressed"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_PRESSED,get_font_id("Khula Bold Size 11 on pressed"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_HOVER,get_font_id("Khula Bold Size 11 off hover"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_HOVER,get_font_id("Khula Bold Size 11 on hover"))
    set_control_par_str(%speed_ids[$i],$CONTROL_PAR_TEXT,!speed_texts[$i])
    set_control_par(%speed_ids[$i],$CONTROL_PAR_WIDTH,get_control_par(%speed_ids[$i],$CONTROL_PAR_WIDTH)+14)
    set_control_par(%speed_ids[$i],$CONTROL_PAR_CUSTOM_ID,0)
    inc($i)
  end while
  set_control_par_str(get_ui_id($switch_up),$CONTROL_PAR_TEXT,"Up")
  set_control_par_str(get_ui_id($switch_down),$CONTROL_PAR_TEXT,"Down")
  set_control_par_str(get_ui_id($switch_asPlayed),$CONTROL_PAR_TEXT,"As Played")
  declare %direction_ids[$DIRECTION_MODE__SIZE]
  %direction_ids[0] := get_ui_id($switch_down)
  %direction_ids[1] := get_ui_id($switch_asPlayed)
  %direction_ids[2] := get_ui_id($switch_up)
  $i := 0
  while ($i<num_elements(%direction_ids))
    set_control_par(%direction_ids[$i],$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 off"))
    set_control_par(%direction_ids[$i],$CONTROL_PAR_FONT_TYPE_ON,get_font_id("Khula Bold Size 11 on"))
    set_control_par(%direction_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_PRESSED,get_font_id("Khula Bold Size 11 off pressed"))
    set_control_par(%direction_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_PRESSED,get_font_id("Khula Bold Size 11 on pressed"))
    set_control_par(%direction_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_HOVER,get_font_id("Khula Bold Size 11 off hover"))
    set_control_par(%direction_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_HOVER,get_font_id("Khula Bold Size 11 on hover"))
    set_control_par(%direction_ids[$i],$CONTROL_PAR_CUSTOM_ID,1)
    inc($i)
  end while
  set_control_par(get_ui_id($switch_down),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_down),$CONTROL_PAR_WIDTH)+13)
  set_control_par(get_ui_id($switch_asPlayed),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_asPlayed),$CONTROL_PAR_WIDTH)+19)
  set_control_par(get_ui_id($switch_up),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_up),$CONTROL_PAR_WIDTH)+7)
  set_control_par_str(get_ui_id($switch_noLegato),$CONTROL_PAR_TEXT,"Off")
  set_control_par_str(get_ui_id($switch_syncToPitch),$CONTROL_PAR_TEXT,"Pitch")
  set_control_par_str(get_ui_id($switch_syncToRipple),$CONTROL_PAR_TEXT,"Ripple")
  set_control_par_str(get_ui_id($switch_syncToSwell),$CONTROL_PAR_TEXT,"Swell")
  declare %legato_ids[$LEGATO_MODE__SIZE]
  %legato_ids[0] := get_ui_id($switch_noLegato)
  %legato_ids[1] := get_ui_id($switch_syncToPitch)
  %legato_ids[2] := get_ui_id($switch_syncToRipple)
  %legato_ids[3] := get_ui_id($switch_syncToSwell)
  $i := 0
  while ($i<num_elements(%legato_ids))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 off"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_ON,get_font_id("Khula Bold Size 11 on"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_PRESSED,get_font_id("Khula Bold Size 11 off pressed"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_PRESSED,get_font_id("Khula Bold Size 11 on pressed"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_HOVER,get_font_id("Khula Bold Size 11 off hover"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_HOVER,get_font_id("Khula Bold Size 11 on hover"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_CUSTOM_ID,2)
    inc($i)
  end while
  declare %releaseSamples_ids[$RELEASE_SAMPLES__SIZE]
  %releaseSamples_ids[0] := get_ui_id($switch_releaseSamples__off)
  %releaseSamples_ids[1] := get_ui_id($switch_releaseSamples__soft)
  %releaseSamples_ids[2] := get_ui_id($switch_releaseSamples__loud)
  $i := 0
  while ($i<num_elements(%releaseSamples_ids))
    set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 off"))
    set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_FONT_TYPE_ON,get_font_id("Khula Bold Size 11 on"))
    set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_PRESSED,get_font_id("Khula Bold Size 11 off pressed"))
    set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_PRESSED,get_font_id("Khula Bold Size 11 on pressed"))
    set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_HOVER,get_font_id("Khula Bold Size 11 off hover"))
    set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_HOVER,get_font_id("Khula Bold Size 11 on hover"))
    set_control_par_str(%releaseSamples_ids[$i],$CONTROL_PAR_TEXT,!releaseSamples_texts[$i])
    set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_CUSTOM_ID,3)
    inc($i)
  end while
  set_control_par(get_ui_id($switch_releaseSamples__off),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_releaseSamples__off),$CONTROL_PAR_WIDTH)+14)
  set_control_par(get_ui_id($switch_releaseSamples__soft),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_releaseSamples__soft),$CONTROL_PAR_WIDTH)+14)
  set_control_par(get_ui_id($switch_releaseSamples__loud),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_releaseSamples__loud),$CONTROL_PAR_WIDTH)+14)
  set_control_par(get_ui_id($switch_releaseTrigger),$CONTROL_PAR_ALLOW_AUTOMATION,0)
  set_control_par(get_ui_id($slider_speed),$CONTROL_PAR_MOUSE_BEHAVIOUR,2000)
  set_control_par(get_ui_id($slider_direction),$CONTROL_PAR_MOUSE_BEHAVIOUR,2000)
  set_control_par(get_ui_id($slider_legato),$CONTROL_PAR_MOUSE_BEHAVIOUR,2000)
  set_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_MOUSE_BEHAVIOUR,2000)
  $c := 0
  set_control_par(get_ui_id($slider_VOL),$CONTROL_PAR_CUSTOM_ID,$c)
  %ctrl_ids[$c] := get_ui_id($slider_VOL)
  inc($c)
  set_control_par(get_ui_id($slider_REVERB),$CONTROL_PAR_CUSTOM_ID,$c)
  %ctrl_ids[$c] := get_ui_id($slider_REVERB)
  inc($c)
  set_control_par(get_ui_id($slider_SPEED),$CONTROL_PAR_CUSTOM_ID,$c)
  %ctrl_ids[$c] := get_ui_id($slider_SPEED)
  inc($c)
  set_control_par(get_ui_id($slider_DIRECTION),$CONTROL_PAR_CUSTOM_ID,$c)
  %ctrl_ids[$c] := get_ui_id($slider_DIRECTION)
  inc($c)
  set_control_par(get_ui_id($slider_LEGATO),$CONTROL_PAR_CUSTOM_ID,$c)
  %ctrl_ids[$c] := get_ui_id($slider_LEGATO)
  inc($c)
  set_control_par(get_ui_id($slider_RELEASESAMPLES),$CONTROL_PAR_CUSTOM_ID,$c)
  %ctrl_ids[$c] := get_ui_id($slider_RELEASESAMPLES)
  inc($c)
  $c := 2
  $i := 0
  while ($i<num_elements(!SPEED_texts))
    !_option_texts[10*$c+$i] := !SPEED_texts[$i]
    inc($i)
  end while
  inc($c)
  $i := 0
  while ($i<num_elements(!DIRECTION_texts))
    !_option_texts[10*$c+$i] := !DIRECTION_texts[$i]
    inc($i)
  end while
  inc($c)
  $i := 0
  while ($i<num_elements(!LEGATO_texts))
    !_option_texts[10*$c+$i] := !LEGATO_texts[$i]
    inc($i)
  end while
  inc($c)
  $i := 0
  while ($i<num_elements(!RELEASESAMPLES_texts))
    !_option_texts[10*$c+$i] := !RELEASESAMPLES_texts[$i]
    inc($i)
  end while
  inc($c)
  $array_i := 0
  while ($array_i<num_elements(!_option_texts))
    !_option_texts_shortened[$array_i] := !_option_texts[$array_i]
    inc($array_i)
  end while
  !_option_texts_shortened[10*get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)+0] := "Off"
  !_option_texts_shortened[10*get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)+1] := "Pitch"
  !_option_texts_shortened[10*get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)+2] := "Ripple"
  !_option_texts_shortened[10*get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)+3] := "Swell"
  set_control_par(get_ui_id($slider_speed),$CONTROL_PAR_DEFAULT_VALUE,2)
  set_control_par(get_ui_id($slider_direction),$CONTROL_PAR_DEFAULT_VALUE,1)
  set_control_par(get_ui_id($slider_legato),$CONTROL_PAR_DEFAULT_VALUE,0)
  set_control_par(get_ui_id($slider_vol),$CONTROL_PAR_DEFAULT_VALUE,500000)
  set_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_DEFAULT_VALUE,500000)
  set_control_par(get_ui_id($menu_reverb),$CONTROL_PAR_TEXTPOS_Y,100)
  set_voice_limit($NI_VL_TMPRO_STANDARD,100)
  declare %ripple[100]
  declare ui_slider $ripple0(0,127)
  declare ui_slider $ripple1(0,127)
  declare ui_slider $ripple2(0,127)
  declare ui_slider $ripple3(0,127)
  declare ui_slider $ripple4(0,127)
  declare ui_slider $ripple5(0,127)
  declare ui_slider $ripple6(0,127)
  declare ui_slider $ripple7(0,127)
  declare ui_slider $ripple8(0,127)
  declare ui_slider $ripple9(0,127)
  declare ui_slider $ripple10(0,127)
  declare ui_slider $ripple11(0,127)
  declare ui_slider $ripple12(0,127)
  declare ui_slider $ripple13(0,127)
  declare ui_slider $ripple14(0,127)
  declare ui_slider $ripple15(0,127)
  declare ui_slider $ripple16(0,127)
  declare ui_slider $ripple17(0,127)
  declare ui_slider $ripple18(0,127)
  declare ui_slider $ripple19(0,127)
  declare ui_slider $ripple20(0,127)
  declare ui_slider $ripple21(0,127)
  declare ui_slider $ripple22(0,127)
  declare ui_slider $ripple23(0,127)
  declare ui_slider $ripple24(0,127)
  declare ui_slider $ripple25(0,127)
  declare ui_slider $ripple26(0,127)
  declare ui_slider $ripple27(0,127)
  declare ui_slider $ripple28(0,127)
  declare ui_slider $ripple29(0,127)
  declare ui_slider $ripple30(0,127)
  declare ui_slider $ripple31(0,127)
  declare ui_slider $ripple32(0,127)
  declare ui_slider $ripple33(0,127)
  declare ui_slider $ripple34(0,127)
  declare ui_slider $ripple35(0,127)
  declare ui_slider $ripple36(0,127)
  declare ui_slider $ripple37(0,127)
  declare ui_slider $ripple38(0,127)
  declare ui_slider $ripple39(0,127)
  declare ui_slider $ripple40(0,127)
  declare ui_slider $ripple41(0,127)
  declare ui_slider $ripple42(0,127)
  declare ui_slider $ripple43(0,127)
  declare ui_slider $ripple44(0,127)
  declare ui_slider $ripple45(0,127)
  declare ui_slider $ripple46(0,127)
  declare ui_slider $ripple47(0,127)
  declare ui_slider $ripple48(0,127)
  declare ui_slider $ripple49(0,127)
  declare ui_slider $ripple50(0,127)
  declare ui_slider $ripple51(0,127)
  declare ui_slider $ripple52(0,127)
  declare ui_slider $ripple53(0,127)
  declare ui_slider $ripple54(0,127)
  declare ui_slider $ripple55(0,127)
  declare ui_slider $ripple56(0,127)
  declare ui_slider $ripple57(0,127)
  declare ui_slider $ripple58(0,127)
  declare ui_slider $ripple59(0,127)
  declare ui_slider $ripple60(0,127)
  declare ui_slider $ripple61(0,127)
  declare ui_slider $ripple62(0,127)
  declare ui_slider $ripple63(0,127)
  declare ui_slider $ripple64(0,127)
  declare ui_slider $ripple65(0,127)
  declare ui_slider $ripple66(0,127)
  declare ui_slider $ripple67(0,127)
  declare ui_slider $ripple68(0,127)
  declare ui_slider $ripple69(0,127)
  declare ui_slider $ripple70(0,127)
  declare ui_slider $ripple71(0,127)
  declare ui_slider $ripple72(0,127)
  declare ui_slider $ripple73(0,127)
  declare ui_slider $ripple74(0,127)
  declare ui_slider $ripple75(0,127)
  declare ui_slider $ripple76(0,127)
  declare ui_slider $ripple77(0,127)
  declare ui_slider $ripple78(0,127)
  declare ui_slider $ripple79(0,127)
  declare ui_slider $ripple80(0,127)
  declare ui_slider $ripple81(0,127)
  declare ui_slider $ripple82(0,127)
  declare ui_slider $ripple83(0,127)
  declare ui_slider $ripple84(0,127)
  declare ui_slider $ripple85(0,127)
  declare ui_slider $ripple86(0,127)
  declare ui_slider $ripple87(0,127)
  declare ui_slider $ripple88(0,127)
  declare ui_slider $ripple89(0,127)
  declare ui_slider $ripple90(0,127)
  declare ui_slider $ripple91(0,127)
  declare ui_slider $ripple92(0,127)
  declare ui_slider $ripple93(0,127)
  declare ui_slider $ripple94(0,127)
  declare ui_slider $ripple95(0,127)
  declare ui_slider $ripple96(0,127)
  declare ui_slider $ripple97(0,127)
  declare ui_slider $ripple98(0,127)
  declare ui_slider $ripple99(0,127)
  $preproc_i := 0
  while ($preproc_i<=99)
    %ripple[$preproc_i] := get_ui_id($ripple0)+$preproc_i
    inc($preproc_i)
  end while
  $i := 0
  while ($i<num_elements(%ripple))
    set_control_par(%ripple[$i],$CONTROL_PAR_Z_LAYER,-1)
    set_control_par(%ripple[$i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    inc($i)
  end while
  declare %ripple_swell[100]
  declare ui_slider $ripple_swell0(0,127)
  declare ui_slider $ripple_swell1(0,127)
  declare ui_slider $ripple_swell2(0,127)
  declare ui_slider $ripple_swell3(0,127)
  declare ui_slider $ripple_swell4(0,127)
  declare ui_slider $ripple_swell5(0,127)
  declare ui_slider $ripple_swell6(0,127)
  declare ui_slider $ripple_swell7(0,127)
  declare ui_slider $ripple_swell8(0,127)
  declare ui_slider $ripple_swell9(0,127)
  declare ui_slider $ripple_swell10(0,127)
  declare ui_slider $ripple_swell11(0,127)
  declare ui_slider $ripple_swell12(0,127)
  declare ui_slider $ripple_swell13(0,127)
  declare ui_slider $ripple_swell14(0,127)
  declare ui_slider $ripple_swell15(0,127)
  declare ui_slider $ripple_swell16(0,127)
  declare ui_slider $ripple_swell17(0,127)
  declare ui_slider $ripple_swell18(0,127)
  declare ui_slider $ripple_swell19(0,127)
  declare ui_slider $ripple_swell20(0,127)
  declare ui_slider $ripple_swell21(0,127)
  declare ui_slider $ripple_swell22(0,127)
  declare ui_slider $ripple_swell23(0,127)
  declare ui_slider $ripple_swell24(0,127)
  declare ui_slider $ripple_swell25(0,127)
  declare ui_slider $ripple_swell26(0,127)
  declare ui_slider $ripple_swell27(0,127)
  declare ui_slider $ripple_swell28(0,127)
  declare ui_slider $ripple_swell29(0,127)
  declare ui_slider $ripple_swell30(0,127)
  declare ui_slider $ripple_swell31(0,127)
  declare ui_slider $ripple_swell32(0,127)
  declare ui_slider $ripple_swell33(0,127)
  declare ui_slider $ripple_swell34(0,127)
  declare ui_slider $ripple_swell35(0,127)
  declare ui_slider $ripple_swell36(0,127)
  declare ui_slider $ripple_swell37(0,127)
  declare ui_slider $ripple_swell38(0,127)
  declare ui_slider $ripple_swell39(0,127)
  declare ui_slider $ripple_swell40(0,127)
  declare ui_slider $ripple_swell41(0,127)
  declare ui_slider $ripple_swell42(0,127)
  declare ui_slider $ripple_swell43(0,127)
  declare ui_slider $ripple_swell44(0,127)
  declare ui_slider $ripple_swell45(0,127)
  declare ui_slider $ripple_swell46(0,127)
  declare ui_slider $ripple_swell47(0,127)
  declare ui_slider $ripple_swell48(0,127)
  declare ui_slider $ripple_swell49(0,127)
  declare ui_slider $ripple_swell50(0,127)
  declare ui_slider $ripple_swell51(0,127)
  declare ui_slider $ripple_swell52(0,127)
  declare ui_slider $ripple_swell53(0,127)
  declare ui_slider $ripple_swell54(0,127)
  declare ui_slider $ripple_swell55(0,127)
  declare ui_slider $ripple_swell56(0,127)
  declare ui_slider $ripple_swell57(0,127)
  declare ui_slider $ripple_swell58(0,127)
  declare ui_slider $ripple_swell59(0,127)
  declare ui_slider $ripple_swell60(0,127)
  declare ui_slider $ripple_swell61(0,127)
  declare ui_slider $ripple_swell62(0,127)
  declare ui_slider $ripple_swell63(0,127)
  declare ui_slider $ripple_swell64(0,127)
  declare ui_slider $ripple_swell65(0,127)
  declare ui_slider $ripple_swell66(0,127)
  declare ui_slider $ripple_swell67(0,127)
  declare ui_slider $ripple_swell68(0,127)
  declare ui_slider $ripple_swell69(0,127)
  declare ui_slider $ripple_swell70(0,127)
  declare ui_slider $ripple_swell71(0,127)
  declare ui_slider $ripple_swell72(0,127)
  declare ui_slider $ripple_swell73(0,127)
  declare ui_slider $ripple_swell74(0,127)
  declare ui_slider $ripple_swell75(0,127)
  declare ui_slider $ripple_swell76(0,127)
  declare ui_slider $ripple_swell77(0,127)
  declare ui_slider $ripple_swell78(0,127)
  declare ui_slider $ripple_swell79(0,127)
  declare ui_slider $ripple_swell80(0,127)
  declare ui_slider $ripple_swell81(0,127)
  declare ui_slider $ripple_swell82(0,127)
  declare ui_slider $ripple_swell83(0,127)
  declare ui_slider $ripple_swell84(0,127)
  declare ui_slider $ripple_swell85(0,127)
  declare ui_slider $ripple_swell86(0,127)
  declare ui_slider $ripple_swell87(0,127)
  declare ui_slider $ripple_swell88(0,127)
  declare ui_slider $ripple_swell89(0,127)
  declare ui_slider $ripple_swell90(0,127)
  declare ui_slider $ripple_swell91(0,127)
  declare ui_slider $ripple_swell92(0,127)
  declare ui_slider $ripple_swell93(0,127)
  declare ui_slider $ripple_swell94(0,127)
  declare ui_slider $ripple_swell95(0,127)
  declare ui_slider $ripple_swell96(0,127)
  declare ui_slider $ripple_swell97(0,127)
  declare ui_slider $ripple_swell98(0,127)
  declare ui_slider $ripple_swell99(0,127)
  $preproc_i := 0
  while ($preproc_i<=99)
    %ripple_swell[$preproc_i] := get_ui_id($ripple_swell0)+$preproc_i
    inc($preproc_i)
  end while
  $i := 0
  while ($i<num_elements(%ripple_swell))
    set_control_par(%ripple_swell[$i],$CONTROL_PAR_Z_LAYER,-1)
    set_control_par(%ripple_swell[$i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    inc($i)
  end while
  set_control_par(get_ui_id($slider_vol),$CONTROL_PAR_AUTOMATION_ID,0)
  set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_AUTOMATION_NAME,"Expression")
  set_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_AUTOMATION_ID,1)
  set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_AUTOMATION_NAME,"Reverb")
  set_control_par(get_ui_id($slider_speed),$CONTROL_PAR_AUTOMATION_ID,2)
  set_control_par_str(get_ui_id($slider_speed),$CONTROL_PAR_AUTOMATION_NAME,"Speed")
  set_control_par(get_ui_id($slider_direction),$CONTROL_PAR_AUTOMATION_ID,3)
  set_control_par_str(get_ui_id($slider_direction),$CONTROL_PAR_AUTOMATION_NAME,"Direction")
  set_control_par(get_ui_id($slider_legato),$CONTROL_PAR_AUTOMATION_ID,4)
  set_control_par_str(get_ui_id($slider_legato),$CONTROL_PAR_AUTOMATION_NAME,"Legato/Quantize")
  set_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_AUTOMATION_ID,5)
  set_control_par_str(get_ui_id($slider_releaseSamples),$CONTROL_PAR_AUTOMATION_NAME,"Release Samples")
  set_engine_par($ENGINE_PAR_SPEED,1000000-((18*2-1)*90909),$ARTIC__QUARTERS,-1,-1)
  set_engine_par($ENGINE_PAR_SPEED,1000000-((18-1)*90909),$ARTIC__EIGHTHS,-1,-1)
  set_engine_par($ENGINE_PAR_SPEED,1000000-((18-1)*90909),$ARTIC__SIXTEENTHS,-1,-1)
  set_engine_par($ENGINE_PAR_SPEED,1000000-((12-1)*90909),get_group_idx("quarters releases"),-1,-1)
  set_engine_par($ENGINE_PAR_SPEED,1000000-((12-1)*90909),get_group_idx("eighths releases"),-1,-1)
  declare $_index2
  declare %_event_ids[128]
  declare $_e
  declare $_other_clip_i
  declare $_ticks_until_next_event
  declare $_note
  declare $_velocity
  declare $_length
  declare $_note_id4
  declare $_cc_num
  declare ~_vol
  declare ~_db
  declare $_prev_cc64
  declare $_i2
  declare $_r3
  declare $_artic4
  declare $_rec_time_pos_in_ripple
  declare $_real_time_pos_in_pulse
  declare $_real_time_ripple_length
  declare $_time_til_end_of_ripple
  declare $_play_release_sample
  declare $_fade_out_time2
  declare $_history_index
  declare $_ks_index
  declare %_notes[64]
  declare %_intervals[64]
  declare %_played_notes[64]
  declare %_played_intervals[64]
  declare %__notes[12]
  declare %__intervals[12]
  declare $_num_ripples := 0
  declare $_closest_neighbor := -1
  declare $_closest_neighbor_interval := 12
  declare %_neighbor[12]
  declare %_lower_neighbor[12]
  declare %_upper_neighbor[12]
  declare $_num_neighbors := 0
  declare $_num_lower_neighbors := 0
  declare $_num_upper_neighbors := 0
  declare $_dir
  declare $_sign
  declare $_other_note
  declare $_lower_neighbor_time_held
  declare $_upper_neighbor_time_held
  declare $_make_ripples_to_both_adjacent_neighbors
  declare $_ripple_i
  declare $_low_note2
  declare $_high_note2
  declare $_already_playing := 0
  declare $_offset_real_time
  declare $_do_legato := 0
  declare $_real_legato_time := 0
  declare $_offset_rec_time
  declare $_note_id3
  declare $_volume
  declare $_real_time_pos_in_ripple
  declare $_fade_in_time
  declare $_artic3
  declare $_offset2
  declare $_note_id2
  declare $_time_since_note_off3
  declare $_artic2
  declare $_vol
  declare $_offset := 50000
  declare $_play_pos
  declare $_cur_ripple
  declare $_vel
  declare $_fade_out_time
  declare $_sample_start
  declare $__vel
  declare $_release_sample_length
  declare $_atk_time
  declare $_dec_time
  declare $_note_id
  declare $_time_played
  declare $_clip_length_ms
  declare $_low_note
  declare $_high_note
  declare $_direction
  declare $_interval
  declare $_artic
  declare ~_speed_curve
  declare ~_brightness_curve
  declare $_row
  declare $_play_pos_in_beat
  declare $_pos_in_swell
  declare $_time_since_note_off2
  declare $_release_length
  declare $_brightness_on_release
  declare $_key_i2
  declare $_found2 := 0
  declare $_r2
  declare $_time_since_note_off
  declare $_index
  declare $_hist_i
  declare $_note_found := 0
  declare @_checkmark
  declare $_i
  declare $_key_i
  declare $_ui_id
end on

function set_key_colors_and_types_and_names
  $key_i := 0
  while ($key_i<=127)
    set_key_color($key_i,$KEY_COLOR_BLACK)
    if (search(%black_keys,$key_i mod 12) # -1)
      set_key_color($key_i,$KEY_COLOR_WHITE)
    end if
    set_key_type($key_i,$NI_KEY_TYPE_NONE)
    set_key_name($key_i,"")
    $_index := search(%articulation_keyswitches,$key_i)
    if ($_index # -1)
      set_key_color($key_i,$KEY_COLOR_RED)
      set_key_name($key_i,!articulation_texts[$_index])
      set_key_type($key_i,$NI_KEY_TYPE_CONTROL)
    end if
    if (in_range($key_i,$LOWEST_KEY,$HIGHEST_KEY))
      set_key_color($key_i,$KEY_COLOR_DEFAULT)
      set_key_type($key_i,$NI_KEY_TYPE_DEFAULT)
    end if
    $_index := search(%speed_keyswitches,$key_i)
    if ($_index # -1)
      set_key_color($key_i,$KEY_COLOR_GREEN)
      set_key_name($key_i,!speed_texts[$_index])
      set_key_type($key_i,$NI_KEY_TYPE_CONTROL)
    end if
    $_index := search(%direction_keyswitches,$key_i)
    if ($_index # -1)
      set_key_color($key_i,$KEY_COLOR_YELLOW)
      set_key_name($key_i,!direction_texts[$_index])
      set_key_type($key_i,$NI_KEY_TYPE_CONTROL)
    end if
    $_index := search(%legato_keyswitches,$key_i)
    if ($_index # -1)
      set_key_color($key_i,$KEY_COLOR_PURPLE)
      set_key_name($key_i,!legato_texts[$_index])
      set_key_type($key_i,$NI_KEY_TYPE_CONTROL)
    end if
    $_index := search(%release_sample_keyswitches,$key_i)
    if ($_index # -1)
      set_key_color($key_i,$KEY_COLOR_ORANGE)
      set_key_name($key_i,!releaseSamples_texts[$_index])
      set_key_type($key_i,$NI_KEY_TYPE_CONTROL)
    end if
    $_index := search(%release_trigger_keyswitches,$key_i)
    if ($_index # -1)
      set_key_color($key_i,$KEY_COLOR_MINT)
      set_key_name($key_i,"Release Trigger Key")
      set_key_type($key_i,$NI_KEY_TYPE_CONTROL)
    end if
    inc($key_i)
  end while
end function

function set_keys_pressed
  $i := 0
  while ($i<$NUM_ARTICULATIONS)
    if ($i=$cur_artic)
      set_key_pressed(%articulation_keyswitches[$i],1)
    else
      set_key_pressed(%articulation_keyswitches[$i],0)
    end if
    inc($i)
  end while
  $i := 0
  while ($i<5)
    if ($i=$slider_speed)
      set_key_pressed(%speed_keyswitches[$i],1)
    else
      set_key_pressed(%speed_keyswitches[$i],0)
    end if
    inc($i)
  end while
  $i := 0
  while ($i<$DIRECTION_MODE__SIZE)
    if ($i=$slider_direction)
      set_key_pressed(%direction_keyswitches[$i],1)
    else
      set_key_pressed(%direction_keyswitches[$i],0)
    end if
    inc($i)
  end while
  $i := 0
  while ($i<$LEGATO_MODE__SIZE)
    if ($i=$slider_legato)
      set_key_pressed(%legato_keyswitches[$i],1)
    else
      set_key_pressed(%legato_keyswitches[$i],0)
    end if
    inc($i)
  end while
  $i := 0
  while ($i<$RELEASE_SAMPLES__SIZE)
    if ($i=$slider_releaseSamples)
      set_key_pressed(%release_sample_keyswitches[$i],1)
    else
      set_key_pressed(%release_sample_keyswitches[$i],0)
    end if
    inc($i)
  end while
end function

function set_reverb_menu_checkmark
  $_i := 0
  while ($_i<3)
    if ($_i=$menu_reverb)
      @_checkmark := " x "
    else
      @_checkmark := "    "
    end if
    set_menu_item_str(get_ui_id($menu_reverb),$_i,@_checkmark & !reverb_preset_names[$_i])
    inc($_i)
  end while
end function

function remove_ripple_ids_from_history_after_they_have_faded_out
  $r := 0
  while ($r<100)
    if (event_status(%ripple_id_history[$r])=$EVENT_STATUS_INACTIVE and (%ripple_id_history[$r] # 0))
      set_control_par(%ripple[$r],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
      $hist_i := $r
      while ($hist_i<=(100-2))
        %ripple_id_history[$hist_i] := %ripple_id_history[$hist_i+1]
        inc($hist_i)
      end while
    end if
    inc($r)
  end while
end function

function ripple_animations
  $r := 0
  while ($r<100)
    if (%ripple_id_history[$r]=0)
      set_control_par(%ripple[$r],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
      set_control_par(%ripple_swell[$r],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    end if
    inc($r)
  end while
  $r := 100-1
  while ($r>=0)
    if (%custom_event_releasing[%ripple_id_history[$r] mod 1000000]=0)
      if (event_status(%ripple_id_history[$r])=$EVENT_STATUS_NOTE_QUEUE)
        $_low_note := %custom_event_low_note[%ripple_id_history[$r] mod 1000000]
        $_high_note := %custom_event_high_note[%ripple_id_history[$r] mod 1000000]
        $_direction := %custom_event_direction[%ripple_id_history[$r] mod 1000000]
        $_interval := ($_high_note-$_low_note)*($_direction*2-1)
        $_artic := %custom_event_artic[%ripple_id_history[$r] mod 1000000]
        if ($_artic=$ARTIC__QUARTERS)
          ~_speed_curve := 1.0
          ~_brightness_curve := 5.0
        else
          if ($_artic=$ARTIC__EIGHTHS)
            ~_speed_curve := 1.5
            ~_brightness_curve := 2.0
          else
            if ($_artic=$ARTIC__SIXTEENTHS)
              ~_speed_curve := 0.75
              ~_brightness_curve := 2.0
            end if
          end if
        end if
        $_row := %custom_event_row[%ripple_id_history[$r] mod 1000000]
        set_control_par(%ripple[$r],$CONTROL_PAR_POS_X,get_control_par(get_ui_id($panel_keyboard),$CONTROL_PAR_POS_X)+get_control_par(%key_ids[$_low_note],$CONTROL_PAR_POS_X)+(get_control_par(%key_ids[$_low_note],$CONTROL_PAR_WIDTH)/2))
        if ($_interval<0)
          set_control_par(%ripple[$r],$CONTROL_PAR_POS_Y,get_control_par(get_ui_id($panel_keyboard),$CONTROL_PAR_POS_Y)-((22*abs($_interval)+1)/2)-1)
        else
          set_control_par(%ripple[$r],$CONTROL_PAR_POS_Y,get_control_par(get_ui_id($panel_keyboard),$CONTROL_PAR_POS_Y)+get_control_par(%key_ids[$LOWEST_KEY],$CONTROL_PAR_HEIGHT)-((22*abs($_interval)+1)/2))
        end if
        set_control_par_str(%ripple[$r],$CONTROL_PAR_PICTURE,"ripple " & $_interval)
        $_play_pos_in_beat := get_event_par(%ripple_id_history[$r],$EVENT_PAR_PLAY_POS) mod %rec_time_ripple_lengths[$_artic]
        set_control_par(%ripple[$r],$CONTROL_PAR_VALUE,int(real(0)+((real($_play_pos_in_beat)-real(0))/(real(%rec_time_ripple_lengths[$_artic])-real(0))*(real(127)-real(0)))))
        set_control_par(%ripple[$r],$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
        set_control_par(%ripple_swell[$r],$CONTROL_PAR_POS_X,get_control_par(%ripple[$r],$CONTROL_PAR_POS_X))
        set_control_par(%ripple_swell[$r],$CONTROL_PAR_POS_Y,get_control_par(%ripple[$r],$CONTROL_PAR_POS_Y))
        set_control_par_str(%ripple_swell[$r],$CONTROL_PAR_PICTURE,"ripple swell " & $_interval)
        $_pos_in_swell := get_event_par(%ripple_id_history[$r],$EVENT_PAR_PLAY_POS) mod %rec_time_sample_lengths[$_artic]
        if (in_range($_pos_in_swell,0,%rec_time_sample_lengths[$_artic]/2))
          set_control_par(%ripple_swell[$r],$CONTROL_PAR_VALUE,int(real(0)+((real($_pos_in_swell)-real(0))/(real(%rec_time_sample_lengths[$_artic]/2)-real(0))*(real(64)-real(0)))))
        else
          set_control_par(%ripple_swell[$r],$CONTROL_PAR_VALUE,int(real(64)+((real($_pos_in_swell)-real(%rec_time_sample_lengths[$_artic]/2))/(real(%rec_time_sample_lengths[$_artic])-real(%rec_time_sample_lengths[$_artic]/2))*(real(0)-real(64)))))
        end if
        set_control_par(%ripple_swell[$r],$CONTROL_PAR_HIDE,get_control_par(%ripple[$r],$CONTROL_PAR_HIDE))
        set_control_par(%ripple_swell[$r],$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
        %custom_event_brightness_on_release[%ripple_id_history[$r] mod 1000000] := get_control_par(%ripple_swell[$r],$CONTROL_PAR_VALUE)
      end if
    else
      if (%custom_event_releasing[%ripple_id_history[$r] mod 1000000]=1)
        set_control_par(%ripple[$r],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
        if (get_control_par(%ripple_swell[$r],$CONTROL_PAR_VALUE)>0)
          $_time_since_note_off2 := $ENGINE_UPTIME-%custom_event_note_off_timestamp[%ripple_id_history[$r] mod 1000000]
          $_release_length := %custom_event_release_sample_length[%ripple_id_history[$r] mod 1000000]/1000
          $_brightness_on_release := %custom_event_brightness_on_release[%ripple_id_history[$r] mod 1000000]
          if ($_release_length=0)
            $_release_length := 1
          end if
          if ($_brightness_on_release=0)
            $_brightness_on_release := 1
          end if
          if ($_time_since_note_off2>0)
            set_control_par(%ripple_swell[$r],$CONTROL_PAR_VALUE,int(real($_brightness_on_release)+((real($_time_since_note_off2)-real(0))/(real($_release_length)-real(0))*(real(0)-real($_brightness_on_release)))))
          end if
        end if
      end if
    end if
    dec($r)
  end while
end function

function midi_clip_play_cursors
  $clip_i := 0
  while ($clip_i<24)
    if (get_control_par(%midi_clip_preview_id[$clip_i],$CONTROL_PAR_VALUE)=1)
      $_time_played := $ENGINE_UPTIME-%time_started[$clip_i]
      $_clip_length_ms := ticks_to_ms(%clip_length[$clip_i])/1000
      set_control_par(%mf_cursor[$clip_i],$CONTROL_PAR_VALUE,int(real(0)+((real($_time_played)-real(0))/(real($_clip_length_ms)-real(0))*(real(1000)-real(0)))))
      set_control_par(%mf_cursor[$clip_i],$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
    else
      set_control_par(%mf_cursor[$clip_i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    end if
    inc($clip_i)
  end while
end function

function info_graphics_animation
  if ($PLAYED_VOICES_INST>0)
    ~midiInstructions_opacity := 0.0
  end if
  ~smoothed_midiInstructions_opacity := ~smoothed_midiInstructions_opacity+((~midiInstructions_opacity-~smoothed_midiInstructions_opacity)/30.0)
  if (~smoothed_midiInstructions_opacity<0.0001)
    ~smoothed_midiInstructions_opacity := 0.0
  end if
  set_control_par(get_ui_id($label_midiInstructions),$CONTROL_PAR_PICTURE_STATE,int(real(0)+((~smoothed_midiInstructions_opacity-0.0)/(1.0-0.0)*(real(127)-real(0)))))
  ~smoothed_midiCover_opacity := ~smoothed_midiCover_opacity+((~midiCover_opacity-~smoothed_midiCover_opacity)/4.0)
  if (~smoothed_midiCover_opacity<0.0001)
    ~smoothed_midiCover_opacity := 0.0
  end if
  set_control_par(get_ui_id($label_midiCover),$CONTROL_PAR_PICTURE_STATE,int(real(0)+((~smoothed_midiCover_opacity-0.0)/(1.0-0.0)*(real(127)-real(0)))))
end function

function play_release_samples_when_its_time
  $r := 0
  while ($r<100)
    if (event_status(%ripple_id_history[$r])=$EVENT_STATUS_NOTE_QUEUE)
      if (%custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$r] mod 1000000]=1 and (%custom_event_type[%ripple_id_history[$r] mod 1000000] # 1))
        $_time_since_note_off3 := $ENGINE_UPTIME-%custom_event_note_off_timestamp[%ripple_id_history[$r] mod 1000000]
        if ($_time_since_note_off3>(%custom_event_time_til_note_off[%ripple_id_history[$r] mod 1000000]-($DURATION_SIXTEENTH/4/1000)))
          %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$r] mod 1000000] := 0
          $_artic2 := %custom_event_artic[%ripple_id_history[$r] mod 1000000]
          $_vol := get_event_par(%ripple_id_history[$r],$EVENT_PAR_VOLUME)
          $_offset := 50000
          $_play_pos := get_event_par(%ripple_id_history[$r],$EVENT_PAR_PLAY_POS)
          if ($_play_pos-$_offset<(%rec_time_sample_lengths[$_artic2]/2))
            $_play_pos := $_play_pos-$_offset
            if ($_play_pos<0)
              $_play_pos := 0
            end if
          else
            $_play_pos := $_play_pos+$_offset
          end if
          $_cur_ripple := $_play_pos/%rec_time_ripple_lengths[$_artic2]
          if ($_cur_ripple>3)
            $_cur_ripple := 4-($_cur_ripple-3)
          end if
          if ($_cur_ripple<0)
            $_cur_ripple := 0
          end if
          if ($_cur_ripple>3)
            $_cur_ripple := 3
          end if
          $__vel := $_cur_ripple*32+1
          $_fade_out_time := int(real(ticks_to_ms(%ripple_length_ticks[$_artic2]/%pitch_fractions[$_artic2]))*?speeds[$slider_speed])
          fade_out(%ripple_id_history[$r],$_fade_out_time,1)
          if ($slider_releaseSamples>0)
            select ($slider_releaseSamples)
              case $RELEASE_SAMPLES__SOFT
                $_sample_start := %rec_time_ripple_lengths[$_artic2]/2
                $__vel := 24
              case $RELEASE_SAMPLES__LOUD
                $_sample_start := 0
                $__vel := 96
            end select
          end if
          if (%key_down[$recent_release_trigger_key]=1)
            $__vel := %velo[$recent_release_trigger_key]
            $_sample_start := int(real(%rec_time_ripple_lengths[$_artic2]/2)+((real($__vel)-real(1))/(real(127)-real(1))*(real(0)-real(%rec_time_ripple_lengths[$_artic2]/2))))
          end if
          $_release_sample_length := %rec_time_ripple_lengths[$_artic2]-$_sample_start
          $_release_sample_length := int(real(0)+((real($_release_sample_length)-real(0))/(real(%rec_time_ripple_lengths[$_artic2])-real(0))*(real(ticks_to_ms(%ripple_length_ticks[$_artic2]))-real(0))))
          $_release_sample_length := int(real($_release_sample_length)*?speeds[$slider_speed])
          %custom_event_release_sample_length[%ripple_id_history[$r] mod 1000000] := $_release_sample_length
          $_atk_time := int(real(ticks_to_ms(%ripple_length_ticks[$_artic2]/2))+((real($__vel)-real(1))/(real(127)-real(1))*(real(ticks_to_ms(%ripple_length_ticks[$_artic2]/4))-real(ticks_to_ms(%ripple_length_ticks[$_artic2]/2)))))/1000
          $_dec_time := ticks_to_ms(%ripple_length_ticks[$_artic2]*3)/1000
          $_atk_time := int(real($_atk_time)*?speeds[$slider_speed])
          $_dec_time := int(real($_dec_time)*?speeds[$slider_speed])
          set_engine_par($ENGINE_PAR_ATTACK,real_to_int(1000000.0/(log(1500000.0/100.0+2.0)/log(int_to_real(2))-1.0)*(log(real($_atk_time)*100.0/100.0+2.0)/log(int_to_real(2))-1.0)),%release_group[$_artic2],get_mod_idx(%release_group[$_artic2],"ENV_AHDSR2"),get_target_idx(%release_group[$_artic2],get_mod_idx(%release_group[$_artic2],"ENV_AHDSR2"),"ENV_AHDSR_VOLUME2"))
          set_engine_par($ENGINE_PAR_DECAY,real_to_int(1000000.0/(log(2500000.0/100.0+2.0)/log(int_to_real(2))-1.0)*(log(real($_dec_time)*100.0/100.0+2.0)/log(int_to_real(2))-1.0)),%release_group[$_artic2],get_mod_idx(%release_group[$_artic2],"ENV_AHDSR2"),get_target_idx(%release_group[$_artic2],get_mod_idx(%release_group[$_artic2],"ENV_AHDSR2"),"ENV_AHDSR_VOLUME2"))
          $_note_id := play_note(%custom_event_origin_note[%ripple_id_history[$r] mod 1000000],$__vel,$_sample_start,0)
          set_event_par_arr($_note_id,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
          set_event_par_arr($_note_id,$EVENT_PAR_ALLOW_GROUP,1,%release_group[$_artic2])
          %custom_event_source[$_note_id mod 1000000] := %custom_event_source[%ripple_id_history[$r] mod 1000000]
          %custom_event_note[$_note_id mod 1000000] := %custom_event_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_velocity[$_note_id mod 1000000] := %custom_event_velocity[%ripple_id_history[$r] mod 1000000]
          %custom_event_low_note[$_note_id mod 1000000] := %custom_event_low_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_high_note[$_note_id mod 1000000] := %custom_event_high_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_origin_note[$_note_id mod 1000000] := %custom_event_origin_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_dest_note[$_note_id mod 1000000] := %custom_event_dest_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_first_note[$_note_id mod 1000000] := %custom_event_first_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_second_note[$_note_id mod 1000000] := %custom_event_second_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_row[$_note_id mod 1000000] := %custom_event_row[%ripple_id_history[$r] mod 1000000]
          %custom_event_direction[$_note_id mod 1000000] := %custom_event_direction[%ripple_id_history[$r] mod 1000000]
          %custom_event_artic[$_note_id mod 1000000] := %custom_event_artic[%ripple_id_history[$r] mod 1000000]
          %custom_event_voice[$_note_id mod 1000000] := %custom_event_voice[%ripple_id_history[$r] mod 1000000]
          %custom_event_note_off_timestamp[$_note_id mod 1000000] := %custom_event_note_off_timestamp[%ripple_id_history[$r] mod 1000000]
          %custom_event_release_length[$_note_id mod 1000000] := %custom_event_release_length[%ripple_id_history[$r] mod 1000000]
          %custom_event_release_sample_length[$_note_id mod 1000000] := %custom_event_release_sample_length[%ripple_id_history[$r] mod 1000000]
          %custom_event_time_til_note_off[$_note_id mod 1000000] := %custom_event_time_til_note_off[%ripple_id_history[$r] mod 1000000]
          %custom_event_release_note[$_note_id mod 1000000] := %custom_event_release_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_brightness_on_release[$_note_id mod 1000000] := %custom_event_brightness_on_release[%ripple_id_history[$r] mod 1000000]
          %custom_event_waiting_to_trigger_release_sample[$_note_id mod 1000000] := %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$r] mod 1000000]
          %custom_event_releasing[$_note_id mod 1000000] := %custom_event_releasing[%ripple_id_history[$r] mod 1000000]
          %custom_event_dest_note_released[$_note_id mod 1000000] := %custom_event_dest_note_released[%ripple_id_history[$r] mod 1000000]
          %custom_event_start_note_released[$_note_id mod 1000000] := %custom_event_start_note_released[%ripple_id_history[$r] mod 1000000]
          %custom_event_triggered_by_mf[$_note_id mod 1000000] := %custom_event_triggered_by_mf[%ripple_id_history[$r] mod 1000000]
          %custom_event_preview_being_stopped[$_note_id mod 1000000] := %custom_event_preview_being_stopped[%ripple_id_history[$r] mod 1000000]
          %custom_event_type[$_note_id mod 1000000] := %custom_event_type[%ripple_id_history[$r] mod 1000000]
          %ripple_id_history[$r] := $_note_id
          %custom_event_note_off_timestamp[%ripple_id_history[$r] mod 1000000] := $ENGINE_UPTIME
          %custom_event_source[$_note_id mod 1000000] := -1
          %custom_event_type[$_note_id mod 1000000] := 1
          change_vol($_note_id,$_vol,0)
          %custom_event_releasing[%ripple_id_history[$r] mod 1000000] := 1
        end if
      end if
    end if
    inc($r)
  end while
end function

function crossfaded_looping
  $r := 0
  while ($r<100)
    if (event_status(%ripple_id_history[$r])=$EVENT_STATUS_NOTE_QUEUE)
      $_artic3 := %custom_event_artic[%ripple_id_history[$r] mod 1000000]
      if (%custom_event_releasing[%ripple_id_history[$r] mod 1000000]=0 and (get_event_par(%ripple_id_history[$r],$EVENT_PAR_PLAY_POS)>%rec_time_sample_lengths[$_artic3]))
        fade_out(%ripple_id_history[$r],$DURATION_SIXTEENTH,1)
        $_offset2 := get_event_par(%ripple_id_history[$r],$EVENT_PAR_PLAY_POS) mod %rec_time_sample_lengths[$_artic3]
        if (%custom_event_preview_being_stopped[%ripple_id_history[$r] mod 1000000]=0)
          $_note_id2 := play_note(get_event_par(%ripple_id_history[$r],$EVENT_PAR_NOTE),get_event_par(%ripple_id_history[$r],$EVENT_PAR_VELOCITY),$_offset2,0)
          set_event_par_arr($_note_id2,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
          set_event_par_arr($_note_id2,$EVENT_PAR_ALLOW_GROUP,1,$_artic3)
          change_vol($_note_id2,get_event_par(%ripple_id_history[$r],$EVENT_PAR_VOLUME),0)
          fade_in($_note_id2,$DURATION_SIXTEENTH)
          %custom_event_source[$_note_id2 mod 1000000] := %custom_event_source[%ripple_id_history[$r] mod 1000000]
          %custom_event_note[$_note_id2 mod 1000000] := %custom_event_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_velocity[$_note_id2 mod 1000000] := %custom_event_velocity[%ripple_id_history[$r] mod 1000000]
          %custom_event_low_note[$_note_id2 mod 1000000] := %custom_event_low_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_high_note[$_note_id2 mod 1000000] := %custom_event_high_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_origin_note[$_note_id2 mod 1000000] := %custom_event_origin_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_dest_note[$_note_id2 mod 1000000] := %custom_event_dest_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_first_note[$_note_id2 mod 1000000] := %custom_event_first_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_second_note[$_note_id2 mod 1000000] := %custom_event_second_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_row[$_note_id2 mod 1000000] := %custom_event_row[%ripple_id_history[$r] mod 1000000]
          %custom_event_direction[$_note_id2 mod 1000000] := %custom_event_direction[%ripple_id_history[$r] mod 1000000]
          %custom_event_artic[$_note_id2 mod 1000000] := %custom_event_artic[%ripple_id_history[$r] mod 1000000]
          %custom_event_voice[$_note_id2 mod 1000000] := %custom_event_voice[%ripple_id_history[$r] mod 1000000]
          %custom_event_note_off_timestamp[$_note_id2 mod 1000000] := %custom_event_note_off_timestamp[%ripple_id_history[$r] mod 1000000]
          %custom_event_release_length[$_note_id2 mod 1000000] := %custom_event_release_length[%ripple_id_history[$r] mod 1000000]
          %custom_event_release_sample_length[$_note_id2 mod 1000000] := %custom_event_release_sample_length[%ripple_id_history[$r] mod 1000000]
          %custom_event_time_til_note_off[$_note_id2 mod 1000000] := %custom_event_time_til_note_off[%ripple_id_history[$r] mod 1000000]
          %custom_event_release_note[$_note_id2 mod 1000000] := %custom_event_release_note[%ripple_id_history[$r] mod 1000000]
          %custom_event_brightness_on_release[$_note_id2 mod 1000000] := %custom_event_brightness_on_release[%ripple_id_history[$r] mod 1000000]
          %custom_event_waiting_to_trigger_release_sample[$_note_id2 mod 1000000] := %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$r] mod 1000000]
          %custom_event_releasing[$_note_id2 mod 1000000] := %custom_event_releasing[%ripple_id_history[$r] mod 1000000]
          %custom_event_dest_note_released[$_note_id2 mod 1000000] := %custom_event_dest_note_released[%ripple_id_history[$r] mod 1000000]
          %custom_event_start_note_released[$_note_id2 mod 1000000] := %custom_event_start_note_released[%ripple_id_history[$r] mod 1000000]
          %custom_event_triggered_by_mf[$_note_id2 mod 1000000] := %custom_event_triggered_by_mf[%ripple_id_history[$r] mod 1000000]
          %custom_event_preview_being_stopped[$_note_id2 mod 1000000] := %custom_event_preview_being_stopped[%ripple_id_history[$r] mod 1000000]
          %custom_event_type[$_note_id2 mod 1000000] := %custom_event_type[%ripple_id_history[$r] mod 1000000]
          %ripple_id_history[$r] := $_note_id2
        end if
      end if
    end if
    inc($r)
  end while
end function

function hide_version
  if ($ENGINE_UPTIME-$timestamp_version_shown>1000)
    set_control_par(get_ui_id($label_version),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
end function

function update_midi_visibility
  set_control_par(get_ui_id($switch_closeMidi),$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  set_control_par(get_ui_id($paneL_midi),$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  $i := 0
  while ($i<2)
    set_control_par(%panel_midiPg[$i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    inc($i)
  end while
  set_control_par(%panel_midiPg[$cur_midi_page],$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  set_control_par(get_ui_id($label_midiInstructions),$CONTROL_PAR_HIDE,%hide_states[$button_showMidi])
  ~midiInstructions_opacity := real($button_showMidi)
  ~midiCover_opacity := real($button_showMidi)
  set_control_par(get_ui_id($panel_articulations),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_fx),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_speed),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_speed),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_direction),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_direction),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_legato),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_legato),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($panel_releaseSamples),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($button_generalInfo),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
  set_control_par(get_ui_id($button_optionsInfo),$CONTROL_PAR_HIDE,%hide_states[1-$button_showMidi])
end function

function count_active_ripples
  $_found2 := 0
  $num_active_ripples := 0
  $_r2 := 1
  while ($_r2<100)
    if (%ripple_id_history[$_r2]=0 and ($_found2=0))
      if (%key_active[%custom_event_second_note[%ripple_id_history[$_r2-1] mod 1000000]]=0)
        if (%custom_event_note_off_timestamp[%ripple_id_history[$_r2-1] mod 1000000] # 0)
          $_time_since_note_off := $ENGINE_UPTIME-%custom_event_note_off_timestamp[%ripple_id_history[$_r2-1] mod 1000000]
          if ($_time_since_note_off<($DURATION_EIGHTH/1000+100))
            $_found2 := 1
            $num_active_ripples := $_r2
          end if
        end if
      else
        $_found2 := 1
        $num_active_ripples := $_r2
      end if
    end if
    inc($_r2)
  end while
end function

function update_articulation_switches
  $i := 0
  while ($i<num_elements(%articulation_ids))
    if ($i=$cur_artic)
      set_control_par(%articulation_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%articulation_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function update_speed_switches
  $i := 0
  while ($i<num_elements(%speed_ids))
    if ($i=$slider_speed)
      set_control_par(%speed_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%speed_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function update_speed
  $g := 0
  while ($g<$NUM_GROUPS)
    if ($switch_halfSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_QUARTER,$g,-1,-1)
    end if
    if ($switch_slowTripletSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_QUARTER_TRIPLET,$g,-1,-1)
    end if
    if ($switch_fullSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_8TH,$g,-1,-1)
    end if
    if ($switch_fastTripletSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_8TH_TRIPLET,$g,-1,-1)
    end if
    if ($switch_doubleSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_16TH,$g,-1,-1)
    end if
    inc($g)
  end while
end function

function update_direction_switches
  $i := 0
  while ($i<num_elements(%direction_ids))
    if ($i=$slider_direction)
      set_control_par(%direction_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%direction_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function update_legato_switches
  $i := 0
  while ($i<num_elements(%legato_ids))
    if ($i=$slider_legato)
      set_control_par(%legato_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%legato_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function update_releaseSamples_switches
  $i := 0
  while ($i<num_elements(%releaseSamples_ids))
    if ($i=$slider_releaseSamples)
      set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%releaseSamples_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function count_keys_pressed
  $num_keys_pressed := 0
  $_key_i2 := $LOWEST_KEY
  while ($_key_i2<=$HIGHEST_KEY)
    if (%key_active[$_key_i2]=1)
      inc($num_keys_pressed)
    end if
    inc($_key_i2)
  end while
end function

function trigger_release_samples_for_all_ripples
  $_key_i := $LOWEST_KEY
  while ($_key_i<=$HIGHEST_KEY)
    %key_active[$_key_i] := 0
    $voice_i := 0
    while ($voice_i<%num_ripple_voices[$_key_i])
      if ($voice_i=-1)
        message("voice = " & $voice_i)
      end if
      $_r3 := 0
      while ($_r3<100)
        if (%ripple_id_history[$_r3] # 0)
          if ($voice_i=%custom_event_voice[%ripple_id_history[$_r3] mod 1000000])
            $_artic4 := %custom_event_artic[%ripple_id_history[$_r3] mod 1000000]
            $_rec_time_pos_in_ripple := get_event_par(%ripple_id_history[$_r3],$EVENT_PAR_PLAY_POS) mod %rec_time_ripple_lengths[$_artic4]
            $_real_time_pos_in_pulse := int(real(0)+((real($_rec_time_pos_in_ripple)-real(0))/(real(%rec_time_ripple_lengths[$_artic4])-real(0))*(real(ticks_to_ms(%ripple_length_ticks[$_artic4]))-real(0))))
            $_real_time_pos_in_pulse := int(real($_real_time_pos_in_pulse)*?speeds[$slider_speed])
            $_real_time_ripple_length := ticks_to_ms(int(real(%ripple_length_ticks[$_artic4])*?speeds[$slider_speed]))
            $_time_til_end_of_ripple := ($_real_time_ripple_length-$_real_time_pos_in_pulse)/1000
            if ($_key_i=%custom_event_second_note[%ripple_id_history[$_r3] mod 1000000])
              %custom_event_note_off_timestamp[%ripple_id_history[$_r3] mod 1000000] := $ENGINE_UPTIME
              if ($slider_releaseSamples=0)
                if (%key_down[$recent_release_trigger_key]=1)
                  $_play_release_sample := 1
                else
                  $_play_release_sample := 0
                end if
              else
                if ($slider_releaseSamples>0)
                  $_play_release_sample := 1
                end if
              end if
              if ($_play_release_sample=0)
                %custom_event_releasing[%ripple_id_history[$_r3] mod 1000000] := 1
                $_fade_out_time2 := $_time_til_end_of_ripple
                %custom_event_release_length[%ripple_id_history[$_r3] mod 1000000] := $_fade_out_time2
                fade_out(%ripple_id_history[$_r3],$_fade_out_time2*1000,1)
              else
                %custom_event_time_til_note_off[%ripple_id_history[$_r3] mod 1000000] := $_time_til_end_of_ripple
                %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$_r3] mod 1000000] := 1
              end if
            end if
          end if
        end if
        inc($_r3)
      end while
      call count_keys_pressed
      if ($num_keys_pressed=0)
        $all_keys_released := 1
      end if
      inc($voice_i)
    end while
    %num_ripple_voices[$_key_i] := 0
    %key_down[$_key_i] := 0
    set_key_pressed($_key_i,0)
    inc($_key_i)
  end while
end function

on persistence_changed
  call set_key_colors_and_types_and_names
  call set_keys_pressed
  call set_reverb_menu_checkmark
  $i := 0
  while ($i<6)
    $_ui_id := %ctrl_ids[$i]
    if ($i=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
      set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
    else
      if ($i=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
        set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
      else
        if (in_range($i,get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
          set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*$i+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
        end if
      end if
    end if
    inc($i)
  end while
end on

on note
  %custom_event_source[$EVENT_ID mod 1000000] := -1
  set_event_par_arr($EVENT_ID,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
  set_key_pressed($EVENT_NOTE,1)
  %key_down[$EVENT_NOTE] := 1
  %velo[$EVENT_NOTE] := $EVENT_VELOCITY
  $_ks_index := search(%articulation_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $cur_artic := $_ks_index
    call update_articulation_switches
  end if
  $_ks_index := search(%speed_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $slider_speed := $_ks_index
    call update_speed_switches
    call update_speed
    $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)]
    if (get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
      set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
    else
      if (get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
        set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
      else
        if (in_range(get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
          set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
        end if
      end if
    end if
  end if
  $_ks_index := search(%direction_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $slider_direction := $_ks_index
    call update_direction_switches
    $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)]
    if (get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
      set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
    else
      if (get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
        set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
      else
        if (in_range(get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
          set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
        end if
      end if
    end if
  end if
  $_ks_index := search(%legato_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $slider_legato := $_ks_index
    call update_legato_switches
    $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)]
    if (get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
      set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
    else
      if (get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
        set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
      else
        if (in_range(get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
          set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
        end if
      end if
    end if
  end if
  $_ks_index := search(%release_sample_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $slider_releaseSamples := $_ks_index
    call update_releaseSamples_switches
    $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)]
    if (get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
      set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
    else
      if (get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
        set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
      else
        if (in_range(get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
          set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
        end if
      end if
    end if
  end if
  $_ks_index := search(%release_trigger_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $recent_release_trigger_key := %release_trigger_keyswitches[$_ks_index]
    $switch_releaseTrigger := 1
    call trigger_release_samples_for_all_ripples
  end if
  if (search(%all_keyswitches,$EVENT_NOTE) # -1)
    call set_keys_pressed
  end if
  if (in_range($EVENT_NOTE,$LOWEST_KEY,$HIGHEST_KEY))
    %key_active[$EVENT_NOTE] := 1
    %key_timestamp[$EVENT_NOTE] := $ENGINE_UPTIME
    %velo[$EVENT_NOTE] := $EVENT_VELOCITY
    set_control_par(%key_ids[$EVENT_NOTE],$CONTROL_PAR_PICTURE_STATE,1)
    $key_i := num_elements(%key_history)-2
    while ($key_i>=0)
      %key_history[$key_i+1] := %key_history[$key_i]
      dec($key_i)
    end while
    %key_history[0] := $EVENT_NOTE
    call count_keys_pressed
    if ($num_keys_pressed>1)
      $_num_ripples := 0
      $_closest_neighbor := -1
      $_closest_neighbor_interval := 12
      $array_i := 0
      while ($array_i<num_elements(%_neighbor))
        %_neighbor[$array_i] := 0
        inc($array_i)
      end while
      $array_i := 0
      while ($array_i<num_elements(%_lower_neighbor))
        %_lower_neighbor[$array_i] := 0
        inc($array_i)
      end while
      $array_i := 0
      while ($array_i<num_elements(%_upper_neighbor))
        %_upper_neighbor[$array_i] := 0
        inc($array_i)
      end while
      $_num_neighbors := 0
      $_num_lower_neighbors := 0
      $_num_upper_neighbors := 0
      $i := 1
      while ($i<=$MAX_INTERVAL)
        $_dir := 0
        while ($_dir<=1)
          $_sign := $_dir*2-1
          $_other_note := $EVENT_NOTE+($i*$_sign)
          if (%key_down[$_other_note]=1)
            %_neighbor[$_num_neighbors] := $_other_note
            inc($_num_neighbors)
            if ($_other_note<$EVENT_NOTE)
              %_lower_neighbor[$_num_lower_neighbors] := $_other_note
              inc($_num_lower_neighbors)
            end if
            if ($_other_note>$EVENT_NOTE)
              %_upper_neighbor[$_num_upper_neighbors] := $_other_note
              inc($_num_upper_neighbors)
            end if
          end if
          inc($_dir)
        end while
        inc($i)
      end while
      if (%_lower_neighbor[0] # 0 and (%_upper_neighbor[0] # 0))
        $_lower_neighbor_time_held := $ENGINE_UPTIME-%key_timestamp[%_lower_neighbor[0]]
        $_upper_neighbor_time_held := $ENGINE_UPTIME-%key_timestamp[%_upper_neighbor[0]]
        if (abs($_upper_neighbor_time_held-$_lower_neighbor_time_held)<50)
          $_make_ripples_to_both_adjacent_neighbors := 1
        else
          $_make_ripples_to_both_adjacent_neighbors := 0
        end if
        if ($slider_direction=$DIRECTION_MODE__UP or ($slider_direction=$DIRECTION_MODE__DOWN))
          $_make_ripples_to_both_adjacent_neighbors := 1
        end if
        if ($_make_ripples_to_both_adjacent_neighbors=1)
          %__notes[0] := %_lower_neighbor[0]
          %__intervals[0] := $EVENT_NOTE-%_lower_neighbor[0]
          %__notes[1] := %_upper_neighbor[0]
          %__intervals[1] := $EVENT_NOTE-%_upper_neighbor[0]
          $_num_ripples := 2
        else
          if ($_make_ripples_to_both_adjacent_neighbors=0)
            if (search(%key_history,%_lower_neighbor[0])<search(%key_history,%_upper_neighbor[0]))
              %__notes[0] := %_lower_neighbor[0]
              %__intervals[0] := $EVENT_NOTE-%_lower_neighbor[0]
            else
              %__notes[0] := %_upper_neighbor[0]
              %__intervals[0] := $EVENT_NOTE-%_upper_neighbor[0]
            end if
            $_num_ripples := 1
          end if
        end if
      else
        %__notes[0] := %key_history[1]
        %__intervals[0] := %key_history[0]-%key_history[1]
        $_num_ripples := 1
        if (abs(%__intervals[0])>$MAX_INTERVAL)
          if ($_num_neighbors>0)
            %__notes[0] := %_neighbor[0]
            %__intervals[0] := $EVENT_NOTE-%_neighbor[0]
            $_num_ripples := 1
          else
            $array_i := 0
            while ($array_i<num_elements(%__notes))
              %__notes[$array_i] := 0
              inc($array_i)
            end while
            $array_i := 0
            while ($array_i<num_elements(%__intervals))
              %__intervals[$array_i] := 0
              inc($array_i)
            end while
            $_num_ripples := 0
          end if
        end if
      end if
      $array_i := 0
      while ($array_i<num_elements(%__notes))
        %_played_notes[$array_i] := %__notes[$array_i]
        inc($array_i)
      end while
      $array_i := 0
      while ($array_i<num_elements(%__intervals))
        %_played_intervals[$array_i] := %__intervals[$array_i]
        inc($array_i)
      end while
      $array_i := 0
      while ($array_i<num_elements(%note_used_by_ripple))
        %note_used_by_ripple[$array_i] := 0
        inc($array_i)
      end while
      $_ripple_i := 0
      while ($_ripple_i<$_num_ripples)
        if ($slider_direction=$DIRECTION_MODE__UP)
          if (%__intervals[$_ripple_i]<0)
            %__notes[$_ripple_i] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
            %__intervals[$_ripple_i] := -%__intervals[$_ripple_i]
          end if
        else
          if ($slider_direction=$DIRECTION_MODE__DOWN)
            if (%__intervals[$_ripple_i]>0)
              %__notes[$_ripple_i] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
              %__intervals[$_ripple_i] := -%__intervals[$_ripple_i]
            end if
          end if
        end if
        if (%__intervals[$_ripple_i]<0)
          $_low_note2 := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
          $_high_note2 := %__notes[$_ripple_i]
        else
          $_low_note2 := %__notes[$_ripple_i]
          $_high_note2 := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
        end if
        if (%__intervals[$_ripple_i]>0)
          $direction := $UP
        else
          $direction := $DOWN
        end if
        $_already_playing := 0
        $r := 0
        while ($r<100)
          if (%ripple_id_history[$r] # 0)
            if (%custom_event_low_note[%ripple_id_history[$r] mod 1000000]=$_low_note2 and (%key_released[$_low_note2]=0) and (%custom_event_high_note[%ripple_id_history[$r] mod 1000000]=$_high_note2) and (%key_released[$_high_note2]=0) and (%custom_event_high_note[%ripple_id_history[$r] mod 1000000]=$_high_note2) and (%custom_event_direction[%ripple_id_history[$r] mod 1000000]=$direction) and (%custom_event_releasing[%ripple_id_history[$r] mod 1000000]=0))
              $_already_playing := 1
            end if
          end if
          inc($r)
        end while
        %key_released[$_low_note2] := 0
        %key_released[$_high_note2] := 0
        if ($_already_playing=0)
          $_do_legato := 0
          call count_active_ripples
          if ($num_active_ripples>0)
            $_do_legato := 1
          end if
          if ($all_keys_released=1)
            $_do_legato := 0
          else
            $_do_legato := 1
          end if
          $all_keys_released := 0
          if ($_do_legato=0)
            $first_ripple_timestamp := $ENGINE_UPTIME
            $_real_legato_time := 0
            $_offset_real_time := 0
          else
            $_real_legato_time := ($ENGINE_UPTIME-$first_ripple_timestamp)*1000
            $_real_legato_time := int(real($_real_legato_time)/?speeds[$slider_speed])
            select ($slider_legato)
              case $LEGATO_MODE__SYNC_TO_PITCH
                $_real_legato_time := $_real_legato_time+ticks_to_ms(1)
                $_offset_real_time := $_real_legato_time mod ticks_to_ms(%ripple_length_ticks[$cur_artic]/%pitch_fractions[$cur_artic])
              case $LEGATO_MODE__SYNC_TO_RIPPLE
                $_offset_real_time := $_real_legato_time mod ticks_to_ms(%ripple_length_ticks[$cur_artic])
              case $LEGATO_MODE__SYNC_TO_SWELL
                $_offset_real_time := $_real_legato_time mod ticks_to_ms(%sample_length_ticks[$cur_artic])
            end select
          end if
          $_offset_rec_time := int(real(0)+((real($_offset_real_time)-real(0))/(real(ticks_to_ms(%sample_length_ticks[$cur_artic]))-real(0))*(real(%rec_time_sample_lengths[$cur_artic])-real(0))))
          $_note_id3 := play_note(%__notes[$_ripple_i],64+%__intervals[$_ripple_i],$_offset_rec_time,0)
          $_volume := int(real(-12000)+((real($EVENT_VELOCITY)-real(1))/(real(127)-real(1))*(real(3000)-real(-12000))))
          if ($_offset_rec_time=0)
            fade_in($_note_id3,$DURATION_SIXTEENTH)
          end if
          change_vol($_note_id3,$_volume,0)
          set_event_par_arr($_note_id3,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
          set_event_par_arr($_note_id3,$EVENT_PAR_ALLOW_GROUP,1,$cur_artic)
          %custom_event_artic[$_note_id3 mod 1000000] := $cur_artic
          %custom_event_note[$_note_id3 mod 1000000] := $EVENT_NOTE
          %custom_event_low_note[$_note_id3 mod 1000000] := $_low_note2
          %custom_event_high_note[$_note_id3 mod 1000000] := $_high_note2
          %custom_event_origin_note[$_note_id3 mod 1000000] := %__notes[$_ripple_i]
          %custom_event_dest_note[$_note_id3 mod 1000000] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
          %custom_event_first_note[$_note_id3 mod 1000000] := %_played_notes[$_ripple_i]
          %custom_event_second_note[$_note_id3 mod 1000000] := %_played_notes[$_ripple_i]+%_played_intervals[$_ripple_i]
          %custom_event_velocity[$_note_id3 mod 1000000] := $EVENT_VELOCITY
          if (%note_used_by_ripple[%custom_event_second_note[$_note_id3 mod 1000000]]=0)
            %custom_event_voice[$_note_id3 mod 1000000] := %num_ripple_voices[%custom_event_second_note[$_note_id3 mod 1000000]]
            inc(%num_ripple_voices[%custom_event_second_note[$_note_id3 mod 1000000]])
            %note_used_by_ripple[%custom_event_second_note[$_note_id3 mod 1000000]] := 1
          else
            %custom_event_voice[$_note_id3 mod 1000000] := %num_ripple_voices[%custom_event_second_note[$_note_id3 mod 1000000]]-1
          end if
          %custom_event_direction[$_note_id3 mod 1000000] := $direction
          %custom_event_source[$_note_id3 mod 1000000] := -1
          %custom_event_triggered_by_mf[$_note_id3 mod 1000000] := %custom_event_triggered_by_mf[$EVENT_ID mod 1000000]
          $r := 100-2
          while ($r>=0)
            %ripple_id_history[$r+1] := %ripple_id_history[$r]
            dec($r)
          end while
          %ripple_id_history[0] := $_note_id3
          if ($_real_legato_time>0)
            $_real_time_pos_in_ripple := ($_real_legato_time-ticks_to_ms(2)) mod ticks_to_ms(%ripple_length_ticks[$cur_artic])
            $_real_time_pos_in_ripple := int(real($_real_time_pos_in_ripple)/?speeds[$slider_speed])
            $_fade_in_time := ticks_to_ms(%ripple_length_ticks[$cur_artic])-$_real_time_pos_in_ripple
            if ($_fade_in_time<150000)
              $_fade_in_time := 150000
            end if
            fade_in($_note_id3,$_fade_in_time)
          end if
        end if
        inc($_ripple_i)
      end while
    end if
  end if
end on

on release
  %key_released[$EVENT_NOTE] := 1
  %key_down[$EVENT_NOTE] := 0
  if (search(%all_keyswitches,$EVENT_NOTE)=-1)
    set_key_pressed($EVENT_NOTE,0)
  end if
  if ($EVENT_NOTE=%release_trigger_keyswitches[0] or ($EVENT_NOTE=%release_trigger_keyswitches[1]))
    $switch_releaseTrigger := 0
  end if
  if (in_range($EVENT_NOTE,$LOWEST_KEY,$HIGHEST_KEY) and (%custom_event_source[$EVENT_ID mod 1000000]=-1))
    set_control_par(%key_ids[$EVENT_NOTE],$CONTROL_PAR_PICTURE_STATE,0)
    $_note_found := 0
    $_hist_i := 0
    while ($_hist_i<num_elements(%key_history))
      if ($_note_found=0)
        if (%key_history[$_hist_i]=$EVENT_NOTE)
          $_note_found := 1
          $_history_index := $_hist_i
        end if
      end if
      inc($_hist_i)
    end while
    if ($_note_found=0)
      $_history_index := -1
    end if
    if ($_history_index>-1)
      $key_i := $_history_index
      while ($key_i<=(num_elements(%key_history)-2))
        %key_history[$key_i] := %key_history[$key_i+1]
        inc($key_i)
      end while
    end if
    if (%CC[64]<10)
      %key_active[$EVENT_NOTE] := 0
      if (%num_ripple_voices[$EVENT_NOTE]=0)
        if (0=-1)
          message("voice = " & 0)
        end if
        $_r3 := 0
        while ($_r3<100)
          if (%ripple_id_history[$_r3] # 0)
            if (0=%custom_event_voice[%ripple_id_history[$_r3] mod 1000000])
              $_artic4 := %custom_event_artic[%ripple_id_history[$_r3] mod 1000000]
              $_rec_time_pos_in_ripple := get_event_par(%ripple_id_history[$_r3],$EVENT_PAR_PLAY_POS) mod %rec_time_ripple_lengths[$_artic4]
              $_real_time_pos_in_pulse := int(real(0)+((real($_rec_time_pos_in_ripple)-real(0))/(real(%rec_time_ripple_lengths[$_artic4])-real(0))*(real(ticks_to_ms(%ripple_length_ticks[$_artic4]))-real(0))))
              $_real_time_pos_in_pulse := int(real($_real_time_pos_in_pulse)*?speeds[$slider_speed])
              $_real_time_ripple_length := ticks_to_ms(int(real(%ripple_length_ticks[$_artic4])*?speeds[$slider_speed]))
              $_time_til_end_of_ripple := ($_real_time_ripple_length-$_real_time_pos_in_pulse)/1000
              if ($EVENT_NOTE=%custom_event_second_note[%ripple_id_history[$_r3] mod 1000000])
                %custom_event_note_off_timestamp[%ripple_id_history[$_r3] mod 1000000] := $ENGINE_UPTIME
                if ($slider_releaseSamples=0)
                  if (%key_down[$recent_release_trigger_key]=1)
                    $_play_release_sample := 1
                  else
                    $_play_release_sample := 0
                  end if
                else
                  if ($slider_releaseSamples>0)
                    $_play_release_sample := 1
                  end if
                end if
                if ($_play_release_sample=0)
                  %custom_event_releasing[%ripple_id_history[$_r3] mod 1000000] := 1
                  $_fade_out_time2 := $_time_til_end_of_ripple
                  %custom_event_release_length[%ripple_id_history[$_r3] mod 1000000] := $_fade_out_time2
                  fade_out(%ripple_id_history[$_r3],$_fade_out_time2*1000,1)
                else
                  %custom_event_time_til_note_off[%ripple_id_history[$_r3] mod 1000000] := $_time_til_end_of_ripple
                  %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$_r3] mod 1000000] := 1
                end if
              end if
            end if
          end if
          inc($_r3)
        end while
        call count_keys_pressed
        if ($num_keys_pressed=0)
          $all_keys_released := 1
        end if
      else
        $voice_i := 0
        while ($voice_i<%num_ripple_voices[$EVENT_NOTE])
          if ($voice_i=-1)
            message("voice = " & $voice_i)
          end if
          $_r3 := 0
          while ($_r3<100)
            if (%ripple_id_history[$_r3] # 0)
              if ($voice_i=%custom_event_voice[%ripple_id_history[$_r3] mod 1000000])
                $_artic4 := %custom_event_artic[%ripple_id_history[$_r3] mod 1000000]
                $_rec_time_pos_in_ripple := get_event_par(%ripple_id_history[$_r3],$EVENT_PAR_PLAY_POS) mod %rec_time_ripple_lengths[$_artic4]
                $_real_time_pos_in_pulse := int(real(0)+((real($_rec_time_pos_in_ripple)-real(0))/(real(%rec_time_ripple_lengths[$_artic4])-real(0))*(real(ticks_to_ms(%ripple_length_ticks[$_artic4]))-real(0))))
                $_real_time_pos_in_pulse := int(real($_real_time_pos_in_pulse)*?speeds[$slider_speed])
                $_real_time_ripple_length := ticks_to_ms(int(real(%ripple_length_ticks[$_artic4])*?speeds[$slider_speed]))
                $_time_til_end_of_ripple := ($_real_time_ripple_length-$_real_time_pos_in_pulse)/1000
                if ($EVENT_NOTE=%custom_event_second_note[%ripple_id_history[$_r3] mod 1000000])
                  %custom_event_note_off_timestamp[%ripple_id_history[$_r3] mod 1000000] := $ENGINE_UPTIME
                  if ($slider_releaseSamples=0)
                    if (%key_down[$recent_release_trigger_key]=1)
                      $_play_release_sample := 1
                    else
                      $_play_release_sample := 0
                    end if
                  else
                    if ($slider_releaseSamples>0)
                      $_play_release_sample := 1
                    end if
                  end if
                  if ($_play_release_sample=0)
                    %custom_event_releasing[%ripple_id_history[$_r3] mod 1000000] := 1
                    $_fade_out_time2 := $_time_til_end_of_ripple
                    %custom_event_release_length[%ripple_id_history[$_r3] mod 1000000] := $_fade_out_time2
                    fade_out(%ripple_id_history[$_r3],$_fade_out_time2*1000,1)
                  else
                    %custom_event_time_til_note_off[%ripple_id_history[$_r3] mod 1000000] := $_time_til_end_of_ripple
                    %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$_r3] mod 1000000] := 1
                  end if
                end if
              end if
            end if
            inc($_r3)
          end while
          call count_keys_pressed
          if ($num_keys_pressed=0)
            $all_keys_released := 1
          end if
          inc($voice_i)
        end while
      end if
      %num_ripple_voices[$EVENT_NOTE] := 0
    else
      %notes_to_release[$num_notes_to_release] := $EVENT_NOTE
      %voices_to_release[$num_notes_to_release] := %num_ripple_voices[$EVENT_NOTE]-1
      inc($num_notes_to_release)
    end if
  end if
end on

on controller
  if ($CC_NUM=64)
    if (%CC[64]<10 and ($_prev_cc64>=10))
      $_i2 := 0
      while ($_i2<$num_notes_to_release)
        %key_active[%notes_to_release[$_i2]] := %key_down[%notes_to_release[$_i2]]
        if (%voices_to_release[$_i2]=-1)
          message("voice = " & %voices_to_release[$_i2])
        end if
        $_r3 := 0
        while ($_r3<100)
          if (%ripple_id_history[$_r3] # 0)
            if (%voices_to_release[$_i2]=%custom_event_voice[%ripple_id_history[$_r3] mod 1000000])
              $_artic4 := %custom_event_artic[%ripple_id_history[$_r3] mod 1000000]
              $_rec_time_pos_in_ripple := get_event_par(%ripple_id_history[$_r3],$EVENT_PAR_PLAY_POS) mod %rec_time_ripple_lengths[$_artic4]
              $_real_time_pos_in_pulse := int(real(0)+((real($_rec_time_pos_in_ripple)-real(0))/(real(%rec_time_ripple_lengths[$_artic4])-real(0))*(real(ticks_to_ms(%ripple_length_ticks[$_artic4]))-real(0))))
              $_real_time_pos_in_pulse := int(real($_real_time_pos_in_pulse)*?speeds[$slider_speed])
              $_real_time_ripple_length := ticks_to_ms(int(real(%ripple_length_ticks[$_artic4])*?speeds[$slider_speed]))
              $_time_til_end_of_ripple := ($_real_time_ripple_length-$_real_time_pos_in_pulse)/1000
              if (%notes_to_release[$_i2]=%custom_event_second_note[%ripple_id_history[$_r3] mod 1000000])
                %custom_event_note_off_timestamp[%ripple_id_history[$_r3] mod 1000000] := $ENGINE_UPTIME
                if ($slider_releaseSamples=0)
                  if (%key_down[$recent_release_trigger_key]=1)
                    $_play_release_sample := 1
                  else
                    $_play_release_sample := 0
                  end if
                else
                  if ($slider_releaseSamples>0)
                    $_play_release_sample := 1
                  end if
                end if
                if ($_play_release_sample=0)
                  %custom_event_releasing[%ripple_id_history[$_r3] mod 1000000] := 1
                  $_fade_out_time2 := $_time_til_end_of_ripple
                  %custom_event_release_length[%ripple_id_history[$_r3] mod 1000000] := $_fade_out_time2
                  fade_out(%ripple_id_history[$_r3],$_fade_out_time2*1000,1)
                else
                  %custom_event_time_til_note_off[%ripple_id_history[$_r3] mod 1000000] := $_time_til_end_of_ripple
                  %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$_r3] mod 1000000] := 1
                end if
              end if
            end if
          end if
          inc($_r3)
        end while
        call count_keys_pressed
        if ($num_keys_pressed=0)
          $all_keys_released := 1
        end if
        inc($_i2)
      end while
      $array_i := 0
      while ($array_i<num_elements(%notes_to_release))
        %notes_to_release[$array_i] := 0
        inc($array_i)
      end while
      $array_i := 0
      while ($array_i<num_elements(%voices_to_release))
        %voices_to_release[$array_i] := 0
        inc($array_i)
      end while
      $num_notes_to_release := 0
    end if
    $_prev_cc64 := %CC[64]
  end if
end on

on listener
  select ($NI_SIGNAL_TYPE)
    case $NI_SIGNAL_TIMER_MS
      call remove_ripple_ids_from_history_after_they_have_faded_out
      call ripple_animations
      call midi_clip_play_cursors
      call info_graphics_animation
      call play_release_samples_when_its_time
      call crossfaded_looping
      call hide_version
    case $NI_SIGNAL_TRANSP_START
      $first_ripple_timestamp := $ENGINE_UPTIME
      set_controller(64,0)
      wait(1)
      $clip_i := 0
      while ($clip_i<num_elements(%midi_clip_preview_id))
        set_control_par(%midi_clip_preview_id[$clip_i],$CONTROL_PAR_VALUE,0)
        if (%playing[$clip_i]=1)
          get_event_ids(%event_ids)
          $e := 0
          while ($e<num_elements(%event_ids))
            if (%event_ids[$e] # 0)
              if (%custom_event_triggered_by_mf[%event_ids[$e] mod 1000000]=($clip_i+1))
                %custom_event_preview_being_stopped[%event_ids[$e] mod 1000000] := 1
                fade_out(%event_ids[$e],$DURATION_SIXTEENTH,1)
                if (in_range(get_event_par(%event_ids[$e],$EVENT_PAR_NOTE),$LOWEST_KEY,$HIGHEST_KEY))
                  set_control_par(%key_ids[get_event_par(%event_ids[$e],$EVENT_PAR_NOTE)],$CONTROL_PAR_PICTURE_STATE,0)
                  %key_down[get_event_par(%event_ids[$e],$EVENT_PAR_NOTE)] := 0
                  %key_active[get_event_par(%event_ids[$e],$EVENT_PAR_NOTE)] := 0
                end if
              end if
            end if
            inc($e)
          end while
          %playing[$clip_i] := 0
          %looping[$clip_i] := 0
        end if
        inc($clip_i)
      end while
    case $NI_SIGNAL_TRANSP_STOP
      set_controller(64,0)
      wait(1)
      $clip_i := 0
      while ($clip_i<num_elements(%midi_clip_preview_id))
        set_control_par(%midi_clip_preview_id[$clip_i],$CONTROL_PAR_VALUE,0)
        if (%playing[$clip_i]=1)
          get_event_ids(%event_ids)
          $e := 0
          while ($e<num_elements(%event_ids))
            if (%event_ids[$e] # 0)
              if (%custom_event_triggered_by_mf[%event_ids[$e] mod 1000000]=($clip_i+1))
                %custom_event_preview_being_stopped[%event_ids[$e] mod 1000000] := 1
                fade_out(%event_ids[$e],$DURATION_SIXTEENTH,1)
                if (in_range(get_event_par(%event_ids[$e],$EVENT_PAR_NOTE),$LOWEST_KEY,$HIGHEST_KEY))
                  set_control_par(%key_ids[get_event_par(%event_ids[$e],$EVENT_PAR_NOTE)],$CONTROL_PAR_PICTURE_STATE,0)
                  %key_down[get_event_par(%event_ids[$e],$EVENT_PAR_NOTE)] := 0
                  %key_active[get_event_par(%event_ids[$e],$EVENT_PAR_NOTE)] := 0
                end if
              end if
            end if
            inc($e)
          end while
          %playing[$clip_i] := 0
          %looping[$clip_i] := 0
        end if
        inc($clip_i)
      end while
  end select
end on

on ui_controls
  if ($NI_UI_ID=get_ui_id($button_showMidi))
    if ($button_showMidi=0)
      set_controller(64,0)
      wait(1)
      $clip_i := 0
      while ($clip_i<num_elements(%midi_clip_preview_id))
        set_control_par(%midi_clip_preview_id[$clip_i],$CONTROL_PAR_VALUE,0)
        if (%playing[$clip_i]=1)
          get_event_ids(%_event_ids)
          $_e := 0
          while ($_e<num_elements(%_event_ids))
            if (%_event_ids[$_e] # 0)
              if (%custom_event_triggered_by_mf[%_event_ids[$_e] mod 1000000]=($clip_i+1))
                %custom_event_preview_being_stopped[%_event_ids[$_e] mod 1000000] := 1
                fade_out(%_event_ids[$_e],$DURATION_SIXTEENTH,1)
                if (in_range(get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE),$LOWEST_KEY,$HIGHEST_KEY))
                  set_control_par(%key_ids[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)],$CONTROL_PAR_PICTURE_STATE,0)
                  %key_down[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
                  %key_active[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
                end if
              end if
            end if
            inc($_e)
          end while
          %playing[$clip_i] := 0
          %looping[$clip_i] := 0
        end if
        inc($clip_i)
      end while
    end if
    call update_midi_visibility
  end if
  if ($NI_UI_ID=get_ui_id($switch_closeMidi))
    $button_showMidi := 0
    set_controller(64,0)
    wait(1)
    $clip_i := 0
    while ($clip_i<num_elements(%midi_clip_preview_id))
      set_control_par(%midi_clip_preview_id[$clip_i],$CONTROL_PAR_VALUE,0)
      if (%playing[$clip_i]=1)
        get_event_ids(%_event_ids)
        $_e := 0
        while ($_e<num_elements(%_event_ids))
          if (%_event_ids[$_e] # 0)
            if (%custom_event_triggered_by_mf[%_event_ids[$_e] mod 1000000]=($clip_i+1))
              %custom_event_preview_being_stopped[%_event_ids[$_e] mod 1000000] := 1
              fade_out(%_event_ids[$_e],$DURATION_SIXTEENTH,1)
              if (in_range(get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE),$LOWEST_KEY,$HIGHEST_KEY))
                set_control_par(%key_ids[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)],$CONTROL_PAR_PICTURE_STATE,0)
                %key_down[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
                %key_active[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
              end if
            end if
          end if
          inc($_e)
        end while
        %playing[$clip_i] := 0
        %looping[$clip_i] := 0
      end if
      inc($clip_i)
    end while
    call update_midi_visibility
  end if
  $_index2 := search(%switch_midiPgChooser,$NI_UI_ID)
  if ($_index2 # -1)
    $cur_midi_page := $_index2
    call update_midi_visibility
    $i := 0
    while ($i<2)
      if ($i=$cur_midi_page)
        set_control_par(%switch_midiPgChooser[$i],$CONTROL_PAR_VALUE,1)
      else
        set_control_par(%switch_midiPgChooser[$i],$CONTROL_PAR_VALUE,0)
      end if
      inc($i)
    end while
  end if
  if ($NI_UI_ID=get_ui_id($button_generalInfo))
    $button_showMidi := 0
    call update_midi_visibility
    if (get_control_par(get_ui_id($switch_generalInfoDisp),$CONTROL_PAR_HIDE)=$HIDE_WHOLE_CONTROL)
      set_control_par(get_ui_id($switch_generalInfoDisp),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
    else
      set_control_par(get_ui_id($switch_generalInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    end if
  end if
  if ($NI_UI_ID=get_ui_id($switch_generalInfoDisp))
    set_control_par(get_ui_id($switch_generalInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
  if ($NI_UI_ID=get_ui_id($button_articulationsInfo))
    set_control_par(get_ui_id($switch_articulationsInfoDisp),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
  end if
  if ($NI_UI_ID=get_ui_id($switch_articulationsInfoDisp))
    set_control_par(get_ui_id($switch_articulationsInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
  if ($NI_UI_ID=get_ui_id($button_optionsInfo))
    $button_showMidi := 0
    call update_midi_visibility
    if (get_control_par(get_ui_id($switch_optionsInfoDisp),$CONTROL_PAR_HIDE)=$HIDE_WHOLE_CONTROL)
      set_control_par(get_ui_id($switch_optionsInfoDisp),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
    else
      set_control_par(get_ui_id($switch_optionsInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    end if
  end if
  if ($NI_UI_ID=get_ui_id($switch_optionsInfoDisp))
    set_control_par(get_ui_id($switch_optionsInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
  if ($NI_UI_ID=get_ui_id($button_speedInfo))
    set_control_par(get_ui_id($switch_speedInfoDisp),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
  end if
  if ($NI_UI_ID=get_ui_id($switch_speedInfoDisp))
    set_control_par(get_ui_id($switch_speedInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
  if ($NI_UI_ID=get_ui_id($button_directionInfo))
    set_control_par(get_ui_id($switch_directionInfoDisp),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
  end if
  if ($NI_UI_ID=get_ui_id($switch_directionInfoDisp))
    set_control_par(get_ui_id($switch_directionInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
  if ($NI_UI_ID=get_ui_id($button_legatoInfo))
    set_control_par(get_ui_id($switch_legatoInfoDisp),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
  end if
  if ($NI_UI_ID=get_ui_id($switch_legatoInfoDisp))
    set_control_par(get_ui_id($switch_legatoInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
  if ($NI_UI_ID=get_ui_id($button_releaseSamplesInfo))
    set_control_par(get_ui_id($switch_releaseSamplesInfoDisp),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
  end if
  if ($NI_UI_ID=get_ui_id($switch_releaseSamplesInfoDisp))
    set_control_par(get_ui_id($switch_releaseSamplesInfoDisp),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  end if
  $_index2 := search(%midi_clip_preview_id,$NI_UI_ID)
  if ($_index2 # -1)
    set_controller(64,0)
    wait(1)
    if (get_control_par($NI_UI_ID,$CONTROL_PAR_VALUE)=0)
      %playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
      %looping[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
      get_event_ids(%_event_ids)
      $_e := 0
      while ($_e<num_elements(%_event_ids))
        if (%_event_ids[$_e] # 0)
          if (%custom_event_triggered_by_mf[%_event_ids[$_e] mod 1000000]=(get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+1))
            %custom_event_preview_being_stopped[%_event_ids[$_e] mod 1000000] := 1
            fade_out(%_event_ids[$_e],$DURATION_SIXTEENTH,1)
            if (in_range(get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE),$LOWEST_KEY,$HIGHEST_KEY))
              set_control_par(%key_ids[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)],$CONTROL_PAR_PICTURE_STATE,0)
              %key_down[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
              %key_active[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
            end if
          end if
        end if
        inc($_e)
      end while
      %cb_id[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := $NI_CALLBACK_ID
    else
      %cb_id[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := $NI_CALLBACK_ID
      $_other_clip_i := 0
      while ($_other_clip_i<num_elements(%midi_clip_preview_id))
        if ($_index2 # $_other_clip_i)
          set_control_par(%midi_clip_preview_id[$_other_clip_i],$CONTROL_PAR_VALUE,0)
          if (%playing[$_other_clip_i]=1)
            get_event_ids(%_event_ids)
            $_e := 0
            while ($_e<num_elements(%_event_ids))
              if (%_event_ids[$_e] # 0)
                if (%custom_event_triggered_by_mf[%_event_ids[$_e] mod 1000000]=($_other_clip_i+1))
                  %custom_event_preview_being_stopped[%_event_ids[$_e] mod 1000000] := 1
                  fade_out(%_event_ids[$_e],$DURATION_SIXTEENTH,1)
                  if (in_range(get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE),$LOWEST_KEY,$HIGHEST_KEY))
                    set_control_par(%key_ids[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)],$CONTROL_PAR_PICTURE_STATE,0)
                    %key_down[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
                    %key_active[get_event_par(%_event_ids[$_e],$EVENT_PAR_NOTE)] := 0
                  end if
                end if
              end if
              inc($_e)
            end while
            %playing[$_other_clip_i] := 0
            %looping[$_other_clip_i] := 0
          end if
        end if
        inc($_other_clip_i)
      end while
      %looping[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 1
      while (%looping[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=1 and (%cb_id[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=$NI_CALLBACK_ID))
        if (%clip_loop_enabled[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=0)
          %looping[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
        end if
        if ($button_showMidi=0)
          %looping[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
        end if
        %cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
        %midi_file_pos_ticks[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
        %time_started[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := $ENGINE_UPTIME
        call midi_clip_play_cursors
        %playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 1
        while (%playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=1 and (%cb_id[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=$NI_CALLBACK_ID))
          if (%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=%num_midi_events[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)])
            $_ticks_until_next_event := %clip_length[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]-%midi_file_pos_ticks[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]
          else
            $_ticks_until_next_event := %_midi_pos[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]]-%midi_file_pos_ticks[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]
          end if
          if ($_ticks_until_next_event>0)
            wait(ticks_to_ms($_ticks_until_next_event))
          end if
          if (%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]>%num_midi_events[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)])
            %playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
          end if
          if ($button_showMidi=0)
            %playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
          end if
          if (%playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=1 and (%cb_id[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=$NI_CALLBACK_ID))
            %midi_file_pos_ticks[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := %midi_file_pos_ticks[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]+$_ticks_until_next_event
            if (%_midi_command[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]]=$MIDI_COMMAND_NOTE_ON)
              $_note := %_midi_byte_1[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]]
              $_velocity := %_midi_byte_2[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]]
              $_length := ticks_to_ms(%_midi_length[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]])
              $_note_id4 := play_note($_note,$_velocity,0,$_length)
              %custom_event_triggered_by_mf[$_note_id4 mod 1000000] := get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+1
              %custom_event_source[$_note_id4 mod 1000000] := -1
              set_event_par_arr($_note_id4,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
              set_key_pressed($_note,1)
              %key_down[$_note] := 1
              %velo[$_note] := $_velocity
              $_ks_index := search(%articulation_keyswitches,$_note)
              if ($_ks_index # -1)
                $cur_artic := $_ks_index
                call update_articulation_switches
              end if
              $_ks_index := search(%speed_keyswitches,$_note)
              if ($_ks_index # -1)
                $slider_speed := $_ks_index
                call update_speed_switches
                call update_speed
                $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)]
                if (get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
                  set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
                else
                  if (get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
                    set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
                  else
                    if (in_range(get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
                      set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
                    end if
                  end if
                end if
              end if
              $_ks_index := search(%direction_keyswitches,$_note)
              if ($_ks_index # -1)
                $slider_direction := $_ks_index
                call update_direction_switches
                $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)]
                if (get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
                  set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
                else
                  if (get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
                    set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
                  else
                    if (in_range(get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
                      set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_direction),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
                    end if
                  end if
                end if
              end if
              $_ks_index := search(%legato_keyswitches,$_note)
              if ($_ks_index # -1)
                $slider_legato := $_ks_index
                call update_legato_switches
                $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)]
                if (get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
                  set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
                else
                  if (get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
                    set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
                  else
                    if (in_range(get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
                      set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_legato),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
                    end if
                  end if
                end if
              end if
              $_ks_index := search(%release_sample_keyswitches,$_note)
              if ($_ks_index # -1)
                $slider_releaseSamples := $_ks_index
                call update_releaseSamples_switches
                $_ui_id := %ctrl_ids[get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)]
                if (get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
                  set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
                else
                  if (get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
                    set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
                  else
                    if (in_range(get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
                      set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
                    end if
                  end if
                end if
              end if
              $_ks_index := search(%release_trigger_keyswitches,$_note)
              if ($_ks_index # -1)
                $recent_release_trigger_key := %release_trigger_keyswitches[$_ks_index]
                $switch_releaseTrigger := 1
                call trigger_release_samples_for_all_ripples
              end if
              if (search(%all_keyswitches,$_note) # -1)
                call set_keys_pressed
              end if
              if (in_range($_note,$LOWEST_KEY,$HIGHEST_KEY))
                %key_active[$_note] := 1
                %key_timestamp[$_note] := $ENGINE_UPTIME
                %velo[$_note] := $_velocity
                set_control_par(%key_ids[$_note],$CONTROL_PAR_PICTURE_STATE,1)
                $key_i := num_elements(%key_history)-2
                while ($key_i>=0)
                  %key_history[$key_i+1] := %key_history[$key_i]
                  dec($key_i)
                end while
                %key_history[0] := $_note
                call count_keys_pressed
                if ($num_keys_pressed>1)
                  $_num_ripples := 0
                  $_closest_neighbor := -1
                  $_closest_neighbor_interval := 12
                  $array_i := 0
                  while ($array_i<num_elements(%_neighbor))
                    %_neighbor[$array_i] := 0
                    inc($array_i)
                  end while
                  $array_i := 0
                  while ($array_i<num_elements(%_lower_neighbor))
                    %_lower_neighbor[$array_i] := 0
                    inc($array_i)
                  end while
                  $array_i := 0
                  while ($array_i<num_elements(%_upper_neighbor))
                    %_upper_neighbor[$array_i] := 0
                    inc($array_i)
                  end while
                  $_num_neighbors := 0
                  $_num_lower_neighbors := 0
                  $_num_upper_neighbors := 0
                  $i := 1
                  while ($i<=$MAX_INTERVAL)
                    $_dir := 0
                    while ($_dir<=1)
                      $_sign := $_dir*2-1
                      $_other_note := $_note+($i*$_sign)
                      if (%key_down[$_other_note]=1)
                        %_neighbor[$_num_neighbors] := $_other_note
                        inc($_num_neighbors)
                        if ($_other_note<$_note)
                          %_lower_neighbor[$_num_lower_neighbors] := $_other_note
                          inc($_num_lower_neighbors)
                        end if
                        if ($_other_note>$_note)
                          %_upper_neighbor[$_num_upper_neighbors] := $_other_note
                          inc($_num_upper_neighbors)
                        end if
                      end if
                      inc($_dir)
                    end while
                    inc($i)
                  end while
                  if (%_lower_neighbor[0] # 0 and (%_upper_neighbor[0] # 0))
                    $_lower_neighbor_time_held := $ENGINE_UPTIME-%key_timestamp[%_lower_neighbor[0]]
                    $_upper_neighbor_time_held := $ENGINE_UPTIME-%key_timestamp[%_upper_neighbor[0]]
                    if (abs($_upper_neighbor_time_held-$_lower_neighbor_time_held)<50)
                      $_make_ripples_to_both_adjacent_neighbors := 1
                    else
                      $_make_ripples_to_both_adjacent_neighbors := 0
                    end if
                    if ($slider_direction=$DIRECTION_MODE__UP or ($slider_direction=$DIRECTION_MODE__DOWN))
                      $_make_ripples_to_both_adjacent_neighbors := 1
                    end if
                    if ($_make_ripples_to_both_adjacent_neighbors=1)
                      %__notes[0] := %_lower_neighbor[0]
                      %__intervals[0] := $_note-%_lower_neighbor[0]
                      %__notes[1] := %_upper_neighbor[0]
                      %__intervals[1] := $_note-%_upper_neighbor[0]
                      $_num_ripples := 2
                    else
                      if ($_make_ripples_to_both_adjacent_neighbors=0)
                        if (search(%key_history,%_lower_neighbor[0])<search(%key_history,%_upper_neighbor[0]))
                          %__notes[0] := %_lower_neighbor[0]
                          %__intervals[0] := $_note-%_lower_neighbor[0]
                        else
                          %__notes[0] := %_upper_neighbor[0]
                          %__intervals[0] := $_note-%_upper_neighbor[0]
                        end if
                        $_num_ripples := 1
                      end if
                    end if
                  else
                    %__notes[0] := %key_history[1]
                    %__intervals[0] := %key_history[0]-%key_history[1]
                    $_num_ripples := 1
                    if (abs(%__intervals[0])>$MAX_INTERVAL)
                      if ($_num_neighbors>0)
                        %__notes[0] := %_neighbor[0]
                        %__intervals[0] := $_note-%_neighbor[0]
                        $_num_ripples := 1
                      else
                        $array_i := 0
                        while ($array_i<num_elements(%__notes))
                          %__notes[$array_i] := 0
                          inc($array_i)
                        end while
                        $array_i := 0
                        while ($array_i<num_elements(%__intervals))
                          %__intervals[$array_i] := 0
                          inc($array_i)
                        end while
                        $_num_ripples := 0
                      end if
                    end if
                  end if
                  $array_i := 0
                  while ($array_i<num_elements(%__notes))
                    %_played_notes[$array_i] := %__notes[$array_i]
                    inc($array_i)
                  end while
                  $array_i := 0
                  while ($array_i<num_elements(%__intervals))
                    %_played_intervals[$array_i] := %__intervals[$array_i]
                    inc($array_i)
                  end while
                  $array_i := 0
                  while ($array_i<num_elements(%note_used_by_ripple))
                    %note_used_by_ripple[$array_i] := 0
                    inc($array_i)
                  end while
                  $_ripple_i := 0
                  while ($_ripple_i<$_num_ripples)
                    if ($slider_direction=$DIRECTION_MODE__UP)
                      if (%__intervals[$_ripple_i]<0)
                        %__notes[$_ripple_i] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
                        %__intervals[$_ripple_i] := -%__intervals[$_ripple_i]
                      end if
                    else
                      if ($slider_direction=$DIRECTION_MODE__DOWN)
                        if (%__intervals[$_ripple_i]>0)
                          %__notes[$_ripple_i] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
                          %__intervals[$_ripple_i] := -%__intervals[$_ripple_i]
                        end if
                      end if
                    end if
                    if (%__intervals[$_ripple_i]<0)
                      $_low_note2 := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
                      $_high_note2 := %__notes[$_ripple_i]
                    else
                      $_low_note2 := %__notes[$_ripple_i]
                      $_high_note2 := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
                    end if
                    if (%__intervals[$_ripple_i]>0)
                      $direction := $UP
                    else
                      $direction := $DOWN
                    end if
                    $_already_playing := 0
                    $r := 0
                    while ($r<100)
                      if (%ripple_id_history[$r] # 0)
                        if (%custom_event_low_note[%ripple_id_history[$r] mod 1000000]=$_low_note2 and (%key_released[$_low_note2]=0) and (%custom_event_high_note[%ripple_id_history[$r] mod 1000000]=$_high_note2) and (%key_released[$_high_note2]=0) and (%custom_event_high_note[%ripple_id_history[$r] mod 1000000]=$_high_note2) and (%custom_event_direction[%ripple_id_history[$r] mod 1000000]=$direction) and (%custom_event_releasing[%ripple_id_history[$r] mod 1000000]=0))
                          $_already_playing := 1
                        end if
                      end if
                      inc($r)
                    end while
                    %key_released[$_low_note2] := 0
                    %key_released[$_high_note2] := 0
                    if ($_already_playing=0)
                      $_do_legato := 0
                      call count_active_ripples
                      if ($num_active_ripples>0)
                        $_do_legato := 1
                      end if
                      if ($all_keys_released=1)
                        $_do_legato := 0
                      else
                        $_do_legato := 1
                      end if
                      $all_keys_released := 0
                      if ($_do_legato=0)
                        $first_ripple_timestamp := $ENGINE_UPTIME
                        $_real_legato_time := 0
                        $_offset_real_time := 0
                      else
                        $_real_legato_time := ($ENGINE_UPTIME-$first_ripple_timestamp)*1000
                        $_real_legato_time := int(real($_real_legato_time)/?speeds[$slider_speed])
                        select ($slider_legato)
                          case $LEGATO_MODE__SYNC_TO_PITCH
                            $_real_legato_time := $_real_legato_time+ticks_to_ms(1)
                            $_offset_real_time := $_real_legato_time mod ticks_to_ms(%ripple_length_ticks[$cur_artic]/%pitch_fractions[$cur_artic])
                          case $LEGATO_MODE__SYNC_TO_RIPPLE
                            $_offset_real_time := $_real_legato_time mod ticks_to_ms(%ripple_length_ticks[$cur_artic])
                          case $LEGATO_MODE__SYNC_TO_SWELL
                            $_offset_real_time := $_real_legato_time mod ticks_to_ms(%sample_length_ticks[$cur_artic])
                        end select
                      end if
                      $_offset_rec_time := int(real(0)+((real($_offset_real_time)-real(0))/(real(ticks_to_ms(%sample_length_ticks[$cur_artic]))-real(0))*(real(%rec_time_sample_lengths[$cur_artic])-real(0))))
                      $_note_id3 := play_note(%__notes[$_ripple_i],64+%__intervals[$_ripple_i],$_offset_rec_time,0)
                      $_volume := int(real(-12000)+((real($_velocity)-real(1))/(real(127)-real(1))*(real(3000)-real(-12000))))
                      if ($_offset_rec_time=0)
                        fade_in($_note_id3,$DURATION_SIXTEENTH)
                      end if
                      change_vol($_note_id3,$_volume,0)
                      set_event_par_arr($_note_id3,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
                      set_event_par_arr($_note_id3,$EVENT_PAR_ALLOW_GROUP,1,$cur_artic)
                      %custom_event_artic[$_note_id3 mod 1000000] := $cur_artic
                      %custom_event_note[$_note_id3 mod 1000000] := $_note
                      %custom_event_low_note[$_note_id3 mod 1000000] := $_low_note2
                      %custom_event_high_note[$_note_id3 mod 1000000] := $_high_note2
                      %custom_event_origin_note[$_note_id3 mod 1000000] := %__notes[$_ripple_i]
                      %custom_event_dest_note[$_note_id3 mod 1000000] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
                      %custom_event_first_note[$_note_id3 mod 1000000] := %_played_notes[$_ripple_i]
                      %custom_event_second_note[$_note_id3 mod 1000000] := %_played_notes[$_ripple_i]+%_played_intervals[$_ripple_i]
                      %custom_event_velocity[$_note_id3 mod 1000000] := $_velocity
                      if (%note_used_by_ripple[%custom_event_second_note[$_note_id3 mod 1000000]]=0)
                        %custom_event_voice[$_note_id3 mod 1000000] := %num_ripple_voices[%custom_event_second_note[$_note_id3 mod 1000000]]
                        inc(%num_ripple_voices[%custom_event_second_note[$_note_id3 mod 1000000]])
                        %note_used_by_ripple[%custom_event_second_note[$_note_id3 mod 1000000]] := 1
                      else
                        %custom_event_voice[$_note_id3 mod 1000000] := %num_ripple_voices[%custom_event_second_note[$_note_id3 mod 1000000]]-1
                      end if
                      %custom_event_direction[$_note_id3 mod 1000000] := $direction
                      %custom_event_source[$_note_id3 mod 1000000] := -1
                      %custom_event_triggered_by_mf[$_note_id3 mod 1000000] := %custom_event_triggered_by_mf[$_note_id4 mod 1000000]
                      $r := 100-2
                      while ($r>=0)
                        %ripple_id_history[$r+1] := %ripple_id_history[$r]
                        dec($r)
                      end while
                      %ripple_id_history[0] := $_note_id3
                      if ($_real_legato_time>0)
                        $_real_time_pos_in_ripple := ($_real_legato_time-ticks_to_ms(2)) mod ticks_to_ms(%ripple_length_ticks[$cur_artic])
                        $_real_time_pos_in_ripple := int(real($_real_time_pos_in_ripple)/?speeds[$slider_speed])
                        $_fade_in_time := ticks_to_ms(%ripple_length_ticks[$cur_artic])-$_real_time_pos_in_ripple
                        if ($_fade_in_time<150000)
                          $_fade_in_time := 150000
                        end if
                        fade_in($_note_id3,$_fade_in_time)
                      end if
                    end if
                    inc($_ripple_i)
                  end while
                end if
              end if
            end if
            if (%_midi_command[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]]=$MIDI_COMMAND_CC)
              $_cc_num := %_midi_byte_1[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]]
              set_controller($_cc_num,%_midi_byte_2[1000*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]])
              wait(1)
              if ($_cc_num=64)
                if (%CC[64]<10 and ($_prev_cc64>=10))
                  $_i2 := 0
                  while ($_i2<$num_notes_to_release)
                    %key_active[%notes_to_release[$_i2]] := %key_down[%notes_to_release[$_i2]]
                    if (%voices_to_release[$_i2]=-1)
                      message("voice = " & %voices_to_release[$_i2])
                    end if
                    $_r3 := 0
                    while ($_r3<100)
                      if (%ripple_id_history[$_r3] # 0)
                        if (%voices_to_release[$_i2]=%custom_event_voice[%ripple_id_history[$_r3] mod 1000000])
                          $_artic4 := %custom_event_artic[%ripple_id_history[$_r3] mod 1000000]
                          $_rec_time_pos_in_ripple := get_event_par(%ripple_id_history[$_r3],$EVENT_PAR_PLAY_POS) mod %rec_time_ripple_lengths[$_artic4]
                          $_real_time_pos_in_pulse := int(real(0)+((real($_rec_time_pos_in_ripple)-real(0))/(real(%rec_time_ripple_lengths[$_artic4])-real(0))*(real(ticks_to_ms(%ripple_length_ticks[$_artic4]))-real(0))))
                          $_real_time_pos_in_pulse := int(real($_real_time_pos_in_pulse)*?speeds[$slider_speed])
                          $_real_time_ripple_length := ticks_to_ms(int(real(%ripple_length_ticks[$_artic4])*?speeds[$slider_speed]))
                          $_time_til_end_of_ripple := ($_real_time_ripple_length-$_real_time_pos_in_pulse)/1000
                          if (%notes_to_release[$_i2]=%custom_event_second_note[%ripple_id_history[$_r3] mod 1000000])
                            %custom_event_note_off_timestamp[%ripple_id_history[$_r3] mod 1000000] := $ENGINE_UPTIME
                            if ($slider_releaseSamples=0)
                              if (%key_down[$recent_release_trigger_key]=1)
                                $_play_release_sample := 1
                              else
                                $_play_release_sample := 0
                              end if
                            else
                              if ($slider_releaseSamples>0)
                                $_play_release_sample := 1
                              end if
                            end if
                            if ($_play_release_sample=0)
                              %custom_event_releasing[%ripple_id_history[$_r3] mod 1000000] := 1
                              $_fade_out_time2 := $_time_til_end_of_ripple
                              %custom_event_release_length[%ripple_id_history[$_r3] mod 1000000] := $_fade_out_time2
                              fade_out(%ripple_id_history[$_r3],$_fade_out_time2*1000,1)
                            else
                              %custom_event_time_til_note_off[%ripple_id_history[$_r3] mod 1000000] := $_time_til_end_of_ripple
                              %custom_event_waiting_to_trigger_release_sample[%ripple_id_history[$_r3] mod 1000000] := 1
                            end if
                          end if
                        end if
                      end if
                      inc($_r3)
                    end while
                    call count_keys_pressed
                    if ($num_keys_pressed=0)
                      $all_keys_released := 1
                    end if
                    inc($_i2)
                  end while
                  $array_i := 0
                  while ($array_i<num_elements(%notes_to_release))
                    %notes_to_release[$array_i] := 0
                    inc($array_i)
                  end while
                  $array_i := 0
                  while ($array_i<num_elements(%voices_to_release))
                    %voices_to_release[$array_i] := 0
                    inc($array_i)
                  end while
                  $num_notes_to_release := 0
                end if
                $_prev_cc64 := %CC[64]
              end if
            end if
            inc(%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)])
          end if
          if (%cur_event[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]>%num_midi_events[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)])
            %playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
          end if
          if ($button_showMidi=0)
            %playing[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)] := 0
          end if
        end while
      end while
      if (%cb_id[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]=$NI_CALLBACK_ID)
        set_control_par($NI_UI_ID,$CONTROL_PAR_VALUE,0)
      end if
    end if
  end if
  $_index2 := search(%articulation_ids,$NI_UI_ID)
  if ($_index2 # -1)
    $cur_artic := $_index2
    call update_articulation_switches
  end if
  if ($NI_UI_ID=get_ui_id($slider_speed))
    call update_speed_switches
    call update_speed
  end if
  $_index2 := search(%speed_ids,$NI_UI_ID)
  if ($_index2 # -1)
    $slider_speed := $_index2
    call update_speed_switches
    call update_speed
  end if
  if ($NI_UI_ID=get_ui_id($slider_direction))
    call update_direction_switches
  end if
  $_index2 := search(%direction_ids,$NI_UI_ID)
  if ($_index2 # -1)
    $slider_direction := $_index2
    call update_direction_switches
  end if
  if ($NI_UI_ID=get_ui_id($slider_legato))
    call update_legato_switches
  end if
  $_index2 := search(%legato_ids,$NI_UI_ID)
  if ($_index2 # -1)
    $slider_legato := $_index2
    call update_legato_switches
  end if
  if ($NI_UI_ID=get_ui_id($slider_releaseSamples))
    call update_releaseSamples_switches
  end if
  $_index2 := search(%releaseSamples_ids,$NI_UI_ID)
  if ($_index2 # -1)
    $slider_releaseSamples := $_index2
    call update_releaseSamples_switches
  end if
  if ($NI_UI_ID=get_ui_id($switch_releaseTrigger))
    $switch_releaseTrigger := 0
    %key_down[$recent_release_trigger_key] := 1
    call trigger_release_samples_for_all_ripples
    set_key_pressed(%release_trigger_keyswitches[0],1)
    set_key_pressed(%release_trigger_keyswitches[1],1)
    wait(100000)
    set_key_pressed(%release_trigger_keyswitches[0],0)
    set_key_pressed(%release_trigger_keyswitches[1],0)
  end if
  if ($NI_UI_ID=get_ui_id($slider_vol))
    if (in_range($slider_vol,0,500000))
      set_engine_par($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,int(real(real_to_int(pow(2.0,(-16000.0-12000.0+346768.2342478351)/18000.0)))+((real($slider_vol)-real(0))/(real(500000)-real(0))*(real(real_to_int(pow(2.0,(0.0-12000.0+346768.2342478351)/18000.0)))-real(real_to_int(pow(2.0,(-16000.0-12000.0+346768.2342478351)/18000.0)))))),-1,0,1)
    else
      if (in_range($slider_vol,500000,1000000))
        set_engine_par($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,int(real(real_to_int(pow(2.0,(0.0-12000.0+346768.2342478351)/18000.0)))+((real($slider_vol)-real(500000))/(real(1000000)-real(500000))*(real(real_to_int(pow(2.0,(9000.0-12000.0+346768.2342478351)/18000.0)))-real(real_to_int(pow(2.0,(0.0-12000.0+346768.2342478351)/18000.0)))))),-1,0,1)
      end if
    end if
  end if
  if ($NI_UI_ID=get_ui_id($menu_reverb))
    if ($menu_reverb=3)
      %_reverb_preset[8*$prev_reverb+0] := get_engine_par($ENGINE_PAR_RAUM_TYPE,-1,0,0)
      %_reverb_preset[8*$prev_reverb+1] := get_engine_par($ENGINE_PAR_RAUM_DECAY,-1,0,0)
      %_reverb_preset[8*$prev_reverb+2] := get_engine_par($ENGINE_PAR_RAUM_SIZE,-1,0,0)
      %_reverb_preset[8*$prev_reverb+3] := get_engine_par($ENGINE_PAR_RAUM_DIFFUSION,-1,0,0)
      %_reverb_preset[8*$prev_reverb+4] := get_engine_par($ENGINE_PAR_RAUM_MOD,-1,0,0)
      %_reverb_preset[8*$prev_reverb+5] := get_engine_par($ENGINE_PAR_RAUM_DAMPING,-1,0,0)
      %_reverb_preset[8*$prev_reverb+6] := get_engine_par($ENGINE_PAR_RAUM_LOWSHELF,-1,0,0)
      %_reverb_preset[8*$prev_reverb+7] := get_engine_par($ENGINE_PAR_RAUM_HIGHCUT,-1,0,0)
      $menu_reverb := $prev_reverb
    else
      set_engine_par($ENGINE_PAR_RAUM_TYPE,%_reverb_preset[8*$menu_reverb+0],-1,0,0)
      set_engine_par($ENGINE_PAR_RAUM_DECAY,%_reverb_preset[8*$menu_reverb+1],-1,0,0)
      set_engine_par($ENGINE_PAR_RAUM_SIZE,%_reverb_preset[8*$menu_reverb+2],-1,0,0)
      set_engine_par($ENGINE_PAR_RAUM_DIFFUSION,%_reverb_preset[8*$menu_reverb+3],-1,0,0)
      set_engine_par($ENGINE_PAR_RAUM_MOD,%_reverb_preset[8*$menu_reverb+4],-1,0,0)
      set_engine_par($ENGINE_PAR_RAUM_DAMPING,%_reverb_preset[8*$menu_reverb+5],-1,0,0)
      set_engine_par($ENGINE_PAR_RAUM_LOWSHELF,%_reverb_preset[8*$menu_reverb+6],-1,0,0)
      set_engine_par($ENGINE_PAR_RAUM_HIGHCUT,%_reverb_preset[8*$menu_reverb+7],-1,0,0)
    end if
    call set_reverb_menu_checkmark
    $prev_reverb := $menu_reverb
  end if
  if ($NI_UI_ID=get_ui_id($slider_reverb))
    ~_vol := real($slider_reverb)/1000000.0
    if (~_vol<0.0000001)
      ~_vol := 0.0000001
    end if
    ~_db := 20.0*(log(~_vol)/log(int_to_real(10)))
    set_engine_par($ENGINE_PAR_SENDLEVEL_0,real_to_int(pow(2.0,(~_db*1000.0+346768.2342478351)/18000.0)),-1,7,0)
  end if
  if (search(%articulation_ids,$NI_UI_ID) # -1 or (search(%speed_ids,$NI_UI_ID) # -1) or (search(%direction_ids,$NI_UI_ID) # -1) or (search(%legato_ids,$NI_UI_ID) # -1) or (search(%releaseSamples_ids,$NI_UI_ID) # -1) or ($NI_UI_ID=get_ui_id($slider_speed)) or ($NI_UI_ID=get_ui_id($slider_direction)) or ($NI_UI_ID=get_ui_id($slider_legato)) or ($NI_UI_ID=get_ui_id($slider_releaseSamples)))
    call set_keys_pressed
  end if
  if (search(%speed_ids,$NI_UI_ID) # -1 or (search(%direction_ids,$NI_UI_ID) # -1) or (search(%legato_ids,$NI_UI_ID) # -1) or (search(%releaseSamples_ids,$NI_UI_ID) # -1) or ($NI_UI_ID=get_ui_id($slider_vol)) or ($NI_UI_ID=get_ui_id($slider_reverb)) or ($NI_UI_ID=get_ui_id($slider_speed)) or ($NI_UI_ID=get_ui_id($slider_direction)) or ($NI_UI_ID=get_ui_id($slider_legato)) or ($NI_UI_ID=get_ui_id($slider_releaseSamples)))
    $_ui_id := %ctrl_ids[get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)]
    if (get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_vol),$CONTROL_PAR_CUSTOM_ID))
      set_control_par_str(get_ui_id($slider_vol),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,-1,0,1) & " dB")
    else
      if (get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)=get_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_CUSTOM_ID))
        set_control_par_str(get_ui_id($slider_reverb),$CONTROL_PAR_LABEL,get_engine_par_disp($ENGINE_PAR_SENDLEVEL_0,-1,7,0))
      else
        if (in_range(get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_speed),$CONTROL_PAR_CUSTOM_ID),get_control_par(get_ui_id($slider_releaseSamples),$CONTROL_PAR_CUSTOM_ID)))
          set_control_par_str($_ui_id,$CONTROL_PAR_LABEL,!_option_texts_shortened[10*get_control_par($NI_UI_ID,$CONTROL_PAR_CUSTOM_ID)+get_control_par($_ui_id,$CONTROL_PAR_VALUE)])
        end if
      end if
    end if
  end if
  if ($NI_UI_ID=get_ui_id($switch_logoAnimTrigger))
    set_control_par(get_ui_id($label_version),$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
    $timestamp_version_shown := $ENGINE_UPTIME
    if ($slider_logoAnim=0)
      $slider_logoAnim := 0
      while ($slider_logoAnim<127)
        inc($slider_logoAnim)
        wait(5000)
      end while
      $slider_logoAnim := 0
    end if
  end if
end on


{ Compiled on Thu May 16 13:10:17 2024 }
on init
  declare $sksp_dummy
  declare $concat_it
  declare $concat_offset
  declare $string_it
  declare $list_it
  declare $preproc_i
  message("")
  declare ~power_curve_norm
  declare %hide_states[2] := ($HIDE_WHOLE_CONTROL, $HIDE_PART_NOTHING)
  declare $array_i
  declare %black_keys[5] := (1, 3, 6, 8, 10)
  declare !tempo_names[9]
  !tempo_names[0] := "1/32"
  !tempo_names[1] := "1/16 T"
  !tempo_names[2] := "1/16"
  !tempo_names[3] := "1/8 T"
  !tempo_names[4] := "1/8"
  !tempo_names[5] := "1/4 T"
  !tempo_names[6] := "1/4"
  !tempo_names[7] := "1/2"
  !tempo_names[8] := "Bar"
  declare !NOTE_NAME[127]
  declare const $NOTE_NAME__SIZE := 127
  !NOTE_NAME[0] := "C"
  !NOTE_NAME[1] := "C#"
  !NOTE_NAME[2] := "D"
  !NOTE_NAME[3] := "D#"
  !NOTE_NAME[4] := "E"
  !NOTE_NAME[5] := "F"
  !NOTE_NAME[6] := "F#"
  !NOTE_NAME[7] := "G"
  !NOTE_NAME[8] := "G#"
  !NOTE_NAME[9] := "A"
  !NOTE_NAME[10] := "A#"
  !NOTE_NAME[11] := "B"
  !NOTE_NAME[12] := "C"
  !NOTE_NAME[13] := "C#"
  !NOTE_NAME[14] := "D"
  !NOTE_NAME[15] := "D#"
  !NOTE_NAME[16] := "E"
  !NOTE_NAME[17] := "F"
  !NOTE_NAME[18] := "F#"
  !NOTE_NAME[19] := "G"
  !NOTE_NAME[20] := "G#"
  !NOTE_NAME[21] := "A"
  !NOTE_NAME[22] := "A#"
  !NOTE_NAME[23] := "B"
  !NOTE_NAME[24] := "C"
  !NOTE_NAME[25] := "C#"
  !NOTE_NAME[26] := "D"
  !NOTE_NAME[27] := "D#"
  !NOTE_NAME[28] := "E"
  !NOTE_NAME[29] := "F"
  !NOTE_NAME[30] := "F#"
  !NOTE_NAME[31] := "G"
  !NOTE_NAME[32] := "G#"
  !NOTE_NAME[33] := "A"
  !NOTE_NAME[34] := "A#"
  !NOTE_NAME[35] := "B"
  !NOTE_NAME[36] := "C"
  !NOTE_NAME[37] := "C#"
  !NOTE_NAME[38] := "D"
  !NOTE_NAME[39] := "D#"
  !NOTE_NAME[40] := "E"
  !NOTE_NAME[41] := "F"
  !NOTE_NAME[42] := "F#"
  !NOTE_NAME[43] := "G"
  !NOTE_NAME[44] := "G#"
  !NOTE_NAME[45] := "A"
  !NOTE_NAME[46] := "A#"
  !NOTE_NAME[47] := "B"
  !NOTE_NAME[48] := "C"
  !NOTE_NAME[49] := "C#"
  !NOTE_NAME[50] := "D"
  !NOTE_NAME[51] := "D#"
  !NOTE_NAME[52] := "E"
  !NOTE_NAME[53] := "F"
  !NOTE_NAME[54] := "F#"
  !NOTE_NAME[55] := "G"
  !NOTE_NAME[56] := "G#"
  !NOTE_NAME[57] := "A"
  !NOTE_NAME[58] := "A#"
  !NOTE_NAME[59] := "B"
  !NOTE_NAME[60] := "C"
  !NOTE_NAME[61] := "C#"
  !NOTE_NAME[62] := "D"
  !NOTE_NAME[63] := "D#"
  !NOTE_NAME[64] := "E"
  !NOTE_NAME[65] := "F"
  !NOTE_NAME[66] := "F#"
  !NOTE_NAME[67] := "G"
  !NOTE_NAME[68] := "G#"
  !NOTE_NAME[69] := "A"
  !NOTE_NAME[70] := "A#"
  !NOTE_NAME[71] := "B"
  !NOTE_NAME[72] := "C"
  !NOTE_NAME[73] := "C#"
  !NOTE_NAME[74] := "D"
  !NOTE_NAME[75] := "D#"
  !NOTE_NAME[76] := "E"
  !NOTE_NAME[77] := "F"
  !NOTE_NAME[78] := "F#"
  !NOTE_NAME[79] := "G"
  !NOTE_NAME[80] := "G#"
  !NOTE_NAME[81] := "A"
  !NOTE_NAME[82] := "A#"
  !NOTE_NAME[83] := "B"
  !NOTE_NAME[84] := "C"
  !NOTE_NAME[85] := "C#"
  !NOTE_NAME[86] := "D"
  !NOTE_NAME[87] := "D#"
  !NOTE_NAME[88] := "E"
  !NOTE_NAME[89] := "F"
  !NOTE_NAME[90] := "F#"
  !NOTE_NAME[91] := "G"
  !NOTE_NAME[92] := "G#"
  !NOTE_NAME[93] := "A"
  !NOTE_NAME[94] := "A#"
  !NOTE_NAME[95] := "B"
  !NOTE_NAME[96] := "C"
  !NOTE_NAME[97] := "C#"
  !NOTE_NAME[98] := "D"
  !NOTE_NAME[99] := "D#"
  !NOTE_NAME[100] := "E"
  !NOTE_NAME[101] := "F"
  !NOTE_NAME[102] := "F#"
  !NOTE_NAME[103] := "G"
  !NOTE_NAME[104] := "G#"
  !NOTE_NAME[105] := "A"
  !NOTE_NAME[106] := "A#"
  !NOTE_NAME[107] := "B"
  !NOTE_NAME[108] := "C"
  !NOTE_NAME[109] := "C#"
  !NOTE_NAME[110] := "D"
  !NOTE_NAME[111] := "D#"
  !NOTE_NAME[112] := "E"
  !NOTE_NAME[113] := "F"
  !NOTE_NAME[114] := "F#"
  !NOTE_NAME[115] := "G"
  !NOTE_NAME[116] := "G#"
  !NOTE_NAME[117] := "A"
  !NOTE_NAME[118] := "A#"
  !NOTE_NAME[119] := "B"
  !NOTE_NAME[120] := "C"
  !NOTE_NAME[121] := "C#"
  !NOTE_NAME[122] := "D"
  !NOTE_NAME[123] := "D#"
  !NOTE_NAME[124] := "E"
  !NOTE_NAME[125] := "F"
  !NOTE_NAME[126] := "F#"
  declare const $MEM_SIZE := 1000000
  declare const $STACK_SIZE := 1000
  declare const $MAX_TASKS := $MEM_SIZE/$STACK_SIZE-1
  declare const $TASK_0 := $MEM_SIZE-($STACK_SIZE*$MAX_TASKS)
  declare const $TOO_MANY_TASKS := 1
  declare const $STACK_OVERFLOW := 2
  declare const $STACK_UNDERFLOW := 3
  declare %p[$MEM_SIZE]
  declare $sp
  $sp := $TASK_0+$STACK_SIZE
  declare $fp
  $fp := $TASK_0+$STACK_SIZE
  declare $tx
  declare %tstate__id[$MAX_TASKS]
  declare %tstate__sp[$MAX_TASKS]
  declare %tstate__fp[$MAX_TASKS]
  declare %tstate__fs[$MAX_TASKS]
  $tx := 0
  while ($tx<$MAX_TASKS)
    %tstate__fs[$tx] := $TASK_0+($tx*$STACK_SIZE)
    inc($tx)
  end while
  $tx := 0
  %tstate__id[0] := -1
  pgs_create_key(TCM_EXCEPTION,5)
  pgs_set_key_val(TCM_EXCEPTION,$CURRENT_SCRIPT_SLOT,0)
  set_key_pressed_support(1)
  set_snapshot_type(3)
  declare %dev_mode[1]
  load_array(%dev_mode,2)
  set_listener($NI_SIGNAL_TIMER_MS,1000000/30)
  set_listener($NI_SIGNAL_TRANSP_START,1)
  SET_CONDITION(NO_SYS_SCRIPT_PEDAL)
  declare const $NUM_ARTICULATIONS := 3
  declare const $DOWN := 0
  declare const $UP := 1
  declare const $NUM_RRS := 4
  declare const $MAX_NUM_CHORD_IDS := 1000
  declare %EVENT[10] := (0, 1, 2, 3, 4, 5, 6, 7, 8, 9)
  declare const $EVENT__SIZE := 10
  declare const $EVENT__LOW_NOTE := 0
  declare const $EVENT__HIGH_NOTE := 1
  declare const $EVENT__ROW := 2
  declare const $EVENT__DIRECTION := 3
  declare const $EVENT__ARTIC := 4
  declare const $EVENT__CHANNEL := 5
  declare const $EVENT__RELEASE_TIMESTAMP := 6
  declare const $EVENT__RELEASE_LENGTH := 7
  declare const $EVENT__BRIGHTNESS_ON_RELEASE := 8
  declare const $EVENT__FADING_OUT := 9
  declare !direction_strings[2]
  !direction_strings[0] := "triangle left"
  !direction_strings[1] := "triangle right"
  declare const $RECORDED_DURATION_QUARTER := 545455
  declare const $RECORDED_DURATION_EIGHTH := 272727
  declare const $MAX_INTERVAL := 5
  declare const $MIN_BRIGHTNESS := 24
  declare %ARTIC[3] := (0, 1, 2)
  declare const $ARTIC__SIZE := 3
  declare const $ARTIC__QUARTERS := 0
  declare const $ARTIC__EIGHTHS := 1
  declare const $ARTIC__SIXTEENTHS := 2
  declare %DIRECTION_MODE[3] := (0, 1, 2)
  declare const $DIRECTION_MODE__SIZE := 3
  declare const $DIRECTION_MODE__DOWN := 0
  declare const $DIRECTION_MODE__ASPLAYED := 1
  declare const $DIRECTION_MODE__UP := 2
  declare %LEGATO_MODE[4] := (0, 1, 2, 3)
  declare const $LEGATO_MODE__SIZE := 4
  declare const $LEGATO_MODE__OFF := 0
  declare const $LEGATO_MODE__SYNC_TO_PITCH := 1
  declare const $LEGATO_MODE__SYNC_TO_RIPPLE := 2
  declare const $LEGATO_MODE__SYNC_TO_SWELL := 3
  declare %sample_lengths[$ARTIC__SIZE]
  %sample_lengths[$ARTIC__QUARTERS] := $RECORDED_DURATION_QUARTER*16
  %sample_lengths[$ARTIC__EIGHTHS] := $RECORDED_DURATION_QUARTER*8
  %sample_lengths[$ARTIC__SIXTEENTHS] := $RECORDED_DURATION_QUARTER*8
  declare %recorded_pulse_lengths[$ARTIC__SIZE]
  %recorded_pulse_lengths[$ARTIC__QUARTERS] := $RECORDED_DURATION_QUARTER*2
  %recorded_pulse_lengths[$ARTIC__EIGHTHS] := $RECORDED_DURATION_QUARTER
  %recorded_pulse_lengths[$ARTIC__SIXTEENTHS] := $RECORDED_DURATION_QUARTER
  declare %pulse_lengths_ticks[$ARTIC__SIZE]
  %pulse_lengths_ticks[$ARTIC__QUARTERS] := 960*2
  %pulse_lengths_ticks[$ARTIC__EIGHTHS] := 960
  %pulse_lengths_ticks[$ARTIC__SIXTEENTHS] := 960
  declare const $LOWEST_KEY := 36
  declare const $HIGHEST_KEY := 72
  declare %articulation_keyswitches[$NUM_ARTICULATIONS] := (29, 31, 33)
  declare %speed_keyswitches[5] := (72+5, 72+7, 72+9, 72+11, 72+12)
  declare %direction_keyswitches[$DIRECTION_MODE__SIZE] := (72+14, 72+16, 72+17)
  declare %legato_keyswitches[$LEGATO_MODE__SIZE] := (72+19, 72+21, 72+23, 72+24)
  declare $i
  declare %all_keyswitches[64]
  declare $total_num_keyswitches
  $i := 0
  while ($i<$NUM_ARTICULATIONS)
    %all_keyswitches[$total_num_keyswitches] := %articulation_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  $i := 0
  while ($i<5)
    %all_keyswitches[$total_num_keyswitches] := %speed_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  $i := 0
  while ($i<$DIRECTION_MODE__SIZE)
    %all_keyswitches[$total_num_keyswitches] := %direction_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  $i := 0
  while ($i<$LEGATO_MODE__SIZE)
    %all_keyswitches[$total_num_keyswitches] := %legato_keyswitches[$i]
    inc($total_num_keyswitches)
    inc($i)
  end while
  declare %num_keys_pressed[16]
  declare %prev_num_keys_pressed[16]
  declare %_key_active[16*128]
  declare const $key_active__SIZE_D1 := 16
  declare const $key_active__SIZE_D2 := 128
  declare %_key_timestamp[16*128]
  declare const $key_timestamp__SIZE_D1 := 16
  declare const $key_timestamp__SIZE_D2 := 128
  declare %_note_ids[16*128*20]
  declare const $note_ids__SIZE_D1 := 16
  declare const $note_ids__SIZE_D2 := 128
  declare const $note_ids__SIZE_D3 := 20
  declare %_velo[16*128]
  declare const $velo__SIZE_D1 := 16
  declare const $velo__SIZE_D2 := 128
  declare %_key_history[16*100]
  declare const $key_history__SIZE_D1 := 16
  declare const $key_history__SIZE_D2 := 100
  declare %_ripple_history_by_channel[16*100]
  declare const $ripple_history_by_channel__SIZE_D1 := 16
  declare const $ripple_history_by_channel__SIZE_D2 := 100
  declare %ripple_history[100]
  declare %_grid[128*20]
  declare const $grid__SIZE_D1 := 128
  declare const $grid__SIZE_D2 := 20
  declare %_grid_for_half_steps[128*20]
  declare const $grid_for_half_steps__SIZE_D1 := 128
  declare const $grid_for_half_steps__SIZE_D2 := 20
  declare $highest_row
  declare $prev_grid_row_height
  declare $time_since_playing_notes
  declare $direction
  declare $row
  declare $channel
  declare $hist_i
  declare $par_i
  declare $key_i
  declare $ripple_i
  declare $b
  declare $v
  declare $r
  declare $k
  declare $g
  declare $event_i
  declare $row_i
  declare $vel_i
  declare $grid_row_height := 20
  make_persistent($grid_row_height)
  read_persistent_var($grid_row_height)
  declare $cur_artic
  make_persistent($cur_artic)
  read_persistent_var($cur_artic)
  declare ~instructions_opacity := 1.0
  declare ~smoothed_instructions_opacity
  make_perfview
  set_ui_width_px(719)
  set_ui_height_px(569)
  set_control_par_str($INST_ICON_ID,$CONTROL_PAR_PICTURE,"ui_icon")
  set_control_par_str($INST_WALLPAPER_ID,$CONTROL_PAR_PICTURE,"ui_background")
  declare $figma_counter
  declare $figma_counter_multi_line_labels
  declare %UI_x[108] := (0, 163, 153, 58, 25, 144, 338, 523, 0, 0, 145, 637, 607, 577, 547, 516, 485, 455, 425, 602, 568, 536, 480, 445, 637, 616, 603, 583, 569, 551, 537, 516, 495, 481, 460, 446, 425, 395, 365, 335, 304, ...
  273, 243, 213, 390, 356, 324, 268, 233, 404, 391, 371, 357, 339, 325, 304, 283, 269, 248, 234, 213, 183, 153, 123, 92, 61, 31, 1, 178, 144, 112, 56, 21, 192, 179, 159, 145, 127, 113, 92, 71, ...
  57, 36, 22, 1, 0, 0, 0, 157, 537, 346, 417, 308, 199, 688, -1, 125, 96, 67, 38, 9, 119, 46, -1, 122, 79, 41, 1)
  declare %UI_y[108] := (0, 478, 0, 0, 205, 436, 436, 436, 68, 68, 100, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 6, 6, 6, 6, ...
  6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 1, 1, 1, 1, 1, 1, 1, 1, ...
  1, 1, 1, 1, 67, 0, 0, 414, 414, 414, 302, 302, 302, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_width[108] := (719, 277, 68, 68, 667, 142, 142, 150, 68, 68, 430, 29, 29, 29, 29, 30, 30, 29, 29, 14, 15, 15, 15, 15, 29, 20, 12, 19, 13, 17, 13, 20, 20, 13, 20, 13, 20, 29, 29, 29, 30, ...
  30, 29, 29, 14, 15, 15, 15, 15, 20, 12, 19, 13, 17, 13, 20, 20, 13, 20, 13, 20, 29, 29, 29, 30, 30, 29, 29, 14, 15, 15, 15, 15, 20, 12, 19, 13, 17, 13, 20, 20, ...
  13, 20, 13, 20, 68, 68, 68, 127, 127, 127, 91, 91, 91, 30, 720, 22, 22, 22, 22, 22, 22, 51, 31, 28, 34, 28, 28)
  declare %UI_height[108] := (569, 85, 85, 85, 58, 13, 13, 13, 14, 14, 68, 51, 51, 51, 51, 51, 51, 51, 51, 32, 32, 32, 32, 32, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 51, 51, 51, 51, ...
  51, 51, 51, 32, 32, 32, 32, 32, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 51, 51, 51, 51, 51, 51, 51, 32, 32, 32, 32, 32, 4, 4, 4, 4, 4, 4, 4, 4, ...
  4, 4, 4, 4, 13, 68, 68, 11, 11, 11, 43, 43, 43, 30, 474, 14, 14, 14, 14, 14, 15, 19, 19, 19, 19, 19, 19)
  declare %UI_skin[108] := (-1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2, 2, ...
  2, 2, 2, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, ...
  4, 4, 4, 4, 5, 6, 6, 7, 8, 9, 10, 11, 12, 13, 14, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)
  declare %UI_font[108] := (-1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_label_text[108] := (-1, -1, -1, -1, -1, -1, -1, -1, 0, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_default_value[108] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_mouse_behaviour[108] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -800, -800, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_mouse_behaviour_x[108] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_mouse_behaviour_y[108] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare %UI_z_layer[108] := (-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 1, 1, 1, 1, 1, -1, -1, -1, -1, -1, -1, -1, -1, ...
  -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1)
  declare !skin_picture[15]
  !skin_picture[0] := "label_transparent"
  !skin_picture[1] := "label_instructions"
  !skin_picture[2] := "white key"
  !skin_picture[3] := "black key"
  !skin_picture[4] := "key base"
  !skin_picture[5] := "menu_reverb"
  !skin_picture[6] := "knob"
  !skin_picture[7] := "speed slider"
  !skin_picture[8] := "legato slider"
  !skin_picture[9] := "direction slider"
  !skin_picture[10] := "sixteenths"
  !skin_picture[11] := "eighths"
  !skin_picture[12] := "quarters"
  !skin_picture[13] := "info_open"
  !skin_picture[14] := "switch_info"
  declare !_labels_text[2*10]
  declare const $labels_text__SIZE_D1 := 2
  declare const $labels_text__SIZE_D2 := 10
  !_labels_text[10*0+0] := "REVERB"
  !_labels_text[10*1+0] := "EXPRESSION"
  declare %MULTI_LINE_DATA[2] := (1, 1)
  declare %font_file_ids[2]
  %font_file_ids[0] := get_font_id("Khula Regular Size 10")
  %font_file_ids[1] := get_font_id("Khula Regular Size 15")
  declare ui_panel $panel_UI
  declare ui_panel $panel_fx
  declare ui_panel $panel_reverb
  declare ui_panel $panel_vol
  declare ui_panel $panel_keyboard
  declare ui_panel $panel_speed
  declare ui_panel $panel_legato
  declare ui_panel $panel_direction
  declare ui_label $label_reverb(1,1)
  make_persistent($label_reverb)
  read_persistent_var($label_reverb)
  declare ui_label $label_vol(1,1)
  make_persistent($label_vol)
  read_persistent_var($label_vol)
  declare ui_label $label_instructions(1,1)
  make_persistent($label_instructions)
  read_persistent_var($label_instructions)
  declare ui_label $label_oct2__note12(1,1)
  make_persistent($label_oct2__note12)
  read_persistent_var($label_oct2__note12)
  declare ui_label $label_oct2__note11(1,1)
  make_persistent($label_oct2__note11)
  read_persistent_var($label_oct2__note11)
  declare ui_label $label_oct2__note9(1,1)
  make_persistent($label_oct2__note9)
  read_persistent_var($label_oct2__note9)
  declare ui_label $label_oct2__note7(1,1)
  make_persistent($label_oct2__note7)
  read_persistent_var($label_oct2__note7)
  declare ui_label $label_oct2__note5(1,1)
  make_persistent($label_oct2__note5)
  read_persistent_var($label_oct2__note5)
  declare ui_label $label_oct2__note4(1,1)
  make_persistent($label_oct2__note4)
  read_persistent_var($label_oct2__note4)
  declare ui_label $label_oct2__note2(1,1)
  make_persistent($label_oct2__note2)
  read_persistent_var($label_oct2__note2)
  declare ui_label $label_oct2__note0(1,1)
  make_persistent($label_oct2__note0)
  read_persistent_var($label_oct2__note0)
  declare ui_label $label_oct2__note10(1,1)
  make_persistent($label_oct2__note10)
  read_persistent_var($label_oct2__note10)
  declare ui_label $label_oct2__note8(1,1)
  make_persistent($label_oct2__note8)
  read_persistent_var($label_oct2__note8)
  declare ui_label $label_oct2__note6(1,1)
  make_persistent($label_oct2__note6)
  read_persistent_var($label_oct2__note6)
  declare ui_label $label_oct2__note3(1,1)
  make_persistent($label_oct2__note3)
  read_persistent_var($label_oct2__note3)
  declare ui_label $label_oct2__note1(1,1)
  make_persistent($label_oct2__note1)
  read_persistent_var($label_oct2__note1)
  declare ui_label $label_oct2__note12__base(1,1)
  make_persistent($label_oct2__note12__base)
  read_persistent_var($label_oct2__note12__base)
  declare ui_label $label_oct2__note11__base(1,1)
  make_persistent($label_oct2__note11__base)
  read_persistent_var($label_oct2__note11__base)
  declare ui_label $label_oct2__note10__base(1,1)
  make_persistent($label_oct2__note10__base)
  read_persistent_var($label_oct2__note10__base)
  declare ui_label $label_oct2__note9__base(1,1)
  make_persistent($label_oct2__note9__base)
  read_persistent_var($label_oct2__note9__base)
  declare ui_label $label_oct2__note8__base(1,1)
  make_persistent($label_oct2__note8__base)
  read_persistent_var($label_oct2__note8__base)
  declare ui_label $label_oct2__note7__base(1,1)
  make_persistent($label_oct2__note7__base)
  read_persistent_var($label_oct2__note7__base)
  declare ui_label $label_oct2__note6__base(1,1)
  make_persistent($label_oct2__note6__base)
  read_persistent_var($label_oct2__note6__base)
  declare ui_label $label_oct2__note5__base(1,1)
  make_persistent($label_oct2__note5__base)
  read_persistent_var($label_oct2__note5__base)
  declare ui_label $label_oct2__note4__base(1,1)
  make_persistent($label_oct2__note4__base)
  read_persistent_var($label_oct2__note4__base)
  declare ui_label $label_oct2__note3__base(1,1)
  make_persistent($label_oct2__note3__base)
  read_persistent_var($label_oct2__note3__base)
  declare ui_label $label_oct2__note2__base(1,1)
  make_persistent($label_oct2__note2__base)
  read_persistent_var($label_oct2__note2__base)
  declare ui_label $label_oct2__note1__base(1,1)
  make_persistent($label_oct2__note1__base)
  read_persistent_var($label_oct2__note1__base)
  declare ui_label $label_oct2__note0__base(1,1)
  make_persistent($label_oct2__note0__base)
  read_persistent_var($label_oct2__note0__base)
  declare ui_label $label_oct1__note11(1,1)
  make_persistent($label_oct1__note11)
  read_persistent_var($label_oct1__note11)
  declare ui_label $label_oct1__note9(1,1)
  make_persistent($label_oct1__note9)
  read_persistent_var($label_oct1__note9)
  declare ui_label $label_oct1__note7(1,1)
  make_persistent($label_oct1__note7)
  read_persistent_var($label_oct1__note7)
  declare ui_label $label_oct1__note5(1,1)
  make_persistent($label_oct1__note5)
  read_persistent_var($label_oct1__note5)
  declare ui_label $label_oct1__note4(1,1)
  make_persistent($label_oct1__note4)
  read_persistent_var($label_oct1__note4)
  declare ui_label $label_oct1__note2(1,1)
  make_persistent($label_oct1__note2)
  read_persistent_var($label_oct1__note2)
  declare ui_label $label_oct1__note0(1,1)
  make_persistent($label_oct1__note0)
  read_persistent_var($label_oct1__note0)
  declare ui_label $label_oct1__note10(1,1)
  make_persistent($label_oct1__note10)
  read_persistent_var($label_oct1__note10)
  declare ui_label $label_oct1__note8(1,1)
  make_persistent($label_oct1__note8)
  read_persistent_var($label_oct1__note8)
  declare ui_label $label_oct1__note6(1,1)
  make_persistent($label_oct1__note6)
  read_persistent_var($label_oct1__note6)
  declare ui_label $label_oct1__note3(1,1)
  make_persistent($label_oct1__note3)
  read_persistent_var($label_oct1__note3)
  declare ui_label $label_oct1__note1(1,1)
  make_persistent($label_oct1__note1)
  read_persistent_var($label_oct1__note1)
  declare ui_label $label_oct1__note11__base(1,1)
  make_persistent($label_oct1__note11__base)
  read_persistent_var($label_oct1__note11__base)
  declare ui_label $label_oct1__note10__base(1,1)
  make_persistent($label_oct1__note10__base)
  read_persistent_var($label_oct1__note10__base)
  declare ui_label $label_oct1__note9__base(1,1)
  make_persistent($label_oct1__note9__base)
  read_persistent_var($label_oct1__note9__base)
  declare ui_label $label_oct1__note8__base(1,1)
  make_persistent($label_oct1__note8__base)
  read_persistent_var($label_oct1__note8__base)
  declare ui_label $label_oct1__note7__base(1,1)
  make_persistent($label_oct1__note7__base)
  read_persistent_var($label_oct1__note7__base)
  declare ui_label $label_oct1__note6__base(1,1)
  make_persistent($label_oct1__note6__base)
  read_persistent_var($label_oct1__note6__base)
  declare ui_label $label_oct1__note5__base(1,1)
  make_persistent($label_oct1__note5__base)
  read_persistent_var($label_oct1__note5__base)
  declare ui_label $label_oct1__note4__base(1,1)
  make_persistent($label_oct1__note4__base)
  read_persistent_var($label_oct1__note4__base)
  declare ui_label $label_oct1__note3__base(1,1)
  make_persistent($label_oct1__note3__base)
  read_persistent_var($label_oct1__note3__base)
  declare ui_label $label_oct1__note2__base(1,1)
  make_persistent($label_oct1__note2__base)
  read_persistent_var($label_oct1__note2__base)
  declare ui_label $label_oct1__note1__base(1,1)
  make_persistent($label_oct1__note1__base)
  read_persistent_var($label_oct1__note1__base)
  declare ui_label $label_oct1__note0__base(1,1)
  make_persistent($label_oct1__note0__base)
  read_persistent_var($label_oct1__note0__base)
  declare ui_label $label_oct0__note11(1,1)
  make_persistent($label_oct0__note11)
  read_persistent_var($label_oct0__note11)
  declare ui_label $label_oct0__note9(1,1)
  make_persistent($label_oct0__note9)
  read_persistent_var($label_oct0__note9)
  declare ui_label $label_oct0__note7(1,1)
  make_persistent($label_oct0__note7)
  read_persistent_var($label_oct0__note7)
  declare ui_label $label_oct0__note5(1,1)
  make_persistent($label_oct0__note5)
  read_persistent_var($label_oct0__note5)
  declare ui_label $label_oct0__note4(1,1)
  make_persistent($label_oct0__note4)
  read_persistent_var($label_oct0__note4)
  declare ui_label $label_oct0__note2(1,1)
  make_persistent($label_oct0__note2)
  read_persistent_var($label_oct0__note2)
  declare ui_label $label_oct0__note0(1,1)
  make_persistent($label_oct0__note0)
  read_persistent_var($label_oct0__note0)
  declare ui_label $label_oct0__note10(1,1)
  make_persistent($label_oct0__note10)
  read_persistent_var($label_oct0__note10)
  declare ui_label $label_oct0__note8(1,1)
  make_persistent($label_oct0__note8)
  read_persistent_var($label_oct0__note8)
  declare ui_label $label_oct0__note6(1,1)
  make_persistent($label_oct0__note6)
  read_persistent_var($label_oct0__note6)
  declare ui_label $label_oct0__note3(1,1)
  make_persistent($label_oct0__note3)
  read_persistent_var($label_oct0__note3)
  declare ui_label $label_oct0__note1(1,1)
  make_persistent($label_oct0__note1)
  read_persistent_var($label_oct0__note1)
  declare ui_label $label_oct0__note11__base(1,1)
  make_persistent($label_oct0__note11__base)
  read_persistent_var($label_oct0__note11__base)
  declare ui_label $label_oct0__note10__base(1,1)
  make_persistent($label_oct0__note10__base)
  read_persistent_var($label_oct0__note10__base)
  declare ui_label $label_oct0__note9__base(1,1)
  make_persistent($label_oct0__note9__base)
  read_persistent_var($label_oct0__note9__base)
  declare ui_label $label_oct0__note8__base(1,1)
  make_persistent($label_oct0__note8__base)
  read_persistent_var($label_oct0__note8__base)
  declare ui_label $label_oct0__note7__base(1,1)
  make_persistent($label_oct0__note7__base)
  read_persistent_var($label_oct0__note7__base)
  declare ui_label $label_oct0__note6__base(1,1)
  make_persistent($label_oct0__note6__base)
  read_persistent_var($label_oct0__note6__base)
  declare ui_label $label_oct0__note5__base(1,1)
  make_persistent($label_oct0__note5__base)
  read_persistent_var($label_oct0__note5__base)
  declare ui_label $label_oct0__note4__base(1,1)
  make_persistent($label_oct0__note4__base)
  read_persistent_var($label_oct0__note4__base)
  declare ui_label $label_oct0__note3__base(1,1)
  make_persistent($label_oct0__note3__base)
  read_persistent_var($label_oct0__note3__base)
  declare ui_label $label_oct0__note2__base(1,1)
  make_persistent($label_oct0__note2__base)
  read_persistent_var($label_oct0__note2__base)
  declare ui_label $label_oct0__note1__base(1,1)
  make_persistent($label_oct0__note1__base)
  read_persistent_var($label_oct0__note1__base)
  declare ui_label $label_oct0__note0__base(1,1)
  make_persistent($label_oct0__note0__base)
  read_persistent_var($label_oct0__note0__base)
  declare ui_menu $menu_reverb
  make_persistent($menu_reverb)
  read_persistent_var($menu_reverb)
  declare ui_slider $slider_reverb(0,1000000)
  make_persistent($slider_reverb)
  read_persistent_var($slider_reverb)
  declare ui_slider $slider_vol(0,1000000)
  make_persistent($slider_vol)
  read_persistent_var($slider_vol)
  declare ui_slider $slider_speed(0,4)
  make_persistent($slider_speed)
  read_persistent_var($slider_speed)
  declare ui_slider $slider_legato(0,3)
  make_persistent($slider_legato)
  read_persistent_var($slider_legato)
  declare ui_slider $slider_direction(0,2)
  make_persistent($slider_direction)
  read_persistent_var($slider_direction)
  declare ui_switch $switch_sixteenths
  make_persistent($switch_sixteenths)
  read_persistent_var($switch_sixteenths)
  declare ui_switch $switch_eighths
  make_persistent($switch_eighths)
  read_persistent_var($switch_eighths)
  declare ui_switch $switch_quarters
  make_persistent($switch_quarters)
  read_persistent_var($switch_quarters)
  declare ui_switch $switch_openInfo
  make_persistent($switch_openInfo)
  read_persistent_var($switch_openInfo)
  declare ui_switch $switch_info
  make_persistent($switch_info)
  read_persistent_var($switch_info)
  declare ui_switch $switch_doubleSpeed
  make_persistent($switch_doubleSpeed)
  read_persistent_var($switch_doubleSpeed)
  declare ui_switch $switch_fastTripletSpeed
  make_persistent($switch_fastTripletSpeed)
  read_persistent_var($switch_fastTripletSpeed)
  declare ui_switch $switch_fullSpeed
  make_persistent($switch_fullSpeed)
  read_persistent_var($switch_fullSpeed)
  declare ui_switch $switch_slowTripletSpeed
  make_persistent($switch_slowTripletSpeed)
  read_persistent_var($switch_slowTripletSpeed)
  declare ui_switch $switch_halfSpeed
  make_persistent($switch_halfSpeed)
  read_persistent_var($switch_halfSpeed)
  declare ui_switch $switch_up
  make_persistent($switch_up)
  read_persistent_var($switch_up)
  declare ui_switch $switch_asPlayed
  make_persistent($switch_asPlayed)
  read_persistent_var($switch_asPlayed)
  declare ui_switch $switch_down
  make_persistent($switch_down)
  read_persistent_var($switch_down)
  declare ui_switch $switch_syncToSwell
  make_persistent($switch_syncToSwell)
  read_persistent_var($switch_syncToSwell)
  declare ui_switch $switch_syncToRipple
  make_persistent($switch_syncToRipple)
  read_persistent_var($switch_syncToRipple)
  declare ui_switch $switch_syncToPitch
  make_persistent($switch_syncToPitch)
  read_persistent_var($switch_syncToPitch)
  declare ui_switch $switch_noLegato
  make_persistent($switch_noLegato)
  read_persistent_var($switch_noLegato)
  declare %UI_ID[10000] := (0)
  %UI_ID[0] := get_ui_id($panel_UI)
  $figma_counter := 1
  while ($figma_counter<108)
    %UI_ID[$figma_counter] := %UI_ID[0]+$figma_counter
    inc($figma_counter)
  end while
  declare %panel_idx[108] := (0, 1, 1, 0, 0, 0, 0, 2, 3, 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, ...
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, ...
  4, 4, 4, 2, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 5, 5, 6, 6, 6, 7, 7, 7, 7)
  declare %element_idx[108] := (1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, ...
  42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, ...
  82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107)
  $figma_counter := 1
  while ($figma_counter<num_elements(%panel_idx))
    if (%panel_idx[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_PARENT_PANEL,%UI_ID[%panel_idx[$figma_counter-1]])
    end if
    inc($figma_counter)
  end while
  $figma_counter := 0
  while ($figma_counter<108)
    set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_TEXT,"")
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_WIDTH,%UI_width[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_HEIGHT,%UI_height[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_POS_X,%UI_x[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_POS_Y,%UI_y[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_DEFAULT_VALUE,%UI_default_value[$figma_counter])
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_Z_LAYER,%UI_z_layer[$figma_counter])
    if (%UI_mouse_behaviour[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_MOUSE_BEHAVIOUR,%UI_mouse_behaviour[$figma_counter])
    end if
    if (%UI_mouse_behaviour_x[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_MOUSE_BEHAVIOUR_X,%UI_mouse_behaviour_x[$figma_counter])
    end if
    if (%UI_mouse_behaviour_y[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_MOUSE_BEHAVIOUR_Y,%UI_mouse_behaviour[$figma_counter])
    end if
    if (%UI_skin[$figma_counter] # -1)
      set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_PICTURE,!skin_picture[%UI_skin[$figma_counter]])
    end if
    if (%UI_label_text[$figma_counter]>-1)
      set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_TEXT,!_labels_text[10*%UI_label_text[$figma_counter]+0])
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_TEXTPOS_Y,0)
      if (%MULTI_LINE_DATA[%UI_label_text[$figma_counter]]>1)
        $figma_counter_multi_line_labels := 0
        while ($figma_counter_multi_line_labels<(%MULTI_LINE_DATA[%UI_label_text[$figma_counter]]-1))
          set_control_par_str(%UI_ID[$figma_counter],$CONTROL_PAR_TEXTLINE,!_labels_text[10*%UI_label_text[$figma_counter]+$figma_counter_multi_line_labels+1])
          inc($figma_counter_multi_line_labels)
        end while
      end if
    end if
    if (%UI_font[$figma_counter] # -1)
      set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_FONT_TYPE,%font_file_ids[%UI_font[$figma_counter]])
    end if
    set_control_par(%UI_ID[$figma_counter],$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
    inc($figma_counter)
  end while
  set_control_par_str($INST_ICON_ID,$CONTROL_PAR_PICTURE,"insticon")
  set_control_par(get_ui_id($switch_info),$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
  declare %key_ids[128]
  declare %key_base_ids[128]
  %key_ids[36] := get_ui_id($label_oct0__note0)
  %key_ids[37] := get_ui_id($label_oct0__note1)
  %key_ids[38] := get_ui_id($label_oct0__note2)
  %key_ids[39] := get_ui_id($label_oct0__note3)
  %key_ids[40] := get_ui_id($label_oct0__note4)
  %key_ids[41] := get_ui_id($label_oct0__note5)
  %key_ids[42] := get_ui_id($label_oct0__note6)
  %key_ids[43] := get_ui_id($label_oct0__note7)
  %key_ids[44] := get_ui_id($label_oct0__note8)
  %key_ids[45] := get_ui_id($label_oct0__note9)
  %key_ids[46] := get_ui_id($label_oct0__note10)
  %key_ids[47] := get_ui_id($label_oct0__note11)
  %key_ids[48] := get_ui_id($label_oct1__note0)
  %key_ids[49] := get_ui_id($label_oct1__note1)
  %key_ids[50] := get_ui_id($label_oct1__note2)
  %key_ids[51] := get_ui_id($label_oct1__note3)
  %key_ids[52] := get_ui_id($label_oct1__note4)
  %key_ids[53] := get_ui_id($label_oct1__note5)
  %key_ids[54] := get_ui_id($label_oct1__note6)
  %key_ids[55] := get_ui_id($label_oct1__note7)
  %key_ids[56] := get_ui_id($label_oct1__note8)
  %key_ids[57] := get_ui_id($label_oct1__note9)
  %key_ids[58] := get_ui_id($label_oct1__note10)
  %key_ids[59] := get_ui_id($label_oct1__note11)
  %key_ids[60] := get_ui_id($label_oct2__note0)
  %key_ids[61] := get_ui_id($label_oct2__note1)
  %key_ids[62] := get_ui_id($label_oct2__note2)
  %key_ids[63] := get_ui_id($label_oct2__note3)
  %key_ids[64] := get_ui_id($label_oct2__note4)
  %key_ids[65] := get_ui_id($label_oct2__note5)
  %key_ids[66] := get_ui_id($label_oct2__note6)
  %key_ids[67] := get_ui_id($label_oct2__note7)
  %key_ids[68] := get_ui_id($label_oct2__note8)
  %key_ids[69] := get_ui_id($label_oct2__note9)
  %key_ids[70] := get_ui_id($label_oct2__note10)
  %key_ids[71] := get_ui_id($label_oct2__note11)
  %key_ids[72] := get_ui_id($label_oct2__note12)
  %key_base_ids[36] := get_ui_id($label_oct0__note0__base)
  %key_base_ids[37] := get_ui_id($label_oct0__note1__base)
  %key_base_ids[38] := get_ui_id($label_oct0__note2__base)
  %key_base_ids[39] := get_ui_id($label_oct0__note3__base)
  %key_base_ids[40] := get_ui_id($label_oct0__note4__base)
  %key_base_ids[41] := get_ui_id($label_oct0__note5__base)
  %key_base_ids[42] := get_ui_id($label_oct0__note6__base)
  %key_base_ids[43] := get_ui_id($label_oct0__note7__base)
  %key_base_ids[44] := get_ui_id($label_oct0__note8__base)
  %key_base_ids[45] := get_ui_id($label_oct0__note9__base)
  %key_base_ids[46] := get_ui_id($label_oct0__note10__base)
  %key_base_ids[47] := get_ui_id($label_oct0__note11__base)
  %key_base_ids[48] := get_ui_id($label_oct1__note0__base)
  %key_base_ids[49] := get_ui_id($label_oct1__note1__base)
  %key_base_ids[50] := get_ui_id($label_oct1__note2__base)
  %key_base_ids[51] := get_ui_id($label_oct1__note3__base)
  %key_base_ids[52] := get_ui_id($label_oct1__note4__base)
  %key_base_ids[53] := get_ui_id($label_oct1__note5__base)
  %key_base_ids[54] := get_ui_id($label_oct1__note6__base)
  %key_base_ids[55] := get_ui_id($label_oct1__note7__base)
  %key_base_ids[56] := get_ui_id($label_oct1__note8__base)
  %key_base_ids[57] := get_ui_id($label_oct1__note9__base)
  %key_base_ids[58] := get_ui_id($label_oct1__note10__base)
  %key_base_ids[59] := get_ui_id($label_oct1__note11__base)
  %key_base_ids[60] := get_ui_id($label_oct2__note0__base)
  %key_base_ids[61] := get_ui_id($label_oct2__note1__base)
  %key_base_ids[62] := get_ui_id($label_oct2__note2__base)
  %key_base_ids[63] := get_ui_id($label_oct2__note3__base)
  %key_base_ids[64] := get_ui_id($label_oct2__note4__base)
  %key_base_ids[65] := get_ui_id($label_oct2__note5__base)
  %key_base_ids[66] := get_ui_id($label_oct2__note6__base)
  %key_base_ids[67] := get_ui_id($label_oct2__note7__base)
  %key_base_ids[68] := get_ui_id($label_oct2__note8__base)
  %key_base_ids[69] := get_ui_id($label_oct2__note9__base)
  %key_base_ids[70] := get_ui_id($label_oct2__note10__base)
  %key_base_ids[71] := get_ui_id($label_oct2__note11__base)
  %key_base_ids[72] := get_ui_id($label_oct2__note12__base)
  $key_i := $LOWEST_KEY
  while ($key_i<=$HIGHEST_KEY)
    set_control_par(%key_ids[$key_i],$CONTROL_PAR_VALUE,0)
    inc($key_i)
  end while
  declare %articulation_ids[$NUM_ARTICULATIONS]
  %articulation_ids[0] := get_ui_id($switch_quarters)
  %articulation_ids[1] := get_ui_id($switch_eighths)
  %articulation_ids[2] := get_ui_id($switch_sixteenths)
  declare %speed_ids[5]
  %speed_ids[0] := get_ui_id($switch_halfSpeed)
  %speed_ids[1] := get_ui_id($switch_slowTripletSpeed)
  %speed_ids[2] := get_ui_id($switch_fullSpeed)
  %speed_ids[3] := get_ui_id($switch_fastTripletSpeed)
  %speed_ids[4] := get_ui_id($switch_doubleSpeed)
  declare !speed_texts[5]
  !speed_texts[0] := "0.5"
  !speed_texts[1] := "0.75"
  !speed_texts[2] := "1.0"
  !speed_texts[3] := "1.5"
  !speed_texts[4] := "2.0"
  $i := 0
  while ($i<num_elements(%speed_ids))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 off"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_ON,get_font_id("Khula Bold Size 11 on"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_PRESSED,get_font_id("Khula Bold Size 11 off pressed"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_PRESSED,get_font_id("Khula Bold Size 11 on pressed"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_HOVER,get_font_id("Khula Bold Size 11 off hover"))
    set_control_par(%speed_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_HOVER,get_font_id("Khula Bold Size 11 on hover"))
    set_control_par_str(%speed_ids[$i],$CONTROL_PAR_TEXT,!speed_texts[$i])
    set_control_par(%speed_ids[$i],$CONTROL_PAR_WIDTH,get_control_par(%speed_ids[$i],$CONTROL_PAR_WIDTH)+14)
    inc($i)
  end while
  set_control_par(get_ui_id($switch_halfSpeed),$CONTROL_PAR_POS_X,get_control_par(get_ui_id($switch_halfSpeed),$CONTROL_PAR_POS_X)-4)
  set_control_par(get_ui_id($switch_slowTripletSpeed),$CONTROL_PAR_POS_X,get_control_par(get_ui_id($switch_slowTripletSpeed),$CONTROL_PAR_POS_X)-6)
  set_control_par(get_ui_id($switch_fullSpeed),$CONTROL_PAR_POS_X,get_control_par(get_ui_id($switch_fullSpeed),$CONTROL_PAR_POS_X)-4)
  set_control_par(get_ui_id($switch_fastTripletSpeed),$CONTROL_PAR_POS_X,get_control_par(get_ui_id($switch_fastTripletSpeed),$CONTROL_PAR_POS_X)-3)
  set_control_par(get_ui_id($switch_doubleSpeed),$CONTROL_PAR_POS_X,get_control_par(get_ui_id($switch_doubleSpeed),$CONTROL_PAR_POS_X)-6)
  set_control_par_str(get_ui_id($switch_up),$CONTROL_PAR_TEXT,"Up")
  set_control_par_str(get_ui_id($switch_down),$CONTROL_PAR_TEXT,"Down")
  set_control_par_str(get_ui_id($switch_asPlayed),$CONTROL_PAR_TEXT,"As Played")
  declare %direction_mode_ids[$DIRECTION_MODE__SIZE]
  %direction_mode_ids[0] := get_ui_id($switch_down)
  %direction_mode_ids[1] := get_ui_id($switch_asPlayed)
  %direction_mode_ids[2] := get_ui_id($switch_up)
  $i := 0
  while ($i<num_elements(%direction_mode_ids))
    set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 off"))
    set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_FONT_TYPE_ON,get_font_id("Khula Bold Size 11 on"))
    set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_PRESSED,get_font_id("Khula Bold Size 11 off pressed"))
    set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_PRESSED,get_font_id("Khula Bold Size 11 on pressed"))
    set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_HOVER,get_font_id("Khula Bold Size 11 off hover"))
    set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_HOVER,get_font_id("Khula Bold Size 11 on hover"))
    inc($i)
  end while
  set_control_par(get_ui_id($switch_down),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_down),$CONTROL_PAR_WIDTH)+13)
  set_control_par(get_ui_id($switch_asPlayed),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_asPlayed),$CONTROL_PAR_WIDTH)+19)
  set_control_par(get_ui_id($switch_up),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_up),$CONTROL_PAR_WIDTH)+7)
  set_control_par_str(get_ui_id($switch_noLegato),$CONTROL_PAR_TEXT,"Off")
  set_control_par_str(get_ui_id($switch_syncToPitch),$CONTROL_PAR_TEXT,"Pitch")
  set_control_par_str(get_ui_id($switch_syncToRipple),$CONTROL_PAR_TEXT,"Ripple")
  set_control_par_str(get_ui_id($switch_syncToSwell),$CONTROL_PAR_TEXT,"Swell")
  declare %legato_ids[$LEGATO_MODE__SIZE]
  %legato_ids[0] := get_ui_id($switch_noLegato)
  %legato_ids[1] := get_ui_id($switch_syncToPitch)
  %legato_ids[2] := get_ui_id($switch_syncToRipple)
  %legato_ids[3] := get_ui_id($switch_syncToSwell)
  $i := 0
  while ($i<num_elements(%legato_ids))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE,get_font_id("Khula Bold Size 11 off"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_ON,get_font_id("Khula Bold Size 11 on"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_PRESSED,get_font_id("Khula Bold Size 11 off pressed"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_PRESSED,get_font_id("Khula Bold Size 11 on pressed"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_OFF_HOVER,get_font_id("Khula Bold Size 11 off hover"))
    set_control_par(%legato_ids[$i],$CONTROL_PAR_FONT_TYPE_ON_HOVER,get_font_id("Khula Bold Size 11 on hover"))
    inc($i)
  end while
  set_control_par(get_ui_id($switch_noLegato),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_noLegato),$CONTROL_PAR_WIDTH)+4)
  set_control_par(get_ui_id($switch_syncToPitch),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_syncToPitch),$CONTROL_PAR_WIDTH)+12)
  set_control_par(get_ui_id($switch_syncToRipple),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_syncToRipple),$CONTROL_PAR_WIDTH)+12)
  set_control_par(get_ui_id($switch_syncToSwell),$CONTROL_PAR_WIDTH,get_control_par(get_ui_id($switch_syncToSwell),$CONTROL_PAR_WIDTH)+16)
  set_control_par(get_ui_id($slider_speed),$CONTROL_PAR_MOUSE_BEHAVIOUR,1500)
  set_control_par(get_ui_id($slider_direction),$CONTROL_PAR_MOUSE_BEHAVIOUR,1500)
  set_control_par(get_ui_id($slider_legato),$CONTROL_PAR_MOUSE_BEHAVIOUR,1500)
  set_control_par(get_ui_id($slider_speed),$CONTROL_PAR_DEFAULT_VALUE,2)
  set_control_par(get_ui_id($slider_direction),$CONTROL_PAR_DEFAULT_VALUE,1)
  set_control_par(get_ui_id($slider_legato),$CONTROL_PAR_DEFAULT_VALUE,0)
  set_control_par(get_ui_id($slider_vol),$CONTROL_PAR_DEFAULT_VALUE,real_to_int(pow(2.0,(0.0+346768.2342478351)/18000.0)))
  set_control_par(get_ui_id($slider_reverb),$CONTROL_PAR_DEFAULT_VALUE,500000)
  set_control_par(get_ui_id($menu_reverb),$CONTROL_PAR_TEXTPOS_Y,100)
  declare %_bracket[64*9]
  declare const $bracket__SIZE_D1 := 64
  declare const $bracket__SIZE_D2 := 9
  declare ui_slider $_bracket0(0,1000)
  declare ui_slider $_bracket1(0,1000)
  declare ui_slider $_bracket2(0,1000)
  declare ui_slider $_bracket3(0,1000)
  declare ui_slider $_bracket4(0,1000)
  declare ui_slider $_bracket5(0,1000)
  declare ui_slider $_bracket6(0,1000)
  declare ui_slider $_bracket7(0,1000)
  declare ui_slider $_bracket8(0,1000)
  declare ui_slider $_bracket9(0,1000)
  declare ui_slider $_bracket10(0,1000)
  declare ui_slider $_bracket11(0,1000)
  declare ui_slider $_bracket12(0,1000)
  declare ui_slider $_bracket13(0,1000)
  declare ui_slider $_bracket14(0,1000)
  declare ui_slider $_bracket15(0,1000)
  declare ui_slider $_bracket16(0,1000)
  declare ui_slider $_bracket17(0,1000)
  declare ui_slider $_bracket18(0,1000)
  declare ui_slider $_bracket19(0,1000)
  declare ui_slider $_bracket20(0,1000)
  declare ui_slider $_bracket21(0,1000)
  declare ui_slider $_bracket22(0,1000)
  declare ui_slider $_bracket23(0,1000)
  declare ui_slider $_bracket24(0,1000)
  declare ui_slider $_bracket25(0,1000)
  declare ui_slider $_bracket26(0,1000)
  declare ui_slider $_bracket27(0,1000)
  declare ui_slider $_bracket28(0,1000)
  declare ui_slider $_bracket29(0,1000)
  declare ui_slider $_bracket30(0,1000)
  declare ui_slider $_bracket31(0,1000)
  declare ui_slider $_bracket32(0,1000)
  declare ui_slider $_bracket33(0,1000)
  declare ui_slider $_bracket34(0,1000)
  declare ui_slider $_bracket35(0,1000)
  declare ui_slider $_bracket36(0,1000)
  declare ui_slider $_bracket37(0,1000)
  declare ui_slider $_bracket38(0,1000)
  declare ui_slider $_bracket39(0,1000)
  declare ui_slider $_bracket40(0,1000)
  declare ui_slider $_bracket41(0,1000)
  declare ui_slider $_bracket42(0,1000)
  declare ui_slider $_bracket43(0,1000)
  declare ui_slider $_bracket44(0,1000)
  declare ui_slider $_bracket45(0,1000)
  declare ui_slider $_bracket46(0,1000)
  declare ui_slider $_bracket47(0,1000)
  declare ui_slider $_bracket48(0,1000)
  declare ui_slider $_bracket49(0,1000)
  declare ui_slider $_bracket50(0,1000)
  declare ui_slider $_bracket51(0,1000)
  declare ui_slider $_bracket52(0,1000)
  declare ui_slider $_bracket53(0,1000)
  declare ui_slider $_bracket54(0,1000)
  declare ui_slider $_bracket55(0,1000)
  declare ui_slider $_bracket56(0,1000)
  declare ui_slider $_bracket57(0,1000)
  declare ui_slider $_bracket58(0,1000)
  declare ui_slider $_bracket59(0,1000)
  declare ui_slider $_bracket60(0,1000)
  declare ui_slider $_bracket61(0,1000)
  declare ui_slider $_bracket62(0,1000)
  declare ui_slider $_bracket63(0,1000)
  declare ui_slider $_bracket64(0,1000)
  declare ui_slider $_bracket65(0,1000)
  declare ui_slider $_bracket66(0,1000)
  declare ui_slider $_bracket67(0,1000)
  declare ui_slider $_bracket68(0,1000)
  declare ui_slider $_bracket69(0,1000)
  declare ui_slider $_bracket70(0,1000)
  declare ui_slider $_bracket71(0,1000)
  declare ui_slider $_bracket72(0,1000)
  declare ui_slider $_bracket73(0,1000)
  declare ui_slider $_bracket74(0,1000)
  declare ui_slider $_bracket75(0,1000)
  declare ui_slider $_bracket76(0,1000)
  declare ui_slider $_bracket77(0,1000)
  declare ui_slider $_bracket78(0,1000)
  declare ui_slider $_bracket79(0,1000)
  declare ui_slider $_bracket80(0,1000)
  declare ui_slider $_bracket81(0,1000)
  declare ui_slider $_bracket82(0,1000)
  declare ui_slider $_bracket83(0,1000)
  declare ui_slider $_bracket84(0,1000)
  declare ui_slider $_bracket85(0,1000)
  declare ui_slider $_bracket86(0,1000)
  declare ui_slider $_bracket87(0,1000)
  declare ui_slider $_bracket88(0,1000)
  declare ui_slider $_bracket89(0,1000)
  declare ui_slider $_bracket90(0,1000)
  declare ui_slider $_bracket91(0,1000)
  declare ui_slider $_bracket92(0,1000)
  declare ui_slider $_bracket93(0,1000)
  declare ui_slider $_bracket94(0,1000)
  declare ui_slider $_bracket95(0,1000)
  declare ui_slider $_bracket96(0,1000)
  declare ui_slider $_bracket97(0,1000)
  declare ui_slider $_bracket98(0,1000)
  declare ui_slider $_bracket99(0,1000)
  declare ui_slider $_bracket100(0,1000)
  declare ui_slider $_bracket101(0,1000)
  declare ui_slider $_bracket102(0,1000)
  declare ui_slider $_bracket103(0,1000)
  declare ui_slider $_bracket104(0,1000)
  declare ui_slider $_bracket105(0,1000)
  declare ui_slider $_bracket106(0,1000)
  declare ui_slider $_bracket107(0,1000)
  declare ui_slider $_bracket108(0,1000)
  declare ui_slider $_bracket109(0,1000)
  declare ui_slider $_bracket110(0,1000)
  declare ui_slider $_bracket111(0,1000)
  declare ui_slider $_bracket112(0,1000)
  declare ui_slider $_bracket113(0,1000)
  declare ui_slider $_bracket114(0,1000)
  declare ui_slider $_bracket115(0,1000)
  declare ui_slider $_bracket116(0,1000)
  declare ui_slider $_bracket117(0,1000)
  declare ui_slider $_bracket118(0,1000)
  declare ui_slider $_bracket119(0,1000)
  declare ui_slider $_bracket120(0,1000)
  declare ui_slider $_bracket121(0,1000)
  declare ui_slider $_bracket122(0,1000)
  declare ui_slider $_bracket123(0,1000)
  declare ui_slider $_bracket124(0,1000)
  declare ui_slider $_bracket125(0,1000)
  declare ui_slider $_bracket126(0,1000)
  declare ui_slider $_bracket127(0,1000)
  declare ui_slider $_bracket128(0,1000)
  declare ui_slider $_bracket129(0,1000)
  declare ui_slider $_bracket130(0,1000)
  declare ui_slider $_bracket131(0,1000)
  declare ui_slider $_bracket132(0,1000)
  declare ui_slider $_bracket133(0,1000)
  declare ui_slider $_bracket134(0,1000)
  declare ui_slider $_bracket135(0,1000)
  declare ui_slider $_bracket136(0,1000)
  declare ui_slider $_bracket137(0,1000)
  declare ui_slider $_bracket138(0,1000)
  declare ui_slider $_bracket139(0,1000)
  declare ui_slider $_bracket140(0,1000)
  declare ui_slider $_bracket141(0,1000)
  declare ui_slider $_bracket142(0,1000)
  declare ui_slider $_bracket143(0,1000)
  declare ui_slider $_bracket144(0,1000)
  declare ui_slider $_bracket145(0,1000)
  declare ui_slider $_bracket146(0,1000)
  declare ui_slider $_bracket147(0,1000)
  declare ui_slider $_bracket148(0,1000)
  declare ui_slider $_bracket149(0,1000)
  declare ui_slider $_bracket150(0,1000)
  declare ui_slider $_bracket151(0,1000)
  declare ui_slider $_bracket152(0,1000)
  declare ui_slider $_bracket153(0,1000)
  declare ui_slider $_bracket154(0,1000)
  declare ui_slider $_bracket155(0,1000)
  declare ui_slider $_bracket156(0,1000)
  declare ui_slider $_bracket157(0,1000)
  declare ui_slider $_bracket158(0,1000)
  declare ui_slider $_bracket159(0,1000)
  declare ui_slider $_bracket160(0,1000)
  declare ui_slider $_bracket161(0,1000)
  declare ui_slider $_bracket162(0,1000)
  declare ui_slider $_bracket163(0,1000)
  declare ui_slider $_bracket164(0,1000)
  declare ui_slider $_bracket165(0,1000)
  declare ui_slider $_bracket166(0,1000)
  declare ui_slider $_bracket167(0,1000)
  declare ui_slider $_bracket168(0,1000)
  declare ui_slider $_bracket169(0,1000)
  declare ui_slider $_bracket170(0,1000)
  declare ui_slider $_bracket171(0,1000)
  declare ui_slider $_bracket172(0,1000)
  declare ui_slider $_bracket173(0,1000)
  declare ui_slider $_bracket174(0,1000)
  declare ui_slider $_bracket175(0,1000)
  declare ui_slider $_bracket176(0,1000)
  declare ui_slider $_bracket177(0,1000)
  declare ui_slider $_bracket178(0,1000)
  declare ui_slider $_bracket179(0,1000)
  declare ui_slider $_bracket180(0,1000)
  declare ui_slider $_bracket181(0,1000)
  declare ui_slider $_bracket182(0,1000)
  declare ui_slider $_bracket183(0,1000)
  declare ui_slider $_bracket184(0,1000)
  declare ui_slider $_bracket185(0,1000)
  declare ui_slider $_bracket186(0,1000)
  declare ui_slider $_bracket187(0,1000)
  declare ui_slider $_bracket188(0,1000)
  declare ui_slider $_bracket189(0,1000)
  declare ui_slider $_bracket190(0,1000)
  declare ui_slider $_bracket191(0,1000)
  declare ui_slider $_bracket192(0,1000)
  declare ui_slider $_bracket193(0,1000)
  declare ui_slider $_bracket194(0,1000)
  declare ui_slider $_bracket195(0,1000)
  declare ui_slider $_bracket196(0,1000)
  declare ui_slider $_bracket197(0,1000)
  declare ui_slider $_bracket198(0,1000)
  declare ui_slider $_bracket199(0,1000)
  declare ui_slider $_bracket200(0,1000)
  declare ui_slider $_bracket201(0,1000)
  declare ui_slider $_bracket202(0,1000)
  declare ui_slider $_bracket203(0,1000)
  declare ui_slider $_bracket204(0,1000)
  declare ui_slider $_bracket205(0,1000)
  declare ui_slider $_bracket206(0,1000)
  declare ui_slider $_bracket207(0,1000)
  declare ui_slider $_bracket208(0,1000)
  declare ui_slider $_bracket209(0,1000)
  declare ui_slider $_bracket210(0,1000)
  declare ui_slider $_bracket211(0,1000)
  declare ui_slider $_bracket212(0,1000)
  declare ui_slider $_bracket213(0,1000)
  declare ui_slider $_bracket214(0,1000)
  declare ui_slider $_bracket215(0,1000)
  declare ui_slider $_bracket216(0,1000)
  declare ui_slider $_bracket217(0,1000)
  declare ui_slider $_bracket218(0,1000)
  declare ui_slider $_bracket219(0,1000)
  declare ui_slider $_bracket220(0,1000)
  declare ui_slider $_bracket221(0,1000)
  declare ui_slider $_bracket222(0,1000)
  declare ui_slider $_bracket223(0,1000)
  declare ui_slider $_bracket224(0,1000)
  declare ui_slider $_bracket225(0,1000)
  declare ui_slider $_bracket226(0,1000)
  declare ui_slider $_bracket227(0,1000)
  declare ui_slider $_bracket228(0,1000)
  declare ui_slider $_bracket229(0,1000)
  declare ui_slider $_bracket230(0,1000)
  declare ui_slider $_bracket231(0,1000)
  declare ui_slider $_bracket232(0,1000)
  declare ui_slider $_bracket233(0,1000)
  declare ui_slider $_bracket234(0,1000)
  declare ui_slider $_bracket235(0,1000)
  declare ui_slider $_bracket236(0,1000)
  declare ui_slider $_bracket237(0,1000)
  declare ui_slider $_bracket238(0,1000)
  declare ui_slider $_bracket239(0,1000)
  declare ui_slider $_bracket240(0,1000)
  declare ui_slider $_bracket241(0,1000)
  declare ui_slider $_bracket242(0,1000)
  declare ui_slider $_bracket243(0,1000)
  declare ui_slider $_bracket244(0,1000)
  declare ui_slider $_bracket245(0,1000)
  declare ui_slider $_bracket246(0,1000)
  declare ui_slider $_bracket247(0,1000)
  declare ui_slider $_bracket248(0,1000)
  declare ui_slider $_bracket249(0,1000)
  declare ui_slider $_bracket250(0,1000)
  declare ui_slider $_bracket251(0,1000)
  declare ui_slider $_bracket252(0,1000)
  declare ui_slider $_bracket253(0,1000)
  declare ui_slider $_bracket254(0,1000)
  declare ui_slider $_bracket255(0,1000)
  declare ui_slider $_bracket256(0,1000)
  declare ui_slider $_bracket257(0,1000)
  declare ui_slider $_bracket258(0,1000)
  declare ui_slider $_bracket259(0,1000)
  declare ui_slider $_bracket260(0,1000)
  declare ui_slider $_bracket261(0,1000)
  declare ui_slider $_bracket262(0,1000)
  declare ui_slider $_bracket263(0,1000)
  declare ui_slider $_bracket264(0,1000)
  declare ui_slider $_bracket265(0,1000)
  declare ui_slider $_bracket266(0,1000)
  declare ui_slider $_bracket267(0,1000)
  declare ui_slider $_bracket268(0,1000)
  declare ui_slider $_bracket269(0,1000)
  declare ui_slider $_bracket270(0,1000)
  declare ui_slider $_bracket271(0,1000)
  declare ui_slider $_bracket272(0,1000)
  declare ui_slider $_bracket273(0,1000)
  declare ui_slider $_bracket274(0,1000)
  declare ui_slider $_bracket275(0,1000)
  declare ui_slider $_bracket276(0,1000)
  declare ui_slider $_bracket277(0,1000)
  declare ui_slider $_bracket278(0,1000)
  declare ui_slider $_bracket279(0,1000)
  declare ui_slider $_bracket280(0,1000)
  declare ui_slider $_bracket281(0,1000)
  declare ui_slider $_bracket282(0,1000)
  declare ui_slider $_bracket283(0,1000)
  declare ui_slider $_bracket284(0,1000)
  declare ui_slider $_bracket285(0,1000)
  declare ui_slider $_bracket286(0,1000)
  declare ui_slider $_bracket287(0,1000)
  declare ui_slider $_bracket288(0,1000)
  declare ui_slider $_bracket289(0,1000)
  declare ui_slider $_bracket290(0,1000)
  declare ui_slider $_bracket291(0,1000)
  declare ui_slider $_bracket292(0,1000)
  declare ui_slider $_bracket293(0,1000)
  declare ui_slider $_bracket294(0,1000)
  declare ui_slider $_bracket295(0,1000)
  declare ui_slider $_bracket296(0,1000)
  declare ui_slider $_bracket297(0,1000)
  declare ui_slider $_bracket298(0,1000)
  declare ui_slider $_bracket299(0,1000)
  declare ui_slider $_bracket300(0,1000)
  declare ui_slider $_bracket301(0,1000)
  declare ui_slider $_bracket302(0,1000)
  declare ui_slider $_bracket303(0,1000)
  declare ui_slider $_bracket304(0,1000)
  declare ui_slider $_bracket305(0,1000)
  declare ui_slider $_bracket306(0,1000)
  declare ui_slider $_bracket307(0,1000)
  declare ui_slider $_bracket308(0,1000)
  declare ui_slider $_bracket309(0,1000)
  declare ui_slider $_bracket310(0,1000)
  declare ui_slider $_bracket311(0,1000)
  declare ui_slider $_bracket312(0,1000)
  declare ui_slider $_bracket313(0,1000)
  declare ui_slider $_bracket314(0,1000)
  declare ui_slider $_bracket315(0,1000)
  declare ui_slider $_bracket316(0,1000)
  declare ui_slider $_bracket317(0,1000)
  declare ui_slider $_bracket318(0,1000)
  declare ui_slider $_bracket319(0,1000)
  declare ui_slider $_bracket320(0,1000)
  declare ui_slider $_bracket321(0,1000)
  declare ui_slider $_bracket322(0,1000)
  declare ui_slider $_bracket323(0,1000)
  declare ui_slider $_bracket324(0,1000)
  declare ui_slider $_bracket325(0,1000)
  declare ui_slider $_bracket326(0,1000)
  declare ui_slider $_bracket327(0,1000)
  declare ui_slider $_bracket328(0,1000)
  declare ui_slider $_bracket329(0,1000)
  declare ui_slider $_bracket330(0,1000)
  declare ui_slider $_bracket331(0,1000)
  declare ui_slider $_bracket332(0,1000)
  declare ui_slider $_bracket333(0,1000)
  declare ui_slider $_bracket334(0,1000)
  declare ui_slider $_bracket335(0,1000)
  declare ui_slider $_bracket336(0,1000)
  declare ui_slider $_bracket337(0,1000)
  declare ui_slider $_bracket338(0,1000)
  declare ui_slider $_bracket339(0,1000)
  declare ui_slider $_bracket340(0,1000)
  declare ui_slider $_bracket341(0,1000)
  declare ui_slider $_bracket342(0,1000)
  declare ui_slider $_bracket343(0,1000)
  declare ui_slider $_bracket344(0,1000)
  declare ui_slider $_bracket345(0,1000)
  declare ui_slider $_bracket346(0,1000)
  declare ui_slider $_bracket347(0,1000)
  declare ui_slider $_bracket348(0,1000)
  declare ui_slider $_bracket349(0,1000)
  declare ui_slider $_bracket350(0,1000)
  declare ui_slider $_bracket351(0,1000)
  declare ui_slider $_bracket352(0,1000)
  declare ui_slider $_bracket353(0,1000)
  declare ui_slider $_bracket354(0,1000)
  declare ui_slider $_bracket355(0,1000)
  declare ui_slider $_bracket356(0,1000)
  declare ui_slider $_bracket357(0,1000)
  declare ui_slider $_bracket358(0,1000)
  declare ui_slider $_bracket359(0,1000)
  declare ui_slider $_bracket360(0,1000)
  declare ui_slider $_bracket361(0,1000)
  declare ui_slider $_bracket362(0,1000)
  declare ui_slider $_bracket363(0,1000)
  declare ui_slider $_bracket364(0,1000)
  declare ui_slider $_bracket365(0,1000)
  declare ui_slider $_bracket366(0,1000)
  declare ui_slider $_bracket367(0,1000)
  declare ui_slider $_bracket368(0,1000)
  declare ui_slider $_bracket369(0,1000)
  declare ui_slider $_bracket370(0,1000)
  declare ui_slider $_bracket371(0,1000)
  declare ui_slider $_bracket372(0,1000)
  declare ui_slider $_bracket373(0,1000)
  declare ui_slider $_bracket374(0,1000)
  declare ui_slider $_bracket375(0,1000)
  declare ui_slider $_bracket376(0,1000)
  declare ui_slider $_bracket377(0,1000)
  declare ui_slider $_bracket378(0,1000)
  declare ui_slider $_bracket379(0,1000)
  declare ui_slider $_bracket380(0,1000)
  declare ui_slider $_bracket381(0,1000)
  declare ui_slider $_bracket382(0,1000)
  declare ui_slider $_bracket383(0,1000)
  declare ui_slider $_bracket384(0,1000)
  declare ui_slider $_bracket385(0,1000)
  declare ui_slider $_bracket386(0,1000)
  declare ui_slider $_bracket387(0,1000)
  declare ui_slider $_bracket388(0,1000)
  declare ui_slider $_bracket389(0,1000)
  declare ui_slider $_bracket390(0,1000)
  declare ui_slider $_bracket391(0,1000)
  declare ui_slider $_bracket392(0,1000)
  declare ui_slider $_bracket393(0,1000)
  declare ui_slider $_bracket394(0,1000)
  declare ui_slider $_bracket395(0,1000)
  declare ui_slider $_bracket396(0,1000)
  declare ui_slider $_bracket397(0,1000)
  declare ui_slider $_bracket398(0,1000)
  declare ui_slider $_bracket399(0,1000)
  declare ui_slider $_bracket400(0,1000)
  declare ui_slider $_bracket401(0,1000)
  declare ui_slider $_bracket402(0,1000)
  declare ui_slider $_bracket403(0,1000)
  declare ui_slider $_bracket404(0,1000)
  declare ui_slider $_bracket405(0,1000)
  declare ui_slider $_bracket406(0,1000)
  declare ui_slider $_bracket407(0,1000)
  declare ui_slider $_bracket408(0,1000)
  declare ui_slider $_bracket409(0,1000)
  declare ui_slider $_bracket410(0,1000)
  declare ui_slider $_bracket411(0,1000)
  declare ui_slider $_bracket412(0,1000)
  declare ui_slider $_bracket413(0,1000)
  declare ui_slider $_bracket414(0,1000)
  declare ui_slider $_bracket415(0,1000)
  declare ui_slider $_bracket416(0,1000)
  declare ui_slider $_bracket417(0,1000)
  declare ui_slider $_bracket418(0,1000)
  declare ui_slider $_bracket419(0,1000)
  declare ui_slider $_bracket420(0,1000)
  declare ui_slider $_bracket421(0,1000)
  declare ui_slider $_bracket422(0,1000)
  declare ui_slider $_bracket423(0,1000)
  declare ui_slider $_bracket424(0,1000)
  declare ui_slider $_bracket425(0,1000)
  declare ui_slider $_bracket426(0,1000)
  declare ui_slider $_bracket427(0,1000)
  declare ui_slider $_bracket428(0,1000)
  declare ui_slider $_bracket429(0,1000)
  declare ui_slider $_bracket430(0,1000)
  declare ui_slider $_bracket431(0,1000)
  declare ui_slider $_bracket432(0,1000)
  declare ui_slider $_bracket433(0,1000)
  declare ui_slider $_bracket434(0,1000)
  declare ui_slider $_bracket435(0,1000)
  declare ui_slider $_bracket436(0,1000)
  declare ui_slider $_bracket437(0,1000)
  declare ui_slider $_bracket438(0,1000)
  declare ui_slider $_bracket439(0,1000)
  declare ui_slider $_bracket440(0,1000)
  declare ui_slider $_bracket441(0,1000)
  declare ui_slider $_bracket442(0,1000)
  declare ui_slider $_bracket443(0,1000)
  declare ui_slider $_bracket444(0,1000)
  declare ui_slider $_bracket445(0,1000)
  declare ui_slider $_bracket446(0,1000)
  declare ui_slider $_bracket447(0,1000)
  declare ui_slider $_bracket448(0,1000)
  declare ui_slider $_bracket449(0,1000)
  declare ui_slider $_bracket450(0,1000)
  declare ui_slider $_bracket451(0,1000)
  declare ui_slider $_bracket452(0,1000)
  declare ui_slider $_bracket453(0,1000)
  declare ui_slider $_bracket454(0,1000)
  declare ui_slider $_bracket455(0,1000)
  declare ui_slider $_bracket456(0,1000)
  declare ui_slider $_bracket457(0,1000)
  declare ui_slider $_bracket458(0,1000)
  declare ui_slider $_bracket459(0,1000)
  declare ui_slider $_bracket460(0,1000)
  declare ui_slider $_bracket461(0,1000)
  declare ui_slider $_bracket462(0,1000)
  declare ui_slider $_bracket463(0,1000)
  declare ui_slider $_bracket464(0,1000)
  declare ui_slider $_bracket465(0,1000)
  declare ui_slider $_bracket466(0,1000)
  declare ui_slider $_bracket467(0,1000)
  declare ui_slider $_bracket468(0,1000)
  declare ui_slider $_bracket469(0,1000)
  declare ui_slider $_bracket470(0,1000)
  declare ui_slider $_bracket471(0,1000)
  declare ui_slider $_bracket472(0,1000)
  declare ui_slider $_bracket473(0,1000)
  declare ui_slider $_bracket474(0,1000)
  declare ui_slider $_bracket475(0,1000)
  declare ui_slider $_bracket476(0,1000)
  declare ui_slider $_bracket477(0,1000)
  declare ui_slider $_bracket478(0,1000)
  declare ui_slider $_bracket479(0,1000)
  declare ui_slider $_bracket480(0,1000)
  declare ui_slider $_bracket481(0,1000)
  declare ui_slider $_bracket482(0,1000)
  declare ui_slider $_bracket483(0,1000)
  declare ui_slider $_bracket484(0,1000)
  declare ui_slider $_bracket485(0,1000)
  declare ui_slider $_bracket486(0,1000)
  declare ui_slider $_bracket487(0,1000)
  declare ui_slider $_bracket488(0,1000)
  declare ui_slider $_bracket489(0,1000)
  declare ui_slider $_bracket490(0,1000)
  declare ui_slider $_bracket491(0,1000)
  declare ui_slider $_bracket492(0,1000)
  declare ui_slider $_bracket493(0,1000)
  declare ui_slider $_bracket494(0,1000)
  declare ui_slider $_bracket495(0,1000)
  declare ui_slider $_bracket496(0,1000)
  declare ui_slider $_bracket497(0,1000)
  declare ui_slider $_bracket498(0,1000)
  declare ui_slider $_bracket499(0,1000)
  declare ui_slider $_bracket500(0,1000)
  declare ui_slider $_bracket501(0,1000)
  declare ui_slider $_bracket502(0,1000)
  declare ui_slider $_bracket503(0,1000)
  declare ui_slider $_bracket504(0,1000)
  declare ui_slider $_bracket505(0,1000)
  declare ui_slider $_bracket506(0,1000)
  declare ui_slider $_bracket507(0,1000)
  declare ui_slider $_bracket508(0,1000)
  declare ui_slider $_bracket509(0,1000)
  declare ui_slider $_bracket510(0,1000)
  declare ui_slider $_bracket511(0,1000)
  declare ui_slider $_bracket512(0,1000)
  declare ui_slider $_bracket513(0,1000)
  declare ui_slider $_bracket514(0,1000)
  declare ui_slider $_bracket515(0,1000)
  declare ui_slider $_bracket516(0,1000)
  declare ui_slider $_bracket517(0,1000)
  declare ui_slider $_bracket518(0,1000)
  declare ui_slider $_bracket519(0,1000)
  declare ui_slider $_bracket520(0,1000)
  declare ui_slider $_bracket521(0,1000)
  declare ui_slider $_bracket522(0,1000)
  declare ui_slider $_bracket523(0,1000)
  declare ui_slider $_bracket524(0,1000)
  declare ui_slider $_bracket525(0,1000)
  declare ui_slider $_bracket526(0,1000)
  declare ui_slider $_bracket527(0,1000)
  declare ui_slider $_bracket528(0,1000)
  declare ui_slider $_bracket529(0,1000)
  declare ui_slider $_bracket530(0,1000)
  declare ui_slider $_bracket531(0,1000)
  declare ui_slider $_bracket532(0,1000)
  declare ui_slider $_bracket533(0,1000)
  declare ui_slider $_bracket534(0,1000)
  declare ui_slider $_bracket535(0,1000)
  declare ui_slider $_bracket536(0,1000)
  declare ui_slider $_bracket537(0,1000)
  declare ui_slider $_bracket538(0,1000)
  declare ui_slider $_bracket539(0,1000)
  declare ui_slider $_bracket540(0,1000)
  declare ui_slider $_bracket541(0,1000)
  declare ui_slider $_bracket542(0,1000)
  declare ui_slider $_bracket543(0,1000)
  declare ui_slider $_bracket544(0,1000)
  declare ui_slider $_bracket545(0,1000)
  declare ui_slider $_bracket546(0,1000)
  declare ui_slider $_bracket547(0,1000)
  declare ui_slider $_bracket548(0,1000)
  declare ui_slider $_bracket549(0,1000)
  declare ui_slider $_bracket550(0,1000)
  declare ui_slider $_bracket551(0,1000)
  declare ui_slider $_bracket552(0,1000)
  declare ui_slider $_bracket553(0,1000)
  declare ui_slider $_bracket554(0,1000)
  declare ui_slider $_bracket555(0,1000)
  declare ui_slider $_bracket556(0,1000)
  declare ui_slider $_bracket557(0,1000)
  declare ui_slider $_bracket558(0,1000)
  declare ui_slider $_bracket559(0,1000)
  declare ui_slider $_bracket560(0,1000)
  declare ui_slider $_bracket561(0,1000)
  declare ui_slider $_bracket562(0,1000)
  declare ui_slider $_bracket563(0,1000)
  declare ui_slider $_bracket564(0,1000)
  declare ui_slider $_bracket565(0,1000)
  declare ui_slider $_bracket566(0,1000)
  declare ui_slider $_bracket567(0,1000)
  declare ui_slider $_bracket568(0,1000)
  declare ui_slider $_bracket569(0,1000)
  declare ui_slider $_bracket570(0,1000)
  declare ui_slider $_bracket571(0,1000)
  declare ui_slider $_bracket572(0,1000)
  declare ui_slider $_bracket573(0,1000)
  declare ui_slider $_bracket574(0,1000)
  declare ui_slider $_bracket575(0,1000)
  $preproc_i := 0
  while ($preproc_i<=575)
    %_bracket[$preproc_i] := get_ui_id($_bracket0)+$preproc_i
    inc($preproc_i)
  end while
  $i := 0
  while ($i<$bracket__size_D1)
    $v := 0
    while ($v<$bracket__size_D2)
      set_control_par(%_bracket[9*$i+$v],$CONTROL_PAR_POS_X,20+($i*18))
      set_control_par(%_bracket[9*$i+$v],$CONTROL_PAR_POS_Y,100+(($bracket__size_D2-$v)*18))
      set_control_par(%_bracket[9*$i+$v],$CONTROL_PAR_WIDTH,13)
      set_control_par(%_bracket[9*$i+$v],$CONTROL_PAR_HEIGHT,13)
      set_control_par(%_bracket[9*$i+$v],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
      set_control_par_str(%_bracket[9*$i+$v],$CONTROL_PAR_PICTURE,"circle")
      inc($v)
    end while
    inc($i)
  end while
  set_voice_limit($NI_VL_TMPRO_STANDARD,100)
  declare %ripple[100]
  declare ui_label $ripple0(2,2)
  declare ui_label $ripple1(2,2)
  declare ui_label $ripple2(2,2)
  declare ui_label $ripple3(2,2)
  declare ui_label $ripple4(2,2)
  declare ui_label $ripple5(2,2)
  declare ui_label $ripple6(2,2)
  declare ui_label $ripple7(2,2)
  declare ui_label $ripple8(2,2)
  declare ui_label $ripple9(2,2)
  declare ui_label $ripple10(2,2)
  declare ui_label $ripple11(2,2)
  declare ui_label $ripple12(2,2)
  declare ui_label $ripple13(2,2)
  declare ui_label $ripple14(2,2)
  declare ui_label $ripple15(2,2)
  declare ui_label $ripple16(2,2)
  declare ui_label $ripple17(2,2)
  declare ui_label $ripple18(2,2)
  declare ui_label $ripple19(2,2)
  declare ui_label $ripple20(2,2)
  declare ui_label $ripple21(2,2)
  declare ui_label $ripple22(2,2)
  declare ui_label $ripple23(2,2)
  declare ui_label $ripple24(2,2)
  declare ui_label $ripple25(2,2)
  declare ui_label $ripple26(2,2)
  declare ui_label $ripple27(2,2)
  declare ui_label $ripple28(2,2)
  declare ui_label $ripple29(2,2)
  declare ui_label $ripple30(2,2)
  declare ui_label $ripple31(2,2)
  declare ui_label $ripple32(2,2)
  declare ui_label $ripple33(2,2)
  declare ui_label $ripple34(2,2)
  declare ui_label $ripple35(2,2)
  declare ui_label $ripple36(2,2)
  declare ui_label $ripple37(2,2)
  declare ui_label $ripple38(2,2)
  declare ui_label $ripple39(2,2)
  declare ui_label $ripple40(2,2)
  declare ui_label $ripple41(2,2)
  declare ui_label $ripple42(2,2)
  declare ui_label $ripple43(2,2)
  declare ui_label $ripple44(2,2)
  declare ui_label $ripple45(2,2)
  declare ui_label $ripple46(2,2)
  declare ui_label $ripple47(2,2)
  declare ui_label $ripple48(2,2)
  declare ui_label $ripple49(2,2)
  declare ui_label $ripple50(2,2)
  declare ui_label $ripple51(2,2)
  declare ui_label $ripple52(2,2)
  declare ui_label $ripple53(2,2)
  declare ui_label $ripple54(2,2)
  declare ui_label $ripple55(2,2)
  declare ui_label $ripple56(2,2)
  declare ui_label $ripple57(2,2)
  declare ui_label $ripple58(2,2)
  declare ui_label $ripple59(2,2)
  declare ui_label $ripple60(2,2)
  declare ui_label $ripple61(2,2)
  declare ui_label $ripple62(2,2)
  declare ui_label $ripple63(2,2)
  declare ui_label $ripple64(2,2)
  declare ui_label $ripple65(2,2)
  declare ui_label $ripple66(2,2)
  declare ui_label $ripple67(2,2)
  declare ui_label $ripple68(2,2)
  declare ui_label $ripple69(2,2)
  declare ui_label $ripple70(2,2)
  declare ui_label $ripple71(2,2)
  declare ui_label $ripple72(2,2)
  declare ui_label $ripple73(2,2)
  declare ui_label $ripple74(2,2)
  declare ui_label $ripple75(2,2)
  declare ui_label $ripple76(2,2)
  declare ui_label $ripple77(2,2)
  declare ui_label $ripple78(2,2)
  declare ui_label $ripple79(2,2)
  declare ui_label $ripple80(2,2)
  declare ui_label $ripple81(2,2)
  declare ui_label $ripple82(2,2)
  declare ui_label $ripple83(2,2)
  declare ui_label $ripple84(2,2)
  declare ui_label $ripple85(2,2)
  declare ui_label $ripple86(2,2)
  declare ui_label $ripple87(2,2)
  declare ui_label $ripple88(2,2)
  declare ui_label $ripple89(2,2)
  declare ui_label $ripple90(2,2)
  declare ui_label $ripple91(2,2)
  declare ui_label $ripple92(2,2)
  declare ui_label $ripple93(2,2)
  declare ui_label $ripple94(2,2)
  declare ui_label $ripple95(2,2)
  declare ui_label $ripple96(2,2)
  declare ui_label $ripple97(2,2)
  declare ui_label $ripple98(2,2)
  declare ui_label $ripple99(2,2)
  $preproc_i := 0
  while ($preproc_i<=99)
    %ripple[$preproc_i] := get_ui_id($ripple0)+$preproc_i
    inc($preproc_i)
  end while
  $i := 0
  while ($i<num_elements(%ripple))
    set_control_par_str(%ripple[$i],$CONTROL_PAR_TEXT,"")
    set_control_par(%ripple[$i],$CONTROL_PAR_Z_LAYER,1)
    set_control_par(%ripple[$i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    set_control_par(%ripple[$i],$CONTROL_PAR_PICTURE_STATE,127)
    inc($i)
  end while
  declare %dot[100]
  declare ui_slider $dot0(0,127)
  declare ui_slider $dot1(0,127)
  declare ui_slider $dot2(0,127)
  declare ui_slider $dot3(0,127)
  declare ui_slider $dot4(0,127)
  declare ui_slider $dot5(0,127)
  declare ui_slider $dot6(0,127)
  declare ui_slider $dot7(0,127)
  declare ui_slider $dot8(0,127)
  declare ui_slider $dot9(0,127)
  declare ui_slider $dot10(0,127)
  declare ui_slider $dot11(0,127)
  declare ui_slider $dot12(0,127)
  declare ui_slider $dot13(0,127)
  declare ui_slider $dot14(0,127)
  declare ui_slider $dot15(0,127)
  declare ui_slider $dot16(0,127)
  declare ui_slider $dot17(0,127)
  declare ui_slider $dot18(0,127)
  declare ui_slider $dot19(0,127)
  declare ui_slider $dot20(0,127)
  declare ui_slider $dot21(0,127)
  declare ui_slider $dot22(0,127)
  declare ui_slider $dot23(0,127)
  declare ui_slider $dot24(0,127)
  declare ui_slider $dot25(0,127)
  declare ui_slider $dot26(0,127)
  declare ui_slider $dot27(0,127)
  declare ui_slider $dot28(0,127)
  declare ui_slider $dot29(0,127)
  declare ui_slider $dot30(0,127)
  declare ui_slider $dot31(0,127)
  declare ui_slider $dot32(0,127)
  declare ui_slider $dot33(0,127)
  declare ui_slider $dot34(0,127)
  declare ui_slider $dot35(0,127)
  declare ui_slider $dot36(0,127)
  declare ui_slider $dot37(0,127)
  declare ui_slider $dot38(0,127)
  declare ui_slider $dot39(0,127)
  declare ui_slider $dot40(0,127)
  declare ui_slider $dot41(0,127)
  declare ui_slider $dot42(0,127)
  declare ui_slider $dot43(0,127)
  declare ui_slider $dot44(0,127)
  declare ui_slider $dot45(0,127)
  declare ui_slider $dot46(0,127)
  declare ui_slider $dot47(0,127)
  declare ui_slider $dot48(0,127)
  declare ui_slider $dot49(0,127)
  declare ui_slider $dot50(0,127)
  declare ui_slider $dot51(0,127)
  declare ui_slider $dot52(0,127)
  declare ui_slider $dot53(0,127)
  declare ui_slider $dot54(0,127)
  declare ui_slider $dot55(0,127)
  declare ui_slider $dot56(0,127)
  declare ui_slider $dot57(0,127)
  declare ui_slider $dot58(0,127)
  declare ui_slider $dot59(0,127)
  declare ui_slider $dot60(0,127)
  declare ui_slider $dot61(0,127)
  declare ui_slider $dot62(0,127)
  declare ui_slider $dot63(0,127)
  declare ui_slider $dot64(0,127)
  declare ui_slider $dot65(0,127)
  declare ui_slider $dot66(0,127)
  declare ui_slider $dot67(0,127)
  declare ui_slider $dot68(0,127)
  declare ui_slider $dot69(0,127)
  declare ui_slider $dot70(0,127)
  declare ui_slider $dot71(0,127)
  declare ui_slider $dot72(0,127)
  declare ui_slider $dot73(0,127)
  declare ui_slider $dot74(0,127)
  declare ui_slider $dot75(0,127)
  declare ui_slider $dot76(0,127)
  declare ui_slider $dot77(0,127)
  declare ui_slider $dot78(0,127)
  declare ui_slider $dot79(0,127)
  declare ui_slider $dot80(0,127)
  declare ui_slider $dot81(0,127)
  declare ui_slider $dot82(0,127)
  declare ui_slider $dot83(0,127)
  declare ui_slider $dot84(0,127)
  declare ui_slider $dot85(0,127)
  declare ui_slider $dot86(0,127)
  declare ui_slider $dot87(0,127)
  declare ui_slider $dot88(0,127)
  declare ui_slider $dot89(0,127)
  declare ui_slider $dot90(0,127)
  declare ui_slider $dot91(0,127)
  declare ui_slider $dot92(0,127)
  declare ui_slider $dot93(0,127)
  declare ui_slider $dot94(0,127)
  declare ui_slider $dot95(0,127)
  declare ui_slider $dot96(0,127)
  declare ui_slider $dot97(0,127)
  declare ui_slider $dot98(0,127)
  declare ui_slider $dot99(0,127)
  $preproc_i := 0
  while ($preproc_i<=99)
    %dot[$preproc_i] := get_ui_id($dot0)+$preproc_i
    inc($preproc_i)
  end while
  $i := 0
  while ($i<num_elements(%dot))
    set_control_par_str(%dot[$i],$CONTROL_PAR_PICTURE,"triangle right")
    set_control_par(%dot[$i],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
    set_control_par(%dot[$i],$CONTROL_PAR_VALUE,1000)
    set_control_par(%dot[$i],$CONTROL_PAR_POS_X,0)
    set_control_par(%dot[$i],$CONTROL_PAR_POS_Y,0)
    set_control_par(%dot[$i],$CONTROL_PAR_Z_LAYER,1)
    inc($i)
  end while
  set_engine_par($ENGINE_PAR_SPEED,1000000-((18*2-1)*90909),$ARTIC__QUARTERS,-1,-1)
  set_engine_par($ENGINE_PAR_SPEED,1000000-((18-1)*90909),$ARTIC__EIGHTHS,-1,-1)
  set_engine_par($ENGINE_PAR_SPEED,1000000-((18-1)*90909),$ARTIC__SIXTEENTHS,-1,-1)
  declare $_index
  declare $_r3
  declare $_low_note4
  declare $_high_note4
  declare $_interval2
  declare $_found_free_row2 := 0
  declare $_collision_found2 := 0
  declare $_channel3
  declare $_artic2
  declare ~_speed_curve
  declare ~_brightness_curve
  declare $_start2
  declare $_stop2
  declare $_play_pos_in_beat
  declare ~_play_pos_in_beat_norm
  declare $_play_pos_in_beat_curved
  declare $__start2
  declare $__stop2
  declare $_direction
  declare $_time_since_release
  declare $_release_length
  declare $_brightness_on_release
  declare @_str
  declare $_note
  declare $_velocity
  declare %_event_pars[$EVENT__SIZE]
  declare $_offset2
  declare $_note_id2
  declare $_prev_cc64
  declare $_key_i2
  declare $_c
  declare $_channel2
  declare $_history_index
  declare $_r2
  declare $_low_note3
  declare $_high_note3
  declare $_artic
  declare $_recorded_pos_in_pulse2
  declare $_actual_pos_in_pulse2
  declare $_fade_out_time
  declare $_channel
  declare $_ks_index
  declare %_notes[64]
  declare %_intervals[64]
  declare %__notes[12]
  declare %__intervals[12]
  declare $_num_ripples := 0
  declare $_closest_neighbor := -1
  declare $_closest_neighbor_interval := 12
  declare %_neighbor[12]
  declare %_lower_neighbor[12]
  declare %_upper_neighbor[12]
  declare $_num_neighbors := 0
  declare $_num_lower_neighbors := 0
  declare $_num_upper_neighbors := 0
  declare $_dir
  declare $_sign
  declare $_other_note
  declare $_lower_neighbor_time_held
  declare $_upper_neighbor_time_held
  declare %_channel_history[$key_history__SIZE_D2]
  declare $_hist_i3
  declare $_ripple_i
  declare $_low_note2
  declare $_high_note2
  declare $_already_playing := 0
  declare $_active_note_id
  declare $_offset
  declare $_note_id
  declare $_recorded_pos_in_pulse
  declare $_actual_pos_in_pulse
  declare $_fade_in_time
  declare $_hist_i
  declare $_note_found := 0
  declare $_e
  declare %_event_ids[64]
  declare $_found := 0
end on

function set_key_colors
  $key_i := 0
  while ($key_i<=127)
    set_key_color($key_i,$KEY_COLOR_INACTIVE)
    if (search(%articulation_keyswitches,$key_i) # -1)
      set_key_color($key_i,$KEY_COLOR_RED)
    end if
    if (in_range($key_i,$LOWEST_KEY,$HIGHEST_KEY))
      set_key_color($key_i,$KEY_COLOR_DEFAULT)
    end if
    if (search(%speed_keyswitches,$key_i) # -1)
      set_key_color($key_i,$KEY_COLOR_GREEN)
    end if
    if (search(%direction_keyswitches,$key_i) # -1)
      set_key_color($key_i,$KEY_COLOR_YELLOW)
    end if
    if (search(%legato_keyswitches,$key_i) # -1)
      set_key_color($key_i,$KEY_COLOR_PURPLE)
    end if
    inc($key_i)
  end while
end function

function update_articulation_switches
  $i := 0
  while ($i<num_elements(%articulation_ids))
    if ($i=$cur_artic)
      set_control_par(%articulation_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%articulation_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function update_speed_switches
  $i := 0
  while ($i<num_elements(%speed_ids))
    if ($i=$slider_speed)
      set_control_par(%speed_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%speed_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function update_direction_switches
  $i := 0
  while ($i<num_elements(%direction_mode_ids))
    if ($i=$slider_direction)
      set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%direction_mode_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function update_legato_switches
  $i := 0
  while ($i<num_elements(%legato_ids))
    if ($i=$slider_legato)
      set_control_par(%legato_ids[$i],$CONTROL_PAR_VALUE,1)
    else
      set_control_par(%legato_ids[$i],$CONTROL_PAR_VALUE,0)
    end if
    inc($i)
  end while
end function

function set_keys_pressed
  $i := 0
  while ($i<$NUM_ARTICULATIONS)
    if ($i=$cur_artic)
      set_key_pressed(%articulation_keyswitches[$i],1)
    else
      set_key_pressed(%articulation_keyswitches[$i],0)
    end if
    inc($i)
  end while
  $i := 0
  while ($i<5)
    if ($i=$slider_speed)
      set_key_pressed(%speed_keyswitches[$i],1)
    else
      set_key_pressed(%speed_keyswitches[$i],0)
    end if
    inc($i)
  end while
  $i := 0
  while ($i<$DIRECTION_MODE__SIZE)
    if ($i=$slider_direction)
      set_key_pressed(%direction_keyswitches[$i],1)
    else
      set_key_pressed(%direction_keyswitches[$i],0)
    end if
    inc($i)
  end while
  $i := 0
  while ($i<$LEGATO_MODE__SIZE)
    if ($i=$slider_legato)
      set_key_pressed(%legato_keyswitches[$i],1)
    else
      set_key_pressed(%legato_keyswitches[$i],0)
    end if
    inc($i)
  end while
end function

function update_speed
  $g := 0
  while ($g<$NUM_GROUPS)
    if ($switch_halfSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_QUARTER,$g,-1,-1)
    end if
    if ($switch_slowTripletSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_QUARTER_TRIPLET,$g,-1,-1)
    end if
    if ($switch_fullSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_8TH,$g,-1,-1)
    end if
    if ($switch_fastTripletSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_8TH_TRIPLET,$g,-1,-1)
    end if
    if ($switch_doubleSpeed=1)
      set_engine_par($ENGINE_PAR_SPEED_UNIT,$NI_SYNC_UNIT_16TH,$g,-1,-1)
    end if
    inc($g)
  end while
end function

on persistence_changed
  call set_key_colors
  call set_keys_pressed
end on

on note
  set_key_pressed($EVENT_NOTE,1)
  $_channel := get_event_par($EVENT_ID,$EVENT_PAR_MIDI_CHANNEL)
  ignore_event($EVENT_ID)
  $_ks_index := search(%articulation_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $cur_artic := $_ks_index
    call update_articulation_switches
  end if
  $_ks_index := search(%speed_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $slider_speed := $_ks_index
    call update_speed_switches
  end if
  $_ks_index := search(%direction_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $slider_direction := $_ks_index
    call update_direction_switches
  end if
  $_ks_index := search(%legato_keyswitches,$EVENT_NOTE)
  if ($_ks_index # -1)
    $slider_legato := $_ks_index
    call update_legato_switches
  end if
  if (search(%all_keyswitches,$EVENT_NOTE) # -1)
    call set_keys_pressed
  end if
  if (in_range($EVENT_NOTE,$LOWEST_KEY,$HIGHEST_KEY))
    %_key_active[128*$_channel+$EVENT_NOTE] := 1
    %_key_timestamp[128*$_channel+$EVENT_NOTE] := $ENGINE_UPTIME
    %_velo[128*$_channel+$EVENT_NOTE] := $EVENT_VELOCITY
    set_control_par(%key_ids[$EVENT_NOTE],$CONTROL_PAR_PICTURE_STATE,1)
    set_control_par(%key_base_ids[$EVENT_NOTE],$CONTROL_PAR_PICTURE_STATE,1)
    $key_i := $key_history__SIZE_D2-2
    while ($key_i>=0)
      %_key_history[100*$_channel+$key_i+1] := %_key_history[100*$_channel+$key_i]
      dec($key_i)
    end while
    %_key_history[100*$_channel+0] := $EVENT_NOTE
    %num_keys_pressed[$_channel] := 0
    $key_i := $LOWEST_KEY
    while ($key_i<=$HIGHEST_KEY)
      if (%_key_active[128*$_channel+$key_i]=1)
        inc(%num_keys_pressed[$_channel])
      end if
      inc($key_i)
    end while
    if (%num_keys_pressed[$_channel]>1)
      $_num_ripples := 0
      $_closest_neighbor := -1
      $_closest_neighbor_interval := 12
      $array_i := 0
      while ($array_i<num_elements(%_neighbor))
        %_neighbor[$array_i] := 0
        inc($array_i)
      end while
      $array_i := 0
      while ($array_i<num_elements(%_lower_neighbor))
        %_lower_neighbor[$array_i] := 0
        inc($array_i)
      end while
      $array_i := 0
      while ($array_i<num_elements(%_upper_neighbor))
        %_upper_neighbor[$array_i] := 0
        inc($array_i)
      end while
      $_num_neighbors := 0
      $_num_lower_neighbors := 0
      $_num_upper_neighbors := 0
      $i := 1
      while ($i<=$MAX_INTERVAL)
        $_dir := 0
        while ($_dir<=1)
          $_sign := $_dir*2-1
          $_other_note := $EVENT_NOTE+($i*$_sign)
          if (%KEY_DOWN[$_other_note]=1)
            %_neighbor[$_num_neighbors] := $_other_note
            inc($_num_neighbors)
            if ($_other_note<$EVENT_NOTE)
              %_lower_neighbor[$_num_lower_neighbors] := $_other_note
              inc($_num_lower_neighbors)
            end if
            if ($_other_note>$EVENT_NOTE)
              %_upper_neighbor[$_num_upper_neighbors] := $_other_note
              inc($_num_upper_neighbors)
            end if
          end if
          inc($_dir)
        end while
        inc($i)
      end while
      if (%_lower_neighbor[0] # 0 and (%_upper_neighbor[0] # 0))
        $_lower_neighbor_time_held := $ENGINE_UPTIME-%_key_timestamp[128*$_channel+%_lower_neighbor[0]]
        $_upper_neighbor_time_held := $ENGINE_UPTIME-%_key_timestamp[128*$_channel+%_upper_neighbor[0]]
        if (abs($_upper_neighbor_time_held-$_lower_neighbor_time_held)<50)
          %__notes[0] := %_lower_neighbor[0]
          %__intervals[0] := $EVENT_NOTE-%_lower_neighbor[0]
          %__notes[1] := %_upper_neighbor[0]
          %__intervals[1] := $EVENT_NOTE-%_upper_neighbor[0]
          $_num_ripples := 2
        else
          $_hist_i3 := 0
          while ($_hist_i3<$key_history__SIZE_D2)
            %_channel_history[$_hist_i3] := %_key_history[100*$_channel+$_hist_i3]
            inc($_hist_i3)
          end while
          if (search(%_channel_history,%_lower_neighbor[0])<search(%_channel_history,%_upper_neighbor[0]))
            %__notes[0] := %_lower_neighbor[0]
            %__intervals[0] := $EVENT_NOTE-%_lower_neighbor[0]
          else
            %__notes[0] := %_upper_neighbor[0]
            %__intervals[0] := $EVENT_NOTE-%_upper_neighbor[0]
          end if
          $_num_ripples := 1
        end if
      else
        %__notes[0] := %_key_history[100*$_channel+1]
        %__intervals[0] := %_key_history[100*$_channel+0]-%_key_history[100*$_channel+1]
        $_num_ripples := 1
        if (abs(%__intervals[0])>$MAX_INTERVAL)
          if ($_num_neighbors>0)
            %__notes[0] := %_neighbor[0]
            %__intervals[0] := $EVENT_NOTE-%_neighbor[0]
            $_num_ripples := 1
          else
            $array_i := 0
            while ($array_i<num_elements(%__notes))
              %__notes[$array_i] := 0
              inc($array_i)
            end while
            $array_i := 0
            while ($array_i<num_elements(%__intervals))
              %__intervals[$array_i] := 0
              inc($array_i)
            end while
            $_num_ripples := 0
          end if
        end if
      end if
      $_ripple_i := 0
      while ($_ripple_i<$_num_ripples)
        if ($slider_direction=$DIRECTION_MODE__UP)
          if (%__intervals[$_ripple_i]<0)
            %__notes[$_ripple_i] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
            %__intervals[$_ripple_i] := -%__intervals[$_ripple_i]
          end if
        else
          if ($slider_direction=$DIRECTION_MODE__DOWN)
            if (%__intervals[$_ripple_i]>0)
              %__notes[$_ripple_i] := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
              %__intervals[$_ripple_i] := -%__intervals[$_ripple_i]
            end if
          end if
        end if
        if (%__intervals[$_ripple_i]<0)
          $_low_note2 := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
          $_high_note2 := %__notes[$_ripple_i]
        else
          $_low_note2 := %__notes[$_ripple_i]
          $_high_note2 := %__notes[$_ripple_i]+%__intervals[$_ripple_i]
        end if
        if (%__intervals[$_ripple_i]>0)
          $direction := $UP
        else
          $direction := $DOWN
        end if
        $_already_playing := 0
        $r := 0
        while ($r<100)
          if (%ripple_history[$r] # 0)
            if (get_event_par_arr(%ripple_history[$r],$EVENT_PAR_CUSTOM,$EVENT__LOW_NOTE)=$_low_note2 and (get_event_par_arr(%ripple_history[$r],$EVENT_PAR_CUSTOM,$EVENT__HIGH_NOTE)=$_high_note2) and (get_event_par_arr(%ripple_history[$r],$EVENT_PAR_CUSTOM,$EVENT__DIRECTION)=$direction) and (get_event_par_arr(%ripple_history[$r],$EVENT_PAR_CUSTOM,$EVENT__FADING_OUT)=0))
              $_already_playing := 1
            end if
          end if
          inc($r)
        end while
        if ($_already_playing=0)
          $_found := 0
          $_active_note_id := 0
          get_event_ids(%_event_ids)
          $_e := 0
          while ($_e<num_elements(%_event_ids))
            if (get_event_par(%_event_ids[$_e],$EVENT_PAR_SOURCE) # -1 and (get_event_par(%_event_ids[$_e],$EVENT_PAR_PLAY_POS)>0))
              if ($_found=0)
                $_active_note_id := %_event_ids[$_e]
                $_found := 1
              end if
            end if
            inc($_e)
          end while
          select ($slider_legato)
            case $LEGATO_MODE__OFF
              $_offset := 0
            case $LEGATO_MODE__SYNC_TO_PITCH
              $_offset := get_event_par($_active_note_id,$EVENT_PAR_PLAY_POS) mod (%recorded_pulse_lengths[$cur_artic]/2)
            case $LEGATO_MODE__SYNC_TO_RIPPLE
              $_offset := get_event_par($_active_note_id,$EVENT_PAR_PLAY_POS) mod %recorded_pulse_lengths[$cur_artic]
            case $LEGATO_MODE__SYNC_TO_SWELL
              $_offset := get_event_par($_active_note_id,$EVENT_PAR_PLAY_POS) mod %sample_lengths[$cur_artic]
          end select
          $_note_id := play_note(%__notes[$_ripple_i],64+%__intervals[$_ripple_i],$_offset,0)
          set_event_par_arr($_note_id,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
          set_event_par_arr($_note_id,$EVENT_PAR_ALLOW_GROUP,1,$cur_artic)
          set_event_par_arr($_note_id,$EVENT_PAR_CUSTOM,$cur_artic,$EVENT__ARTIC)
          set_event_par_arr($_note_id,$EVENT_PAR_CUSTOM,$_low_note2,$EVENT__LOW_NOTE)
          set_event_par_arr($_note_id,$EVENT_PAR_CUSTOM,$_high_note2,$EVENT__HIGH_NOTE)
          set_event_par_arr($_note_id,$EVENT_PAR_CUSTOM,$_channel,$EVENT__CHANNEL)
          set_event_par_arr($_note_id,$EVENT_PAR_CUSTOM,$direction,$EVENT__DIRECTION)
          $r := 100-2
          while ($r>=0)
            %_ripple_history_by_channel[100*$_channel+$r+1] := %_ripple_history_by_channel[100*$_channel+$r]
            %ripple_history[$r+1] := %ripple_history[$r]
            dec($r)
          end while
          %_ripple_history_by_channel[100*$_channel+0] := $_note_id
          %ripple_history[0] := $_note_id
          if ($_offset>0)
            $_recorded_pos_in_pulse := get_event_par($_note_id,$EVENT_PAR_PLAY_POS) mod %recorded_pulse_lengths[$cur_artic]
            $_actual_pos_in_pulse := int(real(0)+((real($_recorded_pos_in_pulse)-real(0))/(real(%recorded_pulse_lengths[$cur_artic])-real(0))*(real(ticks_to_ms(%pulse_lengths_ticks[$cur_artic]))-real(0))))
            $_fade_in_time := ticks_to_ms(%pulse_lengths_ticks[$cur_artic])-$_actual_pos_in_pulse
            if ($_fade_in_time<$DURATION_SIXTEENTH)
              $_fade_in_time := $DURATION_SIXTEENTH
            end if
            if ($_fade_in_time>(ticks_to_ms(%pulse_lengths_ticks[$cur_artic])/4*3))
              $_fade_in_time := ticks_to_ms(%pulse_lengths_ticks[$cur_artic])/4*3
            end if
            fade_in($_note_id,$_fade_in_time)
          end if
        end if
        inc($_ripple_i)
      end while
    end if
  end if
end on

on release
  if (search(%all_keyswitches,$EVENT_NOTE)=-1)
    set_key_pressed($EVENT_NOTE,0)
  end if
  if (in_range($EVENT_NOTE,$LOWEST_KEY,$HIGHEST_KEY))
    $_channel2 := get_event_par($EVENT_ID,$EVENT_PAR_MIDI_CHANNEL)
    set_control_par(%key_ids[$EVENT_NOTE],$CONTROL_PAR_PICTURE_STATE,0)
    set_control_par(%key_base_ids[$EVENT_NOTE],$CONTROL_PAR_PICTURE_STATE,0)
    $_note_found := 0
    $_hist_i := 0
    while ($_hist_i<$key_history__SIZE_D2)
      if ($_note_found=0)
        if (%_key_history[100*$_channel2+$_hist_i]=$EVENT_NOTE)
          $_note_found := 1
          $_history_index := $_hist_i
        end if
      end if
      inc($_hist_i)
    end while
    if ($_note_found=0)
      $_history_index := -1
    end if
    if ($_history_index>-1)
      $key_i := $_history_index
      while ($key_i<=($key_history__SIZE_D2-2))
        %_key_history[100*$_channel2+$key_i] := %_key_history[100*$_channel2+$key_i+1]
        inc($key_i)
      end while
    end if
    if (%CC[64]<10)
      if (get_event_par($EVENT_ID,$EVENT_PAR_SOURCE)=-1)
        %_key_active[128*$_channel2+$EVENT_NOTE] := 0
        $_r2 := 0
        while ($_r2<100)
          if (%ripple_history[$_r2] # 0 and (get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__FADING_OUT)=0))
            if ($_channel2=get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__CHANNEL))
              $_low_note3 := get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__LOW_NOTE)
              $_high_note3 := get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__HIGH_NOTE)
              if ($_low_note3=$EVENT_NOTE or ($_high_note3=$EVENT_NOTE))
                $_artic := get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__ARTIC)
                $_recorded_pos_in_pulse2 := get_event_par(%ripple_history[$_r2],$EVENT_PAR_PLAY_POS) mod %recorded_pulse_lengths[$_artic]
                $_actual_pos_in_pulse2 := int(real(0)+((real($_recorded_pos_in_pulse2)-real(0))/(real(%recorded_pulse_lengths[$_artic])-real(0))*(real(ticks_to_ms(%pulse_lengths_ticks[$_artic]))-real(0))))
                $_fade_out_time := ticks_to_ms(%pulse_lengths_ticks[$_artic])-$_actual_pos_in_pulse2
                if ($_fade_out_time<$DURATION_SIXTEENTH)
                  $_fade_out_time := $DURATION_SIXTEENTH
                end if
                if ($_fade_out_time>(ticks_to_ms(%pulse_lengths_ticks[$_artic])/4*3))
                  $_fade_out_time := ticks_to_ms(%pulse_lengths_ticks[$_artic])/4*3
                end if
                fade_out(%ripple_history[$_r2],$_fade_out_time,1)
                set_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$ENGINE_UPTIME,$EVENT__RELEASE_TIMESTAMP)
                set_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$_fade_out_time,$EVENT__RELEASE_LENGTH)
                set_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,1,$EVENT__FADING_OUT)
              end if
            end if
          end if
          inc($_r2)
        end while
      end if
    end if
  end if
end on

on controller
  if ($CC_NUM=64)
    if (%CC[64]<10 and ($_prev_cc64>=10))
      $_c := 0
      while ($_c<=15)
        $_key_i2 := 0
        while ($_key_i2<=127)
          if (%KEY_DOWN[$_key_i2]=0 and (%_key_active[128*$_c+$_key_i2]=1))
            %_key_active[128*$_c+$_key_i2] := 0
            $_r2 := 0
            while ($_r2<100)
              if (%ripple_history[$_r2] # 0 and (get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__FADING_OUT)=0))
                if ($_c=get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__CHANNEL))
                  $_low_note3 := get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__LOW_NOTE)
                  $_high_note3 := get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__HIGH_NOTE)
                  if ($_low_note3=$_key_i2 or ($_high_note3=$_key_i2))
                    $_artic := get_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$EVENT__ARTIC)
                    $_recorded_pos_in_pulse2 := get_event_par(%ripple_history[$_r2],$EVENT_PAR_PLAY_POS) mod %recorded_pulse_lengths[$_artic]
                    $_actual_pos_in_pulse2 := int(real(0)+((real($_recorded_pos_in_pulse2)-real(0))/(real(%recorded_pulse_lengths[$_artic])-real(0))*(real(ticks_to_ms(%pulse_lengths_ticks[$_artic]))-real(0))))
                    $_fade_out_time := ticks_to_ms(%pulse_lengths_ticks[$_artic])-$_actual_pos_in_pulse2
                    if ($_fade_out_time<$DURATION_SIXTEENTH)
                      $_fade_out_time := $DURATION_SIXTEENTH
                    end if
                    if ($_fade_out_time>(ticks_to_ms(%pulse_lengths_ticks[$_artic])/4*3))
                      $_fade_out_time := ticks_to_ms(%pulse_lengths_ticks[$_artic])/4*3
                    end if
                    fade_out(%ripple_history[$_r2],$_fade_out_time,1)
                    set_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$ENGINE_UPTIME,$EVENT__RELEASE_TIMESTAMP)
                    set_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,$_fade_out_time,$EVENT__RELEASE_LENGTH)
                    set_event_par_arr(%ripple_history[$_r2],$EVENT_PAR_CUSTOM,1,$EVENT__FADING_OUT)
                  end if
                end if
              end if
              inc($_r2)
            end while
          end if
          inc($_key_i2)
        end while
        inc($_c)
      end while
    end if
    $_prev_cc64 := %CC[64]
  end if
end on

on listener
  if ($NI_SIGNAL_TYPE=$NI_SIGNAL_TIMER_MS)
    $_r3 := 0
    while ($_r3<100)
      if (event_status(%ripple_history[$_r3])=$EVENT_STATUS_INACTIVE and (%ripple_history[$_r3] # 0))
        set_control_par(%ripple[$_r3],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
        set_control_par(%dot[$_r3],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
        $hist_i := $_r3
        while ($hist_i<=(100-2))
          %_ripple_history_by_channel[100*$_channel3+$hist_i] := %_ripple_history_by_channel[100*$_channel3+$hist_i+1]
          %ripple_history[$hist_i] := %ripple_history[$hist_i+1]
          inc($hist_i)
        end while
      end if
      inc($_r3)
    end while
    $key_i := $LOWEST_KEY
    while ($key_i<=$HIGHEST_KEY)
      $row_i := 0
      while ($row_i<20)
        %_grid[20*$key_i+$row_i] := 0
        %_grid_for_half_steps[20*$key_i+$row_i] := 0
        inc($row_i)
      end while
      inc($key_i)
    end while
    $highest_row := 0
    $_r3 := 100-1
    while ($_r3>=0)
      if (%ripple_history[$_r3] # 0)
        $_low_note4 := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__LOW_NOTE)
        $_high_note4 := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__HIGH_NOTE)
        $_interval2 := $_high_note4-$_low_note4
        $row := 0
        $_found_free_row2 := 0
        $row_i := 0
        while ($row_i<20)
          if ($_found_free_row2=0)
            $_collision_found2 := 0
            $key_i := $_low_note4+1
            while ($key_i<$_high_note4)
              if (%_grid[20*$key_i+$row_i]=1)
                $_collision_found2 := 1
              end if
              inc($key_i)
            end while
            if (abs($_interval2)=1)
              if (%_grid[20*$_low_note4+$row_i]=1 and (%_grid[20*$_high_note4+$row_i]=1))
                $_collision_found2 := 1
              end if
              if (%_grid_for_half_steps[20*$_low_note4+$row_i]=1 and (%_grid_for_half_steps[20*$_high_note4+$row_i]=1))
                $_collision_found2 := 1
              end if
            end if
            if ($_collision_found2=0)
              $_found_free_row2 := 1
              $row := $row_i
            end if
          end if
          inc($row_i)
        end while
        if ($_found_free_row2=1)
          if ($row>$highest_row)
            $highest_row := $row
          end if
          set_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$row,$EVENT__ROW)
          $key_i := $_low_note4
          while ($key_i<=$_high_note4)
            %_grid[20*$key_i+$row] := 1
            if (abs($_interval2)=1)
              %_grid_for_half_steps[20*$key_i+$row] := 1
            end if
            inc($key_i)
          end while
        end if
      end if
      dec($_r3)
    end while
    if ($highest_row>=3)
      $grid_row_height := 134/($highest_row+1)
    else
      $grid_row_height := 134/4
    end if
    $_r3 := 100-1
    while ($_r3>=0)
      if (event_status(%ripple_history[$_r3])=$EVENT_STATUS_NOTE_QUEUE)
        if (get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__FADING_OUT)=0)
          $_channel3 := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__CHANNEL)
          $_artic2 := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__ARTIC)
          if ($_artic2=$ARTIC__QUARTERS)
            ~_speed_curve := 1.0
            ~_brightness_curve := 5.0
          else
            if ($_artic2=$ARTIC__EIGHTHS)
              ~_speed_curve := 1.5
              ~_brightness_curve := 1.5
            else
              if ($_artic2=$ARTIC__SIXTEENTHS)
                ~_speed_curve := 0.75
                ~_brightness_curve := 2.0
              end if
            end if
          end if
          $_low_note4 := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__LOW_NOTE)
          $_high_note4 := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__HIGH_NOTE)
          $row := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__ROW)
          $_channel3 := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__CHANNEL)
          $__start2 := get_control_par(get_ui_id($panel_keyboard),$CONTROL_PAR_POS_X)+get_control_par(%key_base_ids[$_low_note4],$CONTROL_PAR_POS_X)+(get_control_par(%key_base_ids[$_low_note4],$CONTROL_PAR_WIDTH)/2)
          $__stop2 := get_control_par(get_ui_id($panel_keyboard),$CONTROL_PAR_POS_X)+get_control_par(%key_base_ids[$_high_note4],$CONTROL_PAR_POS_X)+(get_control_par(%key_base_ids[$_high_note4],$CONTROL_PAR_WIDTH)/2)
          set_control_par(%ripple[$_r3],$CONTROL_PAR_POS_X,$__start2)
          set_control_par(%ripple[$_r3],$CONTROL_PAR_POS_Y,get_control_par(get_ui_id($panel_keyboard),$CONTROL_PAR_POS_Y)-($grid_row_height*($row+1)))
          set_control_par(%ripple[$_r3],$CONTROL_PAR_WIDTH,$__stop2-$__start2)
          set_control_par(%ripple[$_r3],$CONTROL_PAR_HEIGHT,$grid_row_height*($row+1))
          set_control_par_str(%ripple[$_r3],$CONTROL_PAR_PICTURE,"ripple " & $_channel3)
          if (in_range(get_event_par(%ripple_history[$_r3],$EVENT_PAR_PLAY_POS),0,%sample_lengths[$_artic2]/2))
            set_control_par(%ripple[$_r3],$CONTROL_PAR_PICTURE_STATE,int(real($MIN_BRIGHTNESS)+((real(get_event_par(%ripple_history[$_r3],$EVENT_PAR_PLAY_POS))-real(0))/(real(%sample_lengths[$_artic2]/2)-real(0))*(real(127)-real($MIN_BRIGHTNESS)))))
          else
            set_control_par(%ripple[$_r3],$CONTROL_PAR_PICTURE_STATE,int(real(127)+((real(get_event_par(%ripple_history[$_r3],$EVENT_PAR_PLAY_POS))-real(%sample_lengths[$_artic2]/2))/(real(%sample_lengths[$_artic2])-real(%sample_lengths[$_artic2]/2))*(real($MIN_BRIGHTNESS)-real(127)))))
          end if
          set_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,get_control_par(%ripple[$_r3],$CONTROL_PAR_PICTURE_STATE),$EVENT__BRIGHTNESS_ON_RELEASE)
          set_control_par(%ripple[$_r3],$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
          $_play_pos_in_beat := get_event_par(%ripple_history[$_r3],$EVENT_PAR_PLAY_POS) mod %recorded_pulse_lengths[$_artic2]
          set_control_par_str(%dot[$_r3],$CONTROL_PAR_PICTURE,!direction_strings[get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__DIRECTION)])
          ~_play_pos_in_beat_norm := real($_play_pos_in_beat)/real(%recorded_pulse_lengths[$_artic2])
          $_play_pos_in_beat_curved := int(pow(~_play_pos_in_beat_norm,~_brightness_curve)*127.0)
          set_control_par(%dot[$_r3],$CONTROL_PAR_VALUE,int(real(127-$_play_pos_in_beat_curved)+((real($_play_pos_in_beat)-real(0))/(real(%recorded_pulse_lengths[$_artic2])-real(0))*(real(0)-real(127-$_play_pos_in_beat_curved)))))
          $__start2 := get_control_par(%ripple[$_r3],$CONTROL_PAR_POS_X)+2
          $__stop2 := get_control_par(%ripple[$_r3],$CONTROL_PAR_POS_X)+get_control_par(%ripple[$_r3],$CONTROL_PAR_WIDTH)-5-2
          ~_play_pos_in_beat_norm := real($_play_pos_in_beat)/real(%recorded_pulse_lengths[$_artic2])
          $_play_pos_in_beat_curved := int(pow(~_play_pos_in_beat_norm,~_speed_curve)*1000000.0)
          $_direction := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__DIRECTION)
          if ($_direction=$UP)
            set_control_par(%dot[$_r3],$CONTROL_PAR_POS_X,int(real($__start2)+((real($_play_pos_in_beat_curved)-real(0))/(real(1000000)-real(0))*(real($__stop2)-real($__start2)))))
          else
            set_control_par(%dot[$_r3],$CONTROL_PAR_POS_X,int(real($__stop2)+((real($_play_pos_in_beat_curved)-real(0))/(real(1000000)-real(0))*(real($__start2)-real($__stop2)))))
          end if
          set_control_par(%dot[$_r3],$CONTROL_PAR_POS_Y,get_control_par(%ripple[$_r3],$CONTROL_PAR_POS_Y)-2)
          if (get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__FADING_OUT)=0)
            set_control_par(%dot[$_r3],$CONTROL_PAR_HIDE,$HIDE_PART_NOTHING)
          else
            set_control_par(%dot[$_r3],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
          end if
        else
          set_control_par(%dot[$_r3],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
          if (get_control_par(%ripple[$_r3],$CONTROL_PAR_PICTURE_STATE)>0)
            $_time_since_release := $ENGINE_UPTIME-get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__RELEASE_TIMESTAMP)
            $_release_length := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__RELEASE_LENGTH)/1000
            $_brightness_on_release := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__BRIGHTNESS_ON_RELEASE)
            set_control_par(%ripple[$_r3],$CONTROL_PAR_PICTURE_STATE,int(real($_brightness_on_release)+((real($_time_since_release)-real(0))/(real($_release_length)-real(0))*(real(0)-real($_brightness_on_release)))))
          end if
        end if
      else
        set_control_par(%ripple[$_r3],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
        set_control_par(%dot[$_r3],$CONTROL_PAR_HIDE,$HIDE_WHOLE_CONTROL)
      end if
      dec($_r3)
    end while
    @_str := ""
    $i := 0
    while ($i<100)
      if (get_control_par(%ripple[$i],$CONTROL_PAR_HIDE)=$HIDE_PART_NOTHING)
        @_str := @_str & "   " & $i
      end if
      inc($i)
    end while
    if ($highest_row>0)
      ~instructions_opacity := 0.0
    end if
    ~smoothed_instructions_opacity := ~smoothed_instructions_opacity+((~instructions_opacity-~smoothed_instructions_opacity)/30.0)
    if (~smoothed_instructions_opacity<0.0001)
      ~smoothed_instructions_opacity := 0.0
    end if
    set_control_par(get_ui_id($label_instructions),$CONTROL_PAR_PICTURE_STATE,int(real(0)+((~smoothed_instructions_opacity-0.0)/(1.0-0.0)*(real(127)-real(0)))))
    $_r3 := 0
    while ($_r3<100)
      if (event_status(%ripple_history[$_r3])=$EVENT_STATUS_NOTE_QUEUE and (get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$EVENT__FADING_OUT)=0) and (get_event_par(%ripple_history[$_r3],$EVENT_PAR_PLAY_POS)>%sample_lengths[$cur_artic]))
        $_note := get_event_par(%ripple_history[$_r3],$EVENT_PAR_NOTE)
        $_velocity := get_event_par(%ripple_history[$_r3],$EVENT_PAR_VELOCITY)
        $par_i := 0
        while ($par_i<$EVENT__SIZE)
          %_event_pars[$par_i] := get_event_par_arr(%ripple_history[$_r3],$EVENT_PAR_CUSTOM,$par_i)
          inc($par_i)
        end while
        fade_out(%ripple_history[$_r3],$DURATION_SIXTEENTH,1)
        $_offset2 := get_event_par(%ripple_history[$_r3],$EVENT_PAR_PLAY_POS) mod %sample_lengths[$_artic2]
        $_note_id2 := play_note($_note,$_velocity,$_offset2,0)
        set_event_par_arr($_note_id2,$EVENT_PAR_ALLOW_GROUP,0,$ALL_GROUPS)
        set_event_par_arr($_note_id2,$EVENT_PAR_ALLOW_GROUP,1,%_event_pars[$EVENT__ARTIC])
        fade_in($_note_id2,$DURATION_SIXTEENTH)
        $par_i := 0
        while ($par_i<$EVENT__SIZE)
          set_event_par_arr($_note_id2,$EVENT_PAR_CUSTOM,%_event_pars[$par_i],$par_i)
          inc($par_i)
        end while
        %ripple_history[$_r3] := $_note_id2
        %_ripple_history_by_channel[100*%_event_pars[$EVENT__CHANNEL]+$_r3] := $_note_id2
      end if
      inc($_r3)
    end while
  end if
end on

on ui_controls
  $_index := search(%articulation_ids,$NI_UI_ID)
  if ($_index # -1)
    $cur_artic := $_index
    call update_articulation_switches
  end if
  if ($NI_UI_ID=get_ui_id($slider_speed))
    call update_speed_switches
    call update_speed
  end if
  $_index := search(%speed_ids,$NI_UI_ID)
  if ($_index # -1)
    $slider_speed := $_index
    call update_speed_switches
    call update_speed
  end if
  if ($NI_UI_ID=get_ui_id($slider_direction))
    call update_direction_switches
  end if
  $_index := search(%direction_mode_ids,$NI_UI_ID)
  if ($_index # -1)
    $slider_direction := $_index
    call update_direction_switches
  end if
  if ($NI_UI_ID=get_ui_id($slider_legato))
    call update_legato_switches
  end if
  $_index := search(%legato_ids,$NI_UI_ID)
  if ($_index # -1)
    $slider_legato := $_index
    call update_legato_switches
  end if
  if ($NI_UI_ID=get_ui_id($slider_vol))
    set_engine_par($ENGINE_PAR_SEND_EFFECT_OUTPUT_GAIN,int(real(real_to_int(pow(2.0,(-16000.0-12000.0+346768.2342478351)/18000.0)))+((real($slider_vol)-real(0))/(real(1000000)-real(0))*(real(real_to_int(pow(2.0,(6000.0-12000.0+346768.2342478351)/18000.0)))-real(real_to_int(pow(2.0,(-16000.0-12000.0+346768.2342478351)/18000.0)))))),-1,0,1)
  end if
  if ($NI_UI_ID=get_ui_id($slider_reverb))
    set_engine_par($ENGINE_PAR_RAUM_REVERB,$slider_reverb,-1,0,$NI_MAIN_BUS)
  end if
  if (search(%articulation_ids,$NI_UI_ID) # -1 or (search(%speed_ids,$NI_UI_ID) # -1) or (search(%direction_mode_ids,$NI_UI_ID) # -1) or (search(%legato_ids,$NI_UI_ID) # -1) or ($NI_UI_ID=get_ui_id($slider_speed)) or ($NI_UI_ID=get_ui_id($slider_direction)) or ($NI_UI_ID=get_ui_id($slider_legato)))
    call set_keys_pressed
  end if
end on

